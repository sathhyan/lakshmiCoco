"use strict";(self.webpackChunklakshmiCoco=self.webpackChunklakshmiCoco||[]).push([[187],{8187:(Jv,tc,B)=>{B.r(tc),B.d(tc,{HomeModule:()=>tA});var I=B(9808),Bi=B(4618),f=B(5e3),We=B(8996),Nn=B(8306),nc=B(4742),Ro=B(8421),_m=B(7669),sn=B(5403),ym=B(3268),vm=B(1810);var se=B(4004);function Dt(n){return null==n||0===n.length}function un(n){return null!=n&&"number"==typeof n.length}const yt=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class ge{static min(e){return function Po(n){return e=>{if(Dt(e.value)||Dt(n))return null;const t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}(e)}static max(e){return function Ze(n){return e=>{if(Dt(e.value)||Dt(n))return null;const t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}(e)}static required(e){return function sc(n){return Dt(n.value)?{required:!0}:null}(e)}static requiredTrue(e){return function oc(n){return!0===n.value?null:{required:!0}}(e)}static email(e){return function Rn(n){return Dt(n.value)||yt.test(n.value)?null:{email:!0}}(e)}static minLength(e){return function ji(n){return e=>Dt(e.value)||!un(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}(e)}static maxLength(e){return function Fo(n){return e=>un(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}(e)}static pattern(e){return function ac(n){if(!n)return qi;let e,t;return"string"==typeof n?(t="","^"!==n.charAt(0)&&(t+="^"),t+=n,"$"!==n.charAt(n.length-1)&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(Dt(r.value))return null;const i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}(e)}static nullValidator(e){return null}static compose(e){return _e(e)}static composeAsync(e){return Vo(e)}}function qi(n){return null}function On(n){return null!=n}function Hi(n){const e=(0,f.QGY)(n)?(0,We.D)(n):n;return(0,f.CqO)(e),e}function Lo(n){let e={};return n.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function uc(n,e){return e.map(t=>t(n))}function he(n){return n.map(e=>function Vd(n){return!n.validate}(e)?e:t=>e.validate(t))}function _e(n){if(!n)return null;const e=n.filter(On);return 0==e.length?null:function(t){return Lo(uc(t,e))}}function Vo(n){if(!n)return null;const e=n.filter(On);return 0==e.length?null:function(t){return function on(...n){const e=(0,_m.jO)(n),{args:t,keys:r}=(0,nc.D)(n),i=new Nn.y(s=>{const{length:u}=t;if(!u)return void s.complete();const d=new Array(u);let h=u,p=u;for(let _=0;_<u;_++){let v=!1;(0,Ro.Xf)(t[_]).subscribe((0,sn.x)(s,E=>{v||(v=!0,p--),d[_]=E},()=>h--,void 0,()=>{(!h||!v)&&(p||s.next(r?(0,vm.n)(r,d):d),s.complete())}))}});return e?i.pipe((0,ym.Z)(e)):i}(uc(t,e).map(Hi)).pipe((0,se.U)(Lo))}}function Bo(n){return n?Array.isArray(n)?n:[n]:[]}function Gt(n,e){return Array.isArray(n)?n.includes(e):n===e}function cc(n,e){const t=Bo(e);return Bo(n).forEach(i=>{Gt(t,i)||t.push(i)}),t}function Ki(n,e){return Bo(e).filter(t=>!Gt(n,t))}function Xi(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const ue="VALID",Mr="INVALID",Fn="PENDING",Ln="DISABLED";function Ji(n){return(Vn(n)?n.validators:n)||null}function _c(n){return Array.isArray(n)?function Cr(n){return null!=n?_e(he(n)):null}(n):n||null}function qt(n,e){return(Vn(e)?e.asyncValidators:n)||null}function Xo(n){return Array.isArray(n)?function Sr(n){return null!=n?Vo(he(n)):null}(n):n||null}function Vn(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}const Qi=n=>n instanceof kr,Un=n=>n instanceof ns,yc=n=>n instanceof rs;function es(n){return Qi(n)?n.value:n.getRawValue()}function vc(n,e){const t=Un(n),r=n.controls;if(!(t?Object.keys(r):r).length)throw new f.vHH(1e3,"");if(!r[e])throw new f.vHH(1001,"")}function ts(n,e){Un(n),n._forEachChild((r,i)=>{if(void 0===e[i])throw new f.vHH(1002,"")})}class Bn{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=_c(this._rawValidators),this._composedAsyncValidatorFn=Xo(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===ue}get invalid(){return this.status===Mr}get pending(){return this.status==Fn}get disabled(){return this.status===Ln}get enabled(){return this.status!==Ln}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=_c(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=Xo(e)}addValidators(e){this.setValidators(cc(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(cc(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Ki(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Ki(e,this._rawAsyncValidators))}hasValidator(e){return Gt(this._rawValidators,e)}hasAsyncValidator(e){return Gt(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Fn,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Ln,this.errors=null,this._forEachChild(r=>{r.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=ue,this._forEachChild(r=>{r.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ue||this.status===Fn)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ln:ue}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Fn,this._hasOwnPendingAsyncValidator=!0;const t=Hi(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function Kd(n,e,t){if(null==e||(Array.isArray(e)||(e=e.split(t)),Array.isArray(e)&&0===e.length))return null;let r=n;return e.forEach(i=>{r=Un(r)?r.controls.hasOwnProperty(i)?r.controls[i]:null:yc(r)&&r.at(i)||null}),r}(this,e,".")}getError(e,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new f.vpe,this.statusChanges=new f.vpe}_calculateStatus(){return this._allControlsDisabled()?Ln:this.errors?Mr:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Fn)?Fn:this._anyControlsHaveStatus(Mr)?Mr:ue}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Vn(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class kr extends Bn{constructor(e=null,t,r){super(Ji(t),qt(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Vn(t)&&t.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Xi(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Xi(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class ns extends Bn{constructor(e,t,r){super(Ji(t),qt(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){ts(this,e),Object.keys(e).forEach(r=>{vc(this,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(r=>{this.controls[r]&&this.controls[r].patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=es(t),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const r=this.controls[t];if(this.contains(t)&&e(r))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,r)=>((t.enabled||this.disabled)&&(e[r]=t.value),e))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class rs extends Bn{constructor(e,t,r){super(Ji(t),qt(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){ts(this,e),e.forEach((r,i)=>{vc(this,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>es(e))}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((t,r)=>!!r._syncPendingControls()||t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}let as=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({}),n})();const Rr=new f.OlP("NgModelWithFormControlWarning");let aa=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({imports:[[as]]}),n})(),bs=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:Rr,useValue:t.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({imports:[aa]}),n})(),th=(()=>{class n{group(t,r=null){const i=this._reduceControls(t);let d,s=null,u=null;return null!=r&&(function Ts(n){return void 0!==n.asyncValidators||void 0!==n.validators||void 0!==n.updateOn}(r)?(s=null!=r.validators?r.validators:null,u=null!=r.asyncValidators?r.asyncValidators:null,d=null!=r.updateOn?r.updateOn:void 0):(s=null!=r.validator?r.validator:null,u=null!=r.asyncValidator?r.asyncValidator:null)),new ns(i,{asyncValidators:u,updateOn:d,validators:s})}control(t,r,i){return new kr(t,r,i)}array(t,r,i){const s=t.map(u=>this._createControl(u));return new rs(s,r,i)}_reduceControls(t){const r={};return Object.keys(t).forEach(i=>{r[i]=this._createControl(t[i])}),r}_createControl(t){return Qi(t)||Un(t)||yc(t)?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=f.Yz7({token:n,factory:n.\u0275fac,providedIn:bs}),n})();var nh=B(4986),Ye=B(9646),Oe=B(880),Pr=B(8675),ca=B(4482);function Fr(){return(0,ca.e)((n,e)=>{let t,r=!1;n.subscribe((0,sn.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var la=B(5026),da=B(4671);function ha(n,e){return n===e}var F,As=B(9300),Tt=B(2011),ih=(B(1451),B(3942)),x=B(5861),Rt=B(9681),Cs=B(4859),At=B(1877),W=B(2090),fa="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ot={},pa=pa||{},q=fa||self;function Ss(){}function Lr(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Vr(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var ga="closure_uid_"+(1e9*Math.random()>>>0),sh=0;function Pc(n,e,t){return n.call.apply(n.bind,arguments)}function _a(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Me(n,e,t){return(Me=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Pc:_a).apply(null,arguments)}function Pt(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function be(n,e){function t(){}t.prototype=e.prototype,n.Z=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Vb=function(r,i,s){for(var u=Array(arguments.length-2),d=2;d<arguments.length;d++)u[d-2]=arguments[d];return e.prototype[i].apply(r,u)}}function Kt(){this.s=this.s,this.o=this.o}var ah={};Kt.prototype.s=!1,Kt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function ma(n){return Object.prototype.hasOwnProperty.call(n,ga)&&n[ga]||(n[ga]=++sh)}(this);delete ah[n]}},Kt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Fc=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1},Lc=Array.prototype.forEach?function(n,e,t){Array.prototype.forEach.call(n,e,t)}:function(n,e,t){const r=n.length,i="string"==typeof n?n.split(""):n;for(let s=0;s<r;s++)s in i&&e.call(t,i[s],s,n)};function uh(n){return Array.prototype.concat.apply([],arguments)}function Vc(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function ya(n){return/^[\s\xa0]*$/.test(n)}var Je,ch=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function Xe(n,e){return-1!=n.indexOf(e)}function Uc(n,e){return n<e?-1:n>e?1:0}e:{var xs=q.navigator;if(xs){var zt=xs.userAgent;if(zt){Je=zt;break e}}Je=""}function Ur(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Bc(n){const e={};for(const t in n)e[t]=n[t];return e}var Gc="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function jc(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<Gc.length;s++)t=Gc[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function va(n){return va[" "](n),n}va[" "]=Ss;var wa,n,Ea=Xe(Je,"Opera"),jn=Xe(Je,"Trident")||Xe(Je,"MSIE"),Br=Xe(Je,"Edge"),Ds=Br||jn,qc=Xe(Je,"Gecko")&&!(Xe(Je.toLowerCase(),"webkit")&&!Xe(Je,"Edge"))&&!(Xe(Je,"Trident")||Xe(Je,"MSIE"))&&!Xe(Je,"Edge"),lh=Xe(Je.toLowerCase(),"webkit")&&!Xe(Je,"Edge");function Hc(){var n=q.document;return n?n.documentMode:void 0}e:{var qn="",$c=(n=Je,qc?/rv:([^\);]+)(\)|;)/.exec(n):Br?/Edge\/([\d\.]+)/.exec(n):jn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):lh?/WebKit\/(\S+)/.exec(n):Ea?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if($c&&(qn=$c?$c[1]:""),jn){var Ct=Hc();if(null!=Ct&&Ct>parseFloat(qn)){wa=String(Ct);break e}}wa=qn}var dh={};var ye=q.document&&jn&&(Hc()||parseInt(wa,10))||void 0,fh=function(){if(!q.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{q.addEventListener("test",Ss,e),q.removeEventListener("test",Ss,e)}catch(t){}return n}();function Te(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}function Gr(n,e){if(Te.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(qc){e:{try{va(e.nodeName);var i=!0;break e}catch(s){}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:ba[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Gr.Z.h.call(this)}}Te.prototype.h=function(){this.defaultPrevented=!0},be(Gr,Te);var ba={2:"touch",3:"pen",4:"mouse"};Gr.prototype.h=function(){Gr.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var jr="closure_listenable_"+(1e6*Math.random()|0),ph=0;function zc(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ia=i,this.key=++ph,this.ca=this.fa=!1}function Ms(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function gn(n){this.src=n,this.g={},this.h=0}function ks(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Fc(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Ms(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function _n(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.ca&&s.listener==e&&s.capture==!!t&&s.ia==r)return i}return-1}gn.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var u=_n(n,e,r,i);return-1<u?(e=n[u],t||(e.fa=!1)):((e=new zc(e,this.src,s,!!r,i)).fa=t,n.push(e)),e};var Hn="closure_lm_"+(1e6*Math.random()|0),Ta={};function Ns(n,e,t,r,i){if(r&&r.once)return Wc(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Ns(n,e[s],t,r,i);return null}return t=Sa(t),n&&n[jr]?n.N(e,t,Vr(r)?!!r.capture:!!r,i):Aa(n,e,t,!1,r,i)}function Aa(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var u=Vr(i)?!!i.capture:!!i,d=Yc(n);if(d||(n[Hn]=d=new gn(n)),(t=d.add(e,t,r,u,s)).proxy)return t;if(r=function Ca(){var e=mh;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)fh||(i=u),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Zc(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Wc(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Wc(n,e[s],t,r,i);return null}return t=Sa(t),n&&n[jr]?n.O(e,t,Vr(r)?!!r.capture:!!r,i):Aa(n,e,t,!0,r,i)}function Rs(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Rs(n,e[s],t,r,i);else r=Vr(r)?!!r.capture:!!r,t=Sa(t),n&&n[jr]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=_n(s=n.g[e],t,r,i))&&(Ms(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=Yc(n))&&(e=n.g[e.toString()],n=-1,e&&(n=_n(e,t,r,i)),(t=-1<n?e[n]:null)&&Os(t))}function Os(n){if("number"!=typeof n&&n&&!n.ca){var e=n.src;if(e&&e[jr])ks(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Zc(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Yc(e))?(ks(t,n),0==t.h&&(t.src=null,e[Hn]=null)):Ms(n)}}}function Zc(n){return n in Ta?Ta[n]:Ta[n]="on"+n}function mh(n,e){if(n.ca)n=!0;else{e=new Gr(e,this);var t=n.listener,r=n.ia||n.src;n.fa&&Os(n),n=t.call(r,e)}return n}function Yc(n){return(n=n[Hn])instanceof gn?n:null}var Wt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Sa(n){return"function"==typeof n?n:(n[Wt]||(n[Wt]=function(e){return n.handleEvent(e)}),n[Wt])}function Ae(){Kt.call(this),this.i=new gn(this),this.P=this,this.I=null}function ke(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new Te(e,n);else if(e instanceof Te)e.target=e.target||n;else{var i=e;jc(e=new Te(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var u=e.g=t[s];i=$n(u,r,!0,e)&&i}if(i=$n(u=e.g=n,r,!0,e)&&i,i=$n(u,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=$n(u=e.g=t[s],r,!1,e)&&i}function $n(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var u=e[s];if(u&&!u.ca&&u.capture==t){var d=u.listener,h=u.ia||u.src;u.fa&&ks(n.i,u),i=!1!==d.call(h,r)&&i}}return i&&!r.defaultPrevented}be(Ae,Kt),Ae.prototype[jr]=!0,Ae.prototype.removeEventListener=function(n,e,t,r){Rs(this,n,e,t,r)},Ae.prototype.M=function(){if(Ae.Z.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Ms(t[r]);delete n.g[e],n.h--}}this.I=null},Ae.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},Ae.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var xa=q.JSON.stringify;function Xc(){var n=el;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Ma,Qc=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new gh,n=>n.reset());class gh{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ps(n){q.setTimeout(()=>{throw n},0)}function Da(n,e){Ma||function _h(){var n=q.Promise.resolve(void 0);Ma=function(){n.then(yh)}}(),qr||(Ma(),qr=!0),el.add(n,e)}var qr=!1,el=new class Jc{constructor(){this.h=this.g=null}add(e,t){const r=Qc.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function yh(){for(var n;n=Xc();){try{n.h.call(n.g)}catch(t){Ps(t)}var e=Qc;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}qr=!1}function Fs(n,e){Ae.call(this),this.h=n||1,this.g=e||q,this.j=Me(this.kb,this),this.l=Date.now()}function ka(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}function Na(n,e,t){if("function"==typeof n)t&&(n=Me(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Me(n.handleEvent,n)}return 2147483647<Number(e)?-1:q.setTimeout(n,e||0)}function Ra(n){n.g=Na(()=>{n.g=null,n.i&&(n.i=!1,Ra(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}be(Fs,Ae),(F=Fs.prototype).da=!1,F.S=null,F.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ke(this,"tick"),this.da&&(ka(this),this.start()))}},F.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},F.M=function(){Fs.Z.M.call(this),ka(this),delete this.g};class vh extends Kt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ra(this)}M(){super.M(),this.g&&(q.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Hr(n){Kt.call(this),this.h=n,this.g={}}be(Hr,Kt);var tl=[];function Ls(n,e,t,r){Array.isArray(t)||(t&&(tl[0]=t.toString()),t=tl);for(var i=0;i<t.length;i++){var s=Ns(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function nl(n){Ur(n.g,function(e,t){this.g.hasOwnProperty(t)&&Os(e)},n),n.g={}}function Kn(){this.g=!0}function zn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Vs(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var u=1;u<i.length;u++)i[u]=""}}}return xa(t)}catch(d){return e}}(n,t)+(r?" "+r:"")})}Hr.prototype.M=function(){Hr.Z.M.call(this),nl(this)},Hr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Kn.prototype.Aa=function(){this.g=!1},Kn.prototype.info=function(){};var Ft={},rl=null;function Wn(){return rl=rl||new Ae}function Zn(n){Te.call(this,Ft.Ma,n)}function ft(n){const e=Wn();ke(e,new Zn(e,n))}function Us(n,e){Te.call(this,Ft.STAT_EVENT,n),this.stat=e}function Be(n){const e=Wn();ke(e,new Us(e,n))}function il(n,e){Te.call(this,Ft.Na,n),this.size=e}function $r(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return q.setTimeout(function(){n()},e)}Ft.Ma="serverreachability",be(Zn,Te),Ft.STAT_EVENT="statevent",be(Us,Te),Ft.Na="timingevent",be(il,Te);var Yn={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Fa={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function La(){}function Bs(){}La.prototype.h=null;var Wr,Kr={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function zr(){Te.call(this,"d")}function Va(){Te.call(this,"c")}function Xn(){}function Zr(n,e,t,r){this.l=n,this.j=e,this.m=t,this.X=r||1,this.V=new Hr(this),this.P=Eh,this.W=new Fs(n=Ds?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Jn}function Jn(){this.i=null,this.g="",this.h=!1}be(zr,Te),be(Va,Te),be(Xn,La),Xn.prototype.g=function(){return new XMLHttpRequest},Xn.prototype.i=function(){return{}},Wr=new Xn;var Eh=45e3,Ua={},Qn={};function Yr(n,e,t){n.K=1,n.v=zs(St(e)),n.s=t,n.U=!0,Gs(n,null)}function Gs(n,e){n.F=Date.now(),er(n),n.A=St(n.v);var t=n.A,r=n.X;Array.isArray(r)||(r=[String(r)]),fl(t.h,"t",r),n.C=0,t=n.l.H,n.h=new Jn,n.g=Dl(n.l,t?e:null,!n.s),0<n.O&&(n.L=new vh(Me(n.Ia,n,n.g),n.O)),Ls(n.V,n.g,"readystatechange",n.gb),e=n.H?Bc(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,e)):(n.u="GET",n.g.ea(n.A,n.u,null,e)),ft(1),function Ih(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var u="",d=s.split("&"),h=0;h<d.length;h++){var p=d[h].split("=");if(1<p.length){var _=p[0];p=p[1];var v=_.split("_");u=2<=v.length&&"type"==v[1]?u+(_+"=")+p+"&":u+(_+"=redacted&")}}else u=null;else u=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+u})}(n.j,n.u,n.A,n.m,n.X,n.s)}function ol(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Ba}function js(n,e,t){let i,r=!0;for(;!n.I&&n.C<t.length;){if(i=al(n,t),i==Qn){4==e&&(n.o=4,Be(14),r=!1),zn(n.j,n.m,null,"[Incomplete Response]");break}if(i==Ua){n.o=4,Be(15),zn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}zn(n.j,n.m,i,null),Ba(n,i)}ol(n)&&i!=Qn&&i!=Ua&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Be(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.aa&&(n.aa=!0,(e=n.l).g==n&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),ai(e),e.L=!0,Be(11))):(zn(n.j,n.m,t,"[Invalid Chunked Response]"),vn(n),yn(n))}function al(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Qn:(t=Number(e.substring(t,r)),isNaN(t)?Ua:(r+=1)+t>e.length?Qn:(e=e.substr(r,t),n.C=r+t,e))}function er(n){n.Y=Date.now()+n.P,ul(n,n.P)}function ul(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=$r(Me(n.eb,n),e)}function qs(n){n.B&&(q.clearTimeout(n.B),n.B=null)}function yn(n){0==n.l.G||n.I||ui(n.l,n)}function vn(n){qs(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,ka(n.W),nl(n.V),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function Ba(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Ka(t.i,n)))if(t.I=n.N,!n.J&&Ka(t.i,n)&&3==t.G){try{var r=t.Ca.g.parse(e)}catch(p){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(t.u)t.ta=i[1],0<t.ta-t.U&&37500>i[2]&&t.N&&0==t.A&&!t.v&&(t.v=$r(Me(t.ab,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;Xs(t),Zs(t)}oi(t),Be(18)}if(1>=gl(t.i)&&t.ka){try{t.ka()}catch(p){}t.ka=void 0}}else bn(t,11)}else if((n.J||t.g==n)&&Xs(t),!ya(e))for(i=t.Ca.g.parse(e),e=0;e<i.length;e++){let p=i[e];if(t.U=p[0],p=p[1],2==t.G)if("c"==p[0]){t.J=p[1],t.la=p[2];const _=p[3];null!=_&&(t.ma=_,t.h.info("VER="+t.ma));const v=p[4];null!=v&&(t.za=v,t.h.info("SVER="+t.za));const E=p[5];null!=E&&"number"==typeof E&&0<E&&(t.K=r=1.5*E,t.h.info("backChannelRequestTimeoutMs_="+r)),r=t;const b=n.g;if(b){const S=b.g?b.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(S){var s=r.i;!s.g&&(Xe(S,"spdy")||Xe(S,"quic")||Xe(S,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(za(s,s.h),s.h=null))}if(r.D){const R=b.g?b.g.getResponseHeader("X-HTTP-Session-Id"):null;R&&(r.sa=R,re(r.F,r.D,R))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-n.F,t.h.info("Handshake RTT: "+t.O+"ms"));var u=n;if((r=t).oa=tu(r,r.H?r.la:null,r.W),u.J){_l(r.i,u);var d=u,h=r.K;h&&d.setTimeout(h),d.B&&(qs(d),er(d)),r.g=u}else Al(r);0<t.l.length&&Ys(t)}else"stop"!=p[0]&&"close"!=p[0]||bn(t,7);else 3==t.G&&("stop"==p[0]||"close"==p[0]?"stop"==p[0]?bn(t,7):si(t):"noop"!=p[0]&&t.j&&t.j.wa(p),t.A=0)}ft(4)}catch(p){}}function ja(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Lr(n)||"string"==typeof n)Lc(n,e,void 0);else{if(n.T&&"function"==typeof n.T)var t=n.T();else if(n.R&&"function"==typeof n.R)t=void 0;else if(Lr(n)||"string"==typeof n){t=[];for(var r=n.length,i=0;i<r;i++)t.push(i)}else for(i in t=[],r=0,n)t[r++]=i;r=function Ga(n){if(n.R&&"function"==typeof n.R)return n.R();if("string"==typeof n)return n.split("");if(Lr(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length;for(var s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}}function tr(n,e){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var r=0;r<t;r+=2)this.set(arguments[r],arguments[r+1])}else if(n)if(n instanceof tr)for(t=n.T(),r=0;r<t.length;r++)this.set(t[r],n.get(t[r]));else for(r in n)this.set(r,n[r])}function Xr(n){if(n.i!=n.g.length){for(var e=0,t=0;e<n.g.length;){var r=n.g[e];In(n.h,r)&&(n.g[t++]=r),e++}n.g.length=t}if(n.i!=n.g.length){var i={};for(t=e=0;e<n.g.length;)In(i,r=n.g[e])||(n.g[t++]=r,i[r]=1),e++;n.g.length=t}}function In(n,e){return Object.prototype.hasOwnProperty.call(n,e)}(F=Zr.prototype).setTimeout=function(n){this.P=n},F.gb=function(n){n=n.target;const e=this.L;e&&3==pt(n)?e.l():this.Ia(n)},F.Ia=function(n){try{if(n==this.g)e:{const _=pt(this.g);var e=this.g.Da();const v=this.g.ba();if(!(3>_)&&(3!=_||Ds||this.g&&(this.h.h||this.g.ga()||El(this.g)))){this.I||4!=_||7==e||ft(8==e||0>=v?3:2),qs(this);var t=this.g.ba();this.N=t;t:if(ol(this)){var r=El(this.g);n="";var i=r.length,s=4==pt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){vn(this),yn(this);var u="";break t}this.h.i=new q.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==t,function Oa(n,e,t,r,i,s,u){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+u})}(this.j,this.u,this.A,this.m,this.X,_,t),this.i){if(this.$&&!this.J){t:{if(this.g){var d,h=this.g;if((d=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ya(d)){var p=d;break t}}p=null}if(!(t=p)){this.i=!1,this.o=3,Be(12),vn(this),yn(this);break e}zn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ba(this,t)}this.U?(js(this,_,u),Ds&&this.i&&3==_&&(Ls(this.V,this.W,"tick",this.fb),this.W.start())):(zn(this.j,this.m,u,null),Ba(this,u)),4==_&&vn(this),this.i&&!this.I&&(4==_?ui(this.l,this):(this.i=!1,er(this)))}else 400==t&&0<u.indexOf("Unknown SID")?(this.o=3,Be(12)):(this.o=0,Be(13)),vn(this),yn(this)}}}catch(_){}},F.fb=function(){if(this.g){var n=pt(this.g),e=this.g.ga();this.C<e.length&&(qs(this),js(this,n,e),this.i&&4!=n&&er(this))}},F.cancel=function(){this.I=!0,vn(this)},F.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function Pa(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(ft(3),Be(17)),vn(this),this.o=2,yn(this)):ul(this,this.Y-n)},(F=tr.prototype).R=function(){Xr(this);for(var n=[],e=0;e<this.g.length;e++)n.push(this.h[this.g[e]]);return n},F.T=function(){return Xr(this),this.g.concat()},F.get=function(n,e){return In(this.h,n)?this.h[n]:e},F.set=function(n,e){In(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=e},F.forEach=function(n,e){for(var t=this.T(),r=0;r<t.length;r++){var i=t[r],s=this.get(i);n.call(e,s,i,this)}};var Hs=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Lt(n,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof Lt){this.g=void 0!==e?e:n.g,nr(this,n.j),this.s=n.s,Ks(this,n.i),Jr(this,n.m),this.l=n.l,e=n.h;var t=new Zt;t.i=e.i,e.g&&(t.g=new tr(e.g),t.h=e.h),qa(this,t),this.o=n.o}else n&&(t=String(n).match(Hs))?(this.g=!!e,nr(this,t[1]||"",!0),this.s=Qr(t[2]||""),Ks(this,t[3]||"",!0),Jr(this,t[4]),this.l=Qr(t[5]||"",!0),qa(this,t[6]||"",!0),this.o=Qr(t[7]||"")):(this.g=!!e,this.h=new Zt(null,this.g))}function St(n){return new Lt(n)}function nr(n,e,t){n.j=t?Qr(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Ks(n,e,t){n.i=t?Qr(e,!0):e}function Jr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function qa(n,e,t){e instanceof Zt?(n.h=e,function Ch(n,e){e&&!n.j&&(Yt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(dl(this,r),fl(this,i,t))},n)),n.j=e}(n.h,n.g)):(t||(e=ei(e,ll)),n.h=new Zt(e,n.g))}function re(n,e,t){n.h.set(e,t)}function zs(n){return re(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Qr(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function ei(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,wh),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function wh(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Lt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(ei(e,Ws,!0),":");var t=this.i;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(ei(e,Ws,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&n.push("/"),n.push(ei(t,"/"==t.charAt(0)?Th:bh,!0))),(t=this.h.toString())&&n.push("?",t),(t=this.o)&&n.push("#",ei(t,Ah)),n.join("")};var Ws=/[#\/\?@]/g,bh=/[#\?:]/g,Th=/[#\?]/g,ll=/[#\?@]/g,Ah=/#/g;function Zt(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Yt(n){n.g||(n.g=new tr,n.h=0,n.i&&function $s(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function dl(n,e){Yt(n),e=rr(n,e),In(n.g.h,e)&&(n.i=null,n.h-=n.g.get(e).length,In((n=n.g).h,e)&&(delete n.h[e],n.i--,n.g.length>2*n.i&&Xr(n)))}function hl(n,e){return Yt(n),e=rr(n,e),In(n.g.h,e)}function fl(n,e,t){dl(n,e),0<t.length&&(n.i=null,n.g.set(rr(n,e),Vc(t)),n.h+=t.length)}function rr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function pl(n){this.l=n||$a,n=q.PerformanceNavigationTiming?0<(n=q.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(q.g&&q.g.Ea&&q.g.Ea()&&q.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(F=Zt.prototype).add=function(n,e){Yt(this),this.i=null,n=rr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},F.forEach=function(n,e){Yt(this),this.g.forEach(function(t,r){Lc(t,function(i){n.call(e,i,r,this)},this)},this)},F.T=function(){Yt(this);for(var n=this.g.R(),e=this.g.T(),t=[],r=0;r<e.length;r++)for(var i=n[r],s=0;s<i.length;s++)t.push(e[r]);return t},F.R=function(n){Yt(this);var e=[];if("string"==typeof n)hl(this,n)&&(e=uh(e,this.g.get(rr(this,n))));else{n=this.g.R();for(var t=0;t<n.length;t++)e=uh(e,n[t])}return e},F.set=function(n,e){return Yt(this),this.i=null,hl(this,n=rr(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},F.get=function(n,e){return n&&0<(n=this.R(n)).length?String(n[0]):e},F.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],e=this.g.T(),t=0;t<e.length;t++){var r=e[t],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var u=i;""!==r[s]&&(u+="="+encodeURIComponent(String(r[s]))),n.push(u)}}return this.i=n.join("&")};var $a=10;function ml(n){return!!n.h||!!n.g&&n.g.size>=n.j}function gl(n){return n.h?1:n.g?n.g.size:0}function Ka(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function za(n,e){n.g?n.g.add(e):n.h=e}function _l(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Wa(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return Vc(n.i)}function Za(){}function xh(){this.g=new Za}function Dh(n,e,t){const r=t||"";try{ja(n,function(i,s){let u=i;Vr(i)&&(u=xa(i)),e.push(r+s+"="+encodeURIComponent(u))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function ir(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(s){}}function ti(n){this.l=n.$b||null,this.j=n.ib||!1}function sr(n,e){Ae.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Ya,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}pl.prototype.cancel=function(){if(this.i=Wa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},Za.prototype.stringify=function(n){return q.JSON.stringify(n,void 0)},Za.prototype.parse=function(n){return q.JSON.parse(n,void 0)},be(ti,La),ti.prototype.g=function(){return new sr(this.l,this.j)},ti.prototype.i=function(n){return function(){return n}}({}),be(sr,Ae);var Ya=0;function Xa(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}function ni(n){n.readyState=4,n.l=null,n.j=null,n.A=null,En(n)}function En(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(F=sr.prototype).open=function(n,e){if(this.readyState!=Ya)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,En(this)},F.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||q).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},F.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ni(this)),this.readyState=Ya},F.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,En(this)),this.g&&(this.readyState=3,En(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==q.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Xa(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))},F.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?ni(this):En(this),3==this.readyState&&Xa(this)}},F.Ua=function(n){this.g&&(this.response=this.responseText=n,ni(this))},F.Ta=function(n){this.g&&(this.response=n,ni(this))},F.ha=function(){this.g&&ni(this)},F.setRequestHeader=function(n,e){this.v.append(n,e)},F.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},F.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(sr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var kh=q.JSON.parse;function le(n){Ae.call(this),this.headers=new tr,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Ja,this.K=this.L=!1}be(le,Ae);var Ja="",Nh=/^https?$/i,Rh=["POST","PUT"];function Nm(n){return"content-type"==n.toLowerCase()}function Xt(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,yl(n),or(n)}function yl(n){n.D||(n.D=!0,ke(n,"complete"),ke(n,"error"))}function vl(n){if(n.h&&void 0!==pa&&(!n.C[1]||4!=pt(n)||2!=n.ba()))if(n.v&&4==pt(n))Na(n.Fa,0,n);else if(ke(n,"readystatechange"),4==pt(n)){n.h=!1;try{const d=n.ba();e:switch(d){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===d){var i=String(n.H).match(Hs)[1]||null;if(!i&&q.self&&q.self.location){var s=q.self.location.protocol;i=s.substr(0,s.length-1)}r=!Nh.test(i?i.toLowerCase():"")}t=r}if(t)ke(n,"complete"),ke(n,"success");else{n.m=6;try{var u=2<pt(n)?n.g.statusText:""}catch(h){u=""}n.j=u+" ["+n.ba()+"]",yl(n)}}finally{or(n)}}}function or(n,e){if(n.g){Il(n);const t=n.g,r=n.C[0]?Ss:null;n.g=null,n.C=null,e||ke(n,"ready");try{t.onreadystatechange=r}catch(i){}}}function Il(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(q.clearTimeout(n.A),n.A=null)}function pt(n){return n.g?n.g.readyState:0}function El(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Ja:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ri(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=function Ph(n){let e="";return Ur(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):re(n,e,t))}function ii(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function wl(n){this.za=0,this.l=[],this.h=new Kn,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=ii("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=ii("baseRetryDelayMs",5e3,n),this.$a=ii("retryDelaySeedMs",1e4,n),this.Ya=ii("forwardChannelMaxRetries",2,n),this.ra=ii("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new pl(n&&n.concurrentRequestLimit),this.Ca=new xh,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||!1!==n.Xb}function si(n){if(bl(n),3==n.G){var e=n.V++,t=St(n.F);re(t,"SID",n.J),re(t,"RID",e),re(t,"TYPE","terminate"),wn(n,t),(e=new Zr(n,n.h,e,void 0)).K=2,e.v=zs(St(t)),t=!1,q.navigator&&q.navigator.sendBeacon&&(t=q.navigator.sendBeacon(e.v.toString(),"")),!t&&q.Image&&((new Image).src=e.v,t=!0),t||(e.g=Dl(e.l,null),e.g.ea(e.v)),e.F=Date.now(),er(e)}xl(n)}function Zs(n){n.g&&(ai(n),n.g.cancel(),n.g=null)}function bl(n){Zs(n),n.u&&(q.clearTimeout(n.u),n.u=null),Xs(n),n.i.cancel(),n.m&&("number"==typeof n.m&&q.clearTimeout(n.m),n.m=null)}function Qa(n,e){n.l.push(new class{constructor(n,e){this.h=n,this.g=e}}(n.Za++,e)),3==n.G&&Ys(n)}function Ys(n){ml(n.i)||n.m||(n.m=!0,Da(n.Ha,n),n.C=0)}function eu(n,e){var t;t=e?e.m:n.V++;const r=St(n.F);re(r,"SID",n.J),re(r,"RID",t),re(r,"AID",n.U),wn(n,r),n.o&&n.s&&ri(r,n.o,n.s),t=new Zr(n,n.h,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.l=e.D.concat(n.l)),e=Tl(n,t,1e3),t.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),za(n.i,t),Yr(t,r,e)}function wn(n,e){n.j&&ja({},function(t,r){re(e,r,t)})}function Tl(n,e,t){t=Math.min(n.l.length,t);var r=n.j?Me(n.j.Oa,n.j,n):null;e:{var i=n.l;let s=-1;for(;;){const u=["count="+t];-1==s?0<t?(s=i[0].h,u.push("ofs="+s)):s=0:u.push("ofs="+s);let d=!0;for(let h=0;h<t;h++){let p=i[h].h;const _=i[h].g;if(p-=s,0>p)s=Math.max(0,i[h].h-100),d=!1;else try{Dh(_,u,"req"+p+"_")}catch(v){r&&r(_)}}if(d){r=u.join("&");break e}}}return n=n.l.splice(0,t),e.D=n,r}function Al(n){n.g||n.u||(n.Y=1,Da(n.Ga,n),n.A=0)}function oi(n){return!(n.g||n.u||3<=n.A||(n.Y++,n.u=$r(Me(n.Ga,n),Sl(n,n.A)),n.A++,0))}function ai(n){null!=n.B&&(q.clearTimeout(n.B),n.B=null)}function Cl(n){n.g=new Zr(n,n.h,"rpc",n.Y),null===n.o&&(n.g.H=n.s),n.g.O=0;var e=St(n.oa);re(e,"RID","rpc"),re(e,"SID",n.J),re(e,"CI",n.N?"0":"1"),re(e,"AID",n.U),wn(n,e),re(e,"TYPE","xmlhttp"),n.o&&n.s&&ri(e,n.o,n.s),n.K&&n.g.setTimeout(n.K);var t=n.g;n=n.la,t.K=1,t.v=zs(St(e)),t.s=null,t.U=!0,Gs(t,n)}function Xs(n){null!=n.v&&(q.clearTimeout(n.v),n.v=null)}function ui(n,e){var t=null;if(n.g==e){Xs(n),ai(n),n.g=null;var r=2}else{if(!Ka(n.i,e))return;t=e.D,_l(n.i,e),r=1}if(n.I=e.N,0!=n.G)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var i=n.C;ke(r=Wn(),new il(r,t,e,i)),Ys(n)}else Al(n);else if(3==(i=e.o)||0==i&&0<n.I||!(1==r&&function Fh(n,e){return!(gl(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.l=e.D.concat(n.l),0):1==n.G||2==n.G||n.C>=(n.Xa?0:n.Ya)||(n.m=$r(Me(n.Ha,n,e),Sl(n,n.C)),n.C++,0)))}(n,e)||2==r&&oi(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:bn(n,5);break;case 4:bn(n,10);break;case 3:bn(n,6);break;default:bn(n,2)}}function Sl(n,e){let t=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(t*=2),t*e}function bn(n,e){if(n.h.info("Error code "+e),2==e){var t=null;n.j&&(t=null);var r=Me(n.jb,n);t||(t=new Lt("//www.google.com/images/cleardot.gif"),q.location&&"http"==q.location.protocol||nr(t,"https"),zs(t)),function Mh(n,e){const t=new Kn;if(q.Image){const r=new Image;r.onload=Pt(ir,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Pt(ir,t,r,"TestLoadImage: error",!1,e),r.onabort=Pt(ir,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Pt(ir,t,r,"TestLoadImage: timeout",!1,e),q.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Be(2);n.G=0,n.j&&n.j.va(e),xl(n),bl(n)}function xl(n){n.G=0,n.I=-1,n.j&&((0!=Wa(n.i).length||0!=n.l.length)&&(n.i.i.length=0,Vc(n.l),n.l.length=0),n.j.ua())}function tu(n,e,t){let r=function cl(n){return n instanceof Lt?St(n):new Lt(n,void 0)}(t);if(""!=r.i)e&&Ks(r,e+"."+r.i),Jr(r,r.m);else{const i=q.location;r=function Ha(n,e,t,r){var i=new Lt(null,void 0);return n&&nr(i,n),e&&Ks(i,e),t&&Jr(i,t),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,t)}return n.aa&&Ur(n.aa,function(i,s){re(r,s,i)}),t=n.sa,(e=n.D)&&t&&re(r,e,t),re(r,"VER",n.ma),wn(n,r),r}function Dl(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new le(t&&n.Ba&&!n.qa?new ti({ib:!0}):n.qa)).L=n.H,e}function Ml(){}function Js(){if(jn&&!(10<=Number(ye)))throw Error("Environmental error: no available transport.")}function et(n,e){Ae.call(this),this.g=new wl(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.P=n,(n=e&&e.httpHeadersOverwriteParam)&&!ya(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ya(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Tn(this)}function ar(n){zr.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function kl(){Va.call(this),this.status=1}function Tn(n){this.g=n}(F=le.prototype).ea=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Wr.g(),this.C=function sl(n){return n.h||(n.h=n.i())}(this.u?this.u:Wr),this.g.onreadystatechange=Me(this.Fa,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(s){return void Xt(this,s)}n=t||"";const i=new tr(this.headers);r&&ja(r,function(s,u){i.set(u,s)}),r=function km(n){e:{var e=Nm;const t=n.length,r="string"==typeof n?n.split(""):n;for(let i=0;i<t;i++)if(i in r&&e.call(void 0,r[i],i,n)){e=i;break e}e=-1}return 0>e?null:"string"==typeof n?n.charAt(e):n[e]}(i.T()),t=q.FormData&&n instanceof q.FormData,!(0<=Fc(Rh,e))||r||t||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(s,u){this.g.setRequestHeader(u,s)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Il(this),0<this.B&&((this.K=function Oh(n){return jn&&function hh(){return function Ia(n){var e=dh;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=ch(String(wa)).split("."),t=ch("9").split("."),r=Math.max(e.length,t.length);for(let u=0;0==n&&u<r;u++){var i=e[u]||"",s=t[u]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;n=Uc(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Uc(0==i[2].length,0==s[2].length)||Uc(i[2],s[2]),i=i[3],s=s[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Me(this.pa,this)):this.A=Na(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Xt(this,s)}},F.pa=function(){void 0!==pa&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ke(this,"timeout"),this.abort(8))},F.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ke(this,"complete"),ke(this,"abort"),or(this))},F.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),or(this,!0)),le.Z.M.call(this)},F.Fa=function(){this.s||(this.F||this.v||this.l?vl(this):this.cb())},F.cb=function(){vl(this)},F.ba=function(){try{return 2<pt(this)?this.g.status:-1}catch(n){return-1}},F.ga=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},F.Qa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),kh(e)}},F.Da=function(){return this.m},F.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(F=wl.prototype).ma=8,F.G=1,F.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch(e){}},F.Ha=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const i=new Zr(this,this.h,n,void 0);let s=this.s;if(this.P&&(s?(s=Bc(s),jc(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var e=0,t=0;t<this.l.length;t++){var r=this.l[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.l.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Tl(this,i,e),re(t=St(this.F),"RID",n),re(t,"CVER",22),this.D&&re(t,"X-HTTP-Session-Id",this.D),wn(this,t),this.o&&s&&ri(t,this.o,s),za(this.i,i),this.Ra&&re(t,"TYPE","init"),this.ja?(re(t,"$req",e),re(t,"SID","null"),i.$=!0,Yr(i,t,null)):Yr(i,t,e),this.G=2}}else 3==this.G&&(n?eu(this,n):0==this.l.length||ml(this.i)||eu(this))},F.Ga=function(){if(this.u=null,Cl(this),this.$&&!(this.L||null==this.g||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=$r(Me(this.bb,this),n)}},F.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Be(10),Zs(this),Cl(this))},F.ab=function(){null!=this.v&&(this.v=null,Zs(this),oi(this),Be(19))},F.jb=function(n){n?(this.h.info("Successfully pinged google.com"),Be(2)):(this.h.info("Failed to ping google.com"),Be(1))},(F=Ml.prototype).xa=function(){},F.wa=function(){},F.va=function(){},F.ua=function(){},F.Oa=function(){},Js.prototype.g=function(n,e){return new et(n,e)},be(et,Ae),et.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),Da(Me(n.hb,n,e))),Be(0),n.W=e,n.aa=t||{},n.N=n.X,n.F=tu(n,null,n.W),Ys(n)},et.prototype.close=function(){si(this.g)},et.prototype.u=function(n){if("string"==typeof n){var e={};e.__data__=n,Qa(this.g,e)}else this.v?((e={}).__data__=xa(n),Qa(this.g,e)):Qa(this.g,n)},et.prototype.M=function(){this.g.j=null,delete this.j,si(this.g),delete this.g,et.Z.M.call(this)},be(ar,zr),be(kl,Va),be(Tn,Ml),Tn.prototype.xa=function(){ke(this.g,"a")},Tn.prototype.wa=function(n){ke(this.g,new ar(n))},Tn.prototype.va=function(n){ke(this.g,new kl(n))},Tn.prototype.ua=function(){ke(this.g,"b")},Js.prototype.createWebChannel=Js.prototype.g,et.prototype.send=et.prototype.u,et.prototype.open=et.prototype.m,et.prototype.close=et.prototype.close,Yn.NO_ERROR=0,Yn.TIMEOUT=8,Yn.HTTP_ERROR=6,Fa.COMPLETE="complete",Bs.EventType=Kr,Kr.OPEN="a",Kr.CLOSE="b",Kr.ERROR="c",Kr.MESSAGE="d",Ae.prototype.listen=Ae.prototype.N,le.prototype.listenOnce=le.prototype.O,le.prototype.getLastError=le.prototype.La,le.prototype.getLastErrorCode=le.prototype.Da,le.prototype.getStatus=le.prototype.ba,le.prototype.getResponseJson=le.prototype.Qa,le.prototype.getResponseText=le.prototype.ga,le.prototype.send=le.prototype.ea;var Lh=Ot.createWebChannelTransport=function(){return new Js},Vh=Ot.getStatEventTarget=function(){return Wn()},nu=Ot.ErrorCode=Yn,Uh=Ot.EventType=Fa,Nl=Ot.Event=Ft,Qs=Ot.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},ru=Ot.FetchXmlHttpFactory=ti,ci=Ot.WebChannel=Bs,Bh=Ot.XhrIo=le;const eo="@firebase/firestore";class Ce{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ce.UNAUTHENTICATED=new Ce(null),Ce.GOOGLE_CREDENTIALS=new Ce("google-credentials-uid"),Ce.FIRST_PARTY=new Ce("first-party-uid"),Ce.MOCK_USER=new Ce("mock-user");let Se="9.9.2";const ot=new At.Yd("@firebase/firestore");function to(){return ot.logLevel}function M(n,...e){if(ot.logLevel<=At.in.DEBUG){const t=e.map(no);ot.debug(`Firestore (${Se}): ${n}`,...t)}}function oe(n,...e){if(ot.logLevel<=At.in.ERROR){const t=e.map(no);ot.error(`Firestore (${Se}): ${n}`,...t)}}function An(n,...e){if(ot.logLevel<=At.in.WARN){const t=e.map(no);ot.warn(`Firestore (${Se}): ${n}`,...t)}}function no(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function V(n="Unexpected state"){const e=`FIRESTORE (${Se}) INTERNAL ASSERTION FAILED: `+n;throw oe(e),new Error(e)}function G(n,e){n||V()}function O(n,e){return n}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class D extends W.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ve{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Ge{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class iu{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ce.UNAUTHENTICATED))}shutdown(){}}class su{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class jh{constructor(e){this.t=e,this.currentUser=Ce.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=p=>this.i!==i?(i=this.i,t(p)):Promise.resolve();let u=new ve;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new ve,e.enqueueRetryable(()=>s(this.currentUser))};const d=()=>{const p=u;e.enqueueRetryable((0,x.Z)(function*(){yield p.promise,yield s(r.currentUser)}))},h=p=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=p,this.auth.addAuthTokenListener(this.o),d()};this.t.onInit(p=>h(p)),setTimeout(()=>{if(!this.auth){const p=this.t.getImmediate({optional:!0});p?h(p):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new ve)}},0),d()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(G("string"==typeof r.accessToken),new Ge(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return G(null===e||"string"==typeof e),new Ce(e)}}class Vt{constructor(e,t,r){this.type="FirstParty",this.user=Ce.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const i=e.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}}class li{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new Vt(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(Ce.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ou{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ol{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const r=s=>{null!=s.error&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const u=s.token!==this.p;return this.p=s.token,M("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.g.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.g.getImmediate({optional:!0});s?i(s):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G("string"==typeof t.token),this.p=t.token,new ou(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function au(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Pl{static I(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=au(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function H(n,e){return n<e?-1:n>e?1:0}function ur(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Fl(n){return n+"\0"}class c{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return c.fromMillis(Date.now())}static fromDate(e){return c.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new c(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?H(this.nanoseconds,e.nanoseconds):H(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class o{constructor(e){this.timestamp=e}static fromTimestamp(e){return new o(e)}static min(){return new o(new c(0,0))}static max(){return new o(new c(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class a{constructor(e,t,r){void 0===t?t=0:t>e.length&&V(),void 0===r?r=e.length-t:r>e.length-t&&V(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===a.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof a?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),u=t.get(i);if(s<u)return-1;if(s>u)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class l extends a{construct(e,t,r){return new l(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new D(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new l(t)}static emptyPath(){return new l([])}}const m=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class g extends a{construct(e,t,r){return new g(e,t,r)}static isValidIdentifier(e){return m.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),g.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new g(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new D(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let u=!1;for(;i<e.length;){const d=e[i];if("\\"===d){if(i+1===e.length)throw new D(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new D(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else"`"===d?(u=!u,i++):"."!==d||u?(r+=d,i++):(s(),i++)}if(s(),u)throw new D(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new g(t)}static emptyPath(){return new g([])}}class y{constructor(e){this.path=e}static fromPath(e){return new y(l.fromString(e))}static fromName(e){return new y(l.fromString(e).popFirst(5))}static empty(){return new y(l.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===l.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return l.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new y(new l(e.slice()))}}class T{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function N(n){return n.fields.find(e=>2===e.kind)}function P(n){return n.fields.filter(e=>2!==e.kind)}T.UNKNOWN_ID=-1;class U{constructor(e,t){this.fieldPath=e,this.kind=t}}class je{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new je(0,qe.min())}}function di(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=o.fromTimestamp(1e9===r?new c(t+1,0):new c(t,r));return new qe(i,y.empty(),e)}function uu(n){return new qe(n.readTime,n.key,-1)}class qe{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new qe(o.min(),y.empty(),-1)}static max(){return new qe(o.max(),y.empty(),-1)}}function ro(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=y.comparator(n.documentKey,e.documentKey),0!==t?t:H(n.largestBatchId,e.largestBatchId))}const cu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class io{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Ut(n){return so.apply(this,arguments)}function so(){return so=(0,x.Z)(function*(n){if(n.code!==C.FAILED_PRECONDITION||n.message!==cu)throw n;M("LocalStore","Unexpectedly lost primary lease")}),so.apply(this,arguments)}class w{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&V(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new w((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof w?t:w.resolve(t)}catch(t){return w.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):w.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):w.reject(t)}static resolve(e){return new w((t,r)=>{t(e)})}static reject(e){return new w((t,r)=>{r(e)})}static waitFor(e){return new w((t,r)=>{let i=0,s=0,u=!1;e.forEach(d=>{++i,d.next(()=>{++s,u&&s===i&&t()},h=>r(h))}),u=!0,s===i&&t()})}static or(e){let t=w.resolve(!1);for(const r of e)t=t.next(i=>i?w.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new w((r,i)=>{const s=e.length,u=new Array(s);let d=0;for(let h=0;h<s;h++){const p=h;t(e[p]).next(_=>{u[p]=_,++d,d===s&&r(u)},_=>i(_))}})}static doWhile(e,t){return new w((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class hi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.T=new ve,this.transaction.oncomplete=()=>{this.T.resolve()},this.transaction.onabort=()=>{t.error?this.T.reject(new fi(e,t.error)):this.T.resolve()},this.transaction.onerror=r=>{const i=qh(r.target.error);this.T.reject(new fi(e,i))}}static open(e,t,r,i){try{return new hi(t,e.transaction(i,r))}catch(s){throw new fi(t,s)}}get A(){return this.T.promise}abort(e){e&&this.T.reject(e),this.aborted||(M("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}R(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new eI(t)}}class mt{constructor(e,t,r){this.name=e,this.version=t,this.P=r,12.2===mt.v((0,W.z$)())&&oe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return M("SimpleDb","Removing database:",e),pi(window.indexedDB.deleteDatabase(e)).toPromise()}static V(){if(!(0,W.hl)())return!1;if(mt.S())return!0;const e=(0,W.z$)(),t=mt.v(e),r=0<t&&t<10,i=mt.D(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static S(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.C)}static N(e,t){return e.store(t)}static v(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static D(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}k(e){var t=this;return(0,x.Z)(function*(){return t.db||(M("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=u=>{r(u.target.result)},s.onblocked=()=>{i(new fi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=u=>{const d=u.target.error;i("VersionError"===d.name?new D(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===d.name?new D(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d):new fi(e,d))},s.onupgradeneeded=u=>{M("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',u.oldVersion),t.P.M(u.target.result,s.transaction,u.oldVersion,t.version).next(()=>{M("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.O&&(t.db.onversionchange=r=>t.O(r)),t.db})()}F(e){this.O=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,x.Z)(function*(){const u="readonly"===t;let d=0;for(;;){++d;try{s.db=yield s.k(e);const h=hi.open(s.db,e,u?"readonly":"readwrite",r),p=i(h).next(_=>(h.R(),_)).catch(_=>(h.abort(_),w.reject(_))).toPromise();return p.catch(()=>{}),yield h.A,p}catch(h){const p=h,_="FirebaseError"!==p.name&&d<3;if(M("SimpleDb","Transaction failed with error:",p.message,"Retrying:",_),s.close(),!_)return Promise.reject(p)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class lu{constructor(e){this.$=e,this.B=!1,this.L=null}get isDone(){return this.B}get U(){return this.L}set cursor(e){this.$=e}done(){this.B=!0}q(e){this.L=e}delete(){return pi(this.$.delete())}}class fi extends D{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function cr(n){return"IndexedDbTransactionError"===n.name}class eI{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(M("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(M("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),pi(r)}add(e){return M("SimpleDb","ADD",this.store.name,e,e),pi(this.store.add(e))}get(e){return pi(this.store.get(e)).next(t=>(void 0===t&&(t=null),M("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return M("SimpleDb","DELETE",this.store.name,e),pi(this.store.delete(e))}count(){return M("SimpleDb","COUNT",this.store.name),pi(this.store.count())}K(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.G(i,(u,d)=>{s.push(d)}).next(()=>s)}{const i=this.store.getAll(r.range);return new w((s,u)=>{i.onerror=d=>{u(d.target.error)},i.onsuccess=d=>{s(d.target.result)}})}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new w((i,s)=>{r.onerror=u=>{s(u.target.error)},r.onsuccess=u=>{i(u.target.result)}})}W(e,t){M("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const i=this.cursor(r);return this.G(i,(s,u,d)=>d.delete())}J(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Y(e){const t=this.cursor({});return new w((r,i)=>{t.onerror=s=>{const u=qh(s.target.error);i(u)},t.onsuccess=s=>{const u=s.target.result;u?e(u.primaryKey,u.value).next(d=>{d?u.continue():r()}):r()}})}G(e,t){const r=[];return new w((i,s)=>{e.onerror=u=>{s(u.target.error)},e.onsuccess=u=>{const d=u.target.result;if(!d)return void i();const h=new lu(d),p=t(d.primaryKey,d.value,h);if(p instanceof w){const _=p.catch(v=>(h.done(),w.reject(v)));r.push(_)}h.isDone?i():null===h.U?d.continue():d.continue(h.U)}}).next(()=>w.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function pi(n){return new w((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=qh(r.target.error);t(i)}})}let Om=!1;function qh(n){const e=mt.v((0,W.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Om||(Om=!0,setTimeout(()=>{throw r},0)),r}}return n}class tI{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.Z(15)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}Z(e){var t=this;M("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,x.Z)(function*(){t.task=null;try{M("IndexBackiller",`Documents written: ${yield t.X.tt()}`)}catch(r){cr(r)?M("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield Ut(r)}yield t.Z(1)}))}}class nI{constructor(e,t){this.localStore=e,this.persistence=t}tt(e=50){var t=this;return(0,x.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.et(r,e))})()}et(e,t){const r=new Set;let i=t,s=!0;return w.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(u=>{if(null!==u&&!r.has(u))return M("IndexBackiller",`Processing collection: ${u}`),this.nt(e,u,i).next(d=>{i-=d,r.add(u)});s=!1})).next(()=>t-i)}nt(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const u=s.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next(()=>this.st(i,s)).next(d=>(M("IndexBackiller",`Updating offset: ${d}`),this.localStore.indexManager.updateCollectionGroup(e,t,d))).next(()=>u.size)}))}st(e,t){let r=e;return t.changes.forEach((i,s)=>{const u=uu(s);ro(u,r)>0&&(r=u)}),new qe(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class at{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.it(r),this.rt=r=>t.writeSequenceNumber(r))}it(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.rt&&this.rt(e),e}}function Pm(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function mi(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Fm(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}at.ot=-1;class fe{constructor(e,t){this.comparator=e,this.root=t||He.EMPTY}insert(e,t){return new fe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,He.BLACK,null,null))}remove(e){return new fe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,He.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ll(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ll(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ll(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ll(this.root,e,this.comparator,!0)}}class Ll{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class He{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=null!=r?r:He.RED,this.left=null!=i?i:He.EMPTY,this.right=null!=s?s:He.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new He(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return He.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return He.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,He.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,He.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw V();const e=this.left.check();if(e!==this.right.check())throw V();return e+(this.isRed()?0:1)}}He.EMPTY=null,He.RED=!0,He.BLACK=!1,He.EMPTY=new class{constructor(){this.size=0}get key(){throw V()}get value(){throw V()}get color(){throw V()}get left(){throw V()}get right(){throw V()}copy(n,e,t,r,i){return this}insert(n,e,t){return new He(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ne{constructor(e){this.comparator=e,this.data=new fe(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Lm(this.data.getIterator())}getIteratorFrom(e){return new Lm(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ne)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ne(this.comparator);return t.data=e,t}}class Lm{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function oo(n){return n.hasNext()?n.getNext():void 0}class gt{constructor(e){this.fields=e,e.sort(g.comparator)}static empty(){return new gt([])}unionWith(e){let t=new ne(g.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new gt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ur(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Ne{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Ne(t)}static fromUint8Array(e){const t=function(r){let i="";for(let s=0;s<r.length;++s)i+=String.fromCharCode(r[s]);return i}(e);return new Ne(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return H(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ne.EMPTY_BYTE_STRING=new Ne("");const iI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lr(n){if(G(!!n),"string"==typeof n){let e=0;const t=iI.exec(n);if(G(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:pe(n.seconds),nanos:pe(n.nanos)}}function pe(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function gi(n){return"string"==typeof n?Ne.fromBase64String(n):Ne.fromUint8Array(n)}function Hh(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Vm(n){const e=n.mapValue.fields.__previous_value__;return Hh(e)?Vm(e):e}function du(n){const e=lr(n.mapValue.fields.__local_write_time__.timestampValue);return new c(e.seconds,e.nanos)}class sI{constructor(e,t,r,i,s,u,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=u,this.autoDetectLongPolling=d,this.useFetchStreams=h}}class Cn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Cn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Cn&&e.projectId===this.projectId&&e.database===this.database}}function hu(n){return null==n}function fu(n){return 0===n&&1/n==-1/0}function Um(n){return"number"==typeof n&&Number.isInteger(n)&&!fu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const dr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Vl={nullValue:"NULL_VALUE"};function _i(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Hh(n)?4:qm(n)?9007199254740991:10:V()}function Jt(n,e){if(n===e)return!0;const t=_i(n);if(t!==_i(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return du(n).isEqual(du(e));case 3:return function(r,i){if("string"==typeof r.timestampValue&&"string"==typeof i.timestampValue&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const s=lr(r.timestampValue),u=lr(i.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return i=e,gi(n.bytesValue).isEqual(gi(i.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return pe(r.geoPointValue.latitude)===pe(i.geoPointValue.latitude)&&pe(r.geoPointValue.longitude)===pe(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return pe(r.integerValue)===pe(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const s=pe(r.doubleValue),u=pe(i.doubleValue);return s===u?fu(s)===fu(u):isNaN(s)&&isNaN(u)}return!1}(n,e);case 9:return ur(n.arrayValue.values||[],e.arrayValue.values||[],Jt);case 10:return function(r,i){const s=r.mapValue.fields||{},u=i.mapValue.fields||{};if(Pm(s)!==Pm(u))return!1;for(const d in s)if(s.hasOwnProperty(d)&&(void 0===u[d]||!Jt(s[d],u[d])))return!1;return!0}(n,e);default:return V()}var i}function pu(n,e){return void 0!==(n.values||[]).find(t=>Jt(t,e))}function hr(n,e){if(n===e)return 0;const t=_i(n),r=_i(e);if(t!==r)return H(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return H(n.booleanValue,e.booleanValue);case 2:return function(i,s){const u=pe(i.integerValue||i.doubleValue),d=pe(s.integerValue||s.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1}(n,e);case 3:return Bm(n.timestampValue,e.timestampValue);case 4:return Bm(du(n),du(e));case 5:return H(n.stringValue,e.stringValue);case 6:return function(i,s){const u=gi(i),d=gi(s);return u.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(i,s){const u=i.split("/"),d=s.split("/");for(let h=0;h<u.length&&h<d.length;h++){const p=H(u[h],d[h]);if(0!==p)return p}return H(u.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,s){const u=H(pe(i.latitude),pe(s.latitude));return 0!==u?u:H(pe(i.longitude),pe(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(i,s){const u=i.values||[],d=s.values||[];for(let h=0;h<u.length&&h<d.length;++h){const p=hr(u[h],d[h]);if(p)return p}return H(u.length,d.length)}(n.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===dr.mapValue&&s===dr.mapValue)return 0;if(i===dr.mapValue)return 1;if(s===dr.mapValue)return-1;const u=i.fields||{},d=Object.keys(u),h=s.fields||{},p=Object.keys(h);d.sort(),p.sort();for(let _=0;_<d.length&&_<p.length;++_){const v=H(d[_],p[_]);if(0!==v)return v;const E=hr(u[d[_]],h[p[_]]);if(0!==E)return E}return H(d.length,p.length)}(n.mapValue,e.mapValue);default:throw V()}}function Bm(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return H(n,e);const t=lr(n),r=lr(e),i=H(t.seconds,r.seconds);return 0!==i?i:H(t.nanos,r.nanos)}function ao(n){return $h(n)}function $h(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const i=lr(r);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?gi(n.bytesValue).toBase64():"referenceValue"in n?y.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let i="[",s=!0;for(const u of r.values||[])s?s=!1:i+=",",i+=$h(u);return i+"]"}(n.arrayValue):"mapValue"in n?function(r){const i=Object.keys(r.fields||{}).sort();let s="{",u=!0;for(const d of i)u?u=!1:s+=",",s+=`${d}:${$h(r.fields[d])}`;return s+"}"}(n.mapValue):V();var e}function yi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Kh(n){return!!n&&"integerValue"in n}function mu(n){return!!n&&"arrayValue"in n}function Gm(n){return!!n&&"nullValue"in n}function jm(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ul(n){return!!n&&"mapValue"in n}function gu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return mi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=gu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=gu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function qm(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function oI(n){return"nullValue"in n?Vl:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?yi(Cn.empty(),y.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:V()}function aI(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?yi(Cn.empty(),y.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?dr:V()}function Hm(n,e){const t=hr(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function $m(n,e){const t=hr(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class $e{constructor(e){this.value=e}static empty(){return new $e({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ul(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=gu(t)}setAll(e){let t=g.emptyPath(),r={},i=[];e.forEach((u,d)=>{if(!t.isImmediateParentOf(d)){const h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=d.popLast()}u?r[d.lastSegment()]=gu(u):i.push(d.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Ul(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Jt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ul(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){mi(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new $e(gu(this.value))}}function Km(n){const e=[];return mi(n.fields,(t,r)=>{const i=new g([t]);if(Ul(r)){const s=Km(r.mapValue).fields;if(0===s.length)e.push(i);else for(const u of s)e.push(i.child(u))}else e.push(i)}),new gt(e)}class ie{constructor(e,t,r,i,s,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.data=s,this.documentState=u}static newInvalidDocument(e){return new ie(e,0,o.min(),o.min(),$e.empty(),0)}static newFoundDocument(e,t,r){return new ie(e,1,t,o.min(),r,0)}static newNoDocument(e,t){return new ie(e,2,t,o.min(),$e.empty(),0)}static newUnknownDocument(e,t){return new ie(e,3,t,o.min(),$e.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=$e.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=$e.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=o.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ie&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ie(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class uI{constructor(e,t=null,r=[],i=[],s=null,u=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=u,this.endAt=d,this.ut=null}}function zm(n,e=null,t=[],r=[],i=null,s=null,u=null){return new uI(n,e,t,r,i,s,u)}function vi(n){const e=O(n);if(null===e.ut){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>{return(i=r).field.canonicalString()+i.op.toString()+ao(i.value);var i}).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(i=r).field.canonicalString()+i.dir;var i}).join(","),hu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ao(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ao(r)).join(",")),e.ut=t}return e.ut}function _u(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!_I(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if((t=n.filters[i]).op!==(r=e.filters[i]).op||!t.field.isEqual(r.field)||!Jt(t.value,r.value))return!1;var t,r;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Jm(n.startAt,e.startAt)&&Jm(n.endAt,e.endAt)}function Bl(n){return y.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function Gl(n,e){return n.filters.filter(t=>t instanceof Ke&&t.field.isEqual(e))}function Wm(n,e,t){let r=Vl,i=!0;for(const s of Gl(n,e)){let u=Vl,d=!0;switch(s.op){case"<":case"<=":u=oI(s.value);break;case"==":case"in":case">=":u=s.value;break;case">":u=s.value,d=!1;break;case"!=":case"not-in":u=Vl}Hm({value:r,inclusive:i},{value:u,inclusive:d})<0&&(r=u,i=d)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];Hm({value:r,inclusive:i},{value:u,inclusive:t.inclusive})<0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}function Zm(n,e,t){let r=dr,i=!0;for(const s of Gl(n,e)){let u=dr,d=!0;switch(s.op){case">=":case">":u=aI(s.value),d=!1;break;case"==":case"in":case"<=":u=s.value;break;case"<":u=s.value,d=!1;break;case"!=":case"not-in":u=dr}$m({value:r,inclusive:i},{value:u,inclusive:d})>0&&(r=u,i=d)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];$m({value:r,inclusive:i},{value:u,inclusive:t.inclusive})>0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}class Ke extends class{}{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.ct(e,t,r):new lI(e,t,r):"array-contains"===t?new fI(e,r):"in"===t?new pI(e,r):"not-in"===t?new mI(e,r):"array-contains-any"===t?new gI(e,r):new Ke(e,t,r)}static ct(e,t,r){return"in"===t?new dI(e,r):new hI(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.at(hr(t,this.value)):null!==t&&_i(this.value)===_i(t)&&this.at(hr(t,this.value))}at(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return V()}}ht(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class lI extends Ke{constructor(e,t,r){super(e,t,r),this.key=y.fromName(r.referenceValue)}matches(e){const t=y.comparator(e.key,this.key);return this.at(t)}}class dI extends Ke{constructor(e,t){super(e,"in",t),this.keys=Ym(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class hI extends Ke{constructor(e,t){super(e,"not-in",t),this.keys=Ym(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ym(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>y.fromName(r.referenceValue))}class fI extends Ke{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return mu(t)&&pu(t.arrayValue,this.value)}}class pI extends Ke{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&pu(this.value.arrayValue,t)}}class mI extends Ke{constructor(e,t){super(e,"not-in",t)}matches(e){if(pu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!pu(this.value.arrayValue,t)}}class gI extends Ke{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!mu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>pu(this.value.arrayValue,r))}}class fr{constructor(e,t){this.position=e,this.inclusive=t}}class uo{constructor(e,t="asc"){this.field=e,this.dir=t}}function _I(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function Xm(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],u=n.position[i];if(r=s.field.isKeyField()?y.comparator(y.fromName(u.referenceValue),t.key):hr(u,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Jm(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Jt(n.position[t],e.position[t]))return!1;return!0}class Sn{constructor(e,t=null,r=[],i=[],s=null,u="F",d=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=u,this.startAt=d,this.endAt=h,this.lt=null,this.ft=null}}function Qm(n,e,t,r,i,s,u,d){return new Sn(n,e,t,r,i,s,u,d)}function co(n){return new Sn(n)}function eg(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function zh(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Wh(n){for(const e of n.filters)if(e.ht())return e.field;return null}function Zh(n){return null!==n.collectionGroup}function lo(n){const e=O(n);if(null===e.lt){e.lt=[];const t=Wh(e),r=zh(e);if(null!==t&&null===r)t.isKeyField()||e.lt.push(new uo(t)),e.lt.push(new uo(g.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.lt.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.lt.push(new uo(g.keyField(),s))}}}return e.lt}function ut(n){const e=O(n);if(!e.ft)if("F"===e.limitType)e.ft=zm(e.path,e.collectionGroup,lo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of lo(e))t.push(new uo(s.field,"desc"===s.dir?"asc":"desc"));const r=e.endAt?new fr(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new fr(e.startAt.position,e.startAt.inclusive):null;e.ft=zm(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e.ft}function jl(n,e,t){return new Sn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function yu(n,e){return _u(ut(n),ut(e))&&n.limitType===e.limitType}function tg(n){return`${vi(ut(n))}|lt:${n.limitType}`}function Yh(n){return`Query(target=${function cI(n){let e=n.path.canonicalString();return null!==n.collectionGroup&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(r=t).field.canonicalString()} ${r.op} ${ao(r.value)}`;var r}).join(", ")}]`),hu(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>{return`${(r=t).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>ao(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>ao(t)).join(",")),`Target(${e})`}(ut(n))}; limitType=${n.limitType})`}function Xh(n,e){return e.isFoundDocument()&&function(t,r){const i=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):y.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(n,e)&&function(t,r){for(const i of t.explicitOrderBy)if(!i.field.isKeyField()&&null===r.data.field(i.field))return!1;return!0}(n,e)&&function(t,r){for(const i of t.filters)if(!i.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(i,s,u){const d=Xm(i,s,u);return i.inclusive?d<=0:d<0}(t.startAt,lo(t),r)||t.endAt&&!function(i,s,u){const d=Xm(i,s,u);return i.inclusive?d>=0:d>0}(t.endAt,lo(t),r)));var t,r}function ng(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function rg(n){return(e,t)=>{let r=!1;for(const i of lo(n)){const s=yI(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function yI(n,e,t){const r=n.field.isKeyField()?y.comparator(e.key,t.key):function(i,s,u){const d=s.data.field(i),h=u.data.field(i);return null!==d&&null!==h?hr(d,h):V()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return V()}}function ig(n,e){if(n.dt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fu(e)?"-0":e}}function sg(n){return{integerValue:""+n}}function og(n,e){return Um(e)?sg(e):ig(n,e)}class ql{constructor(){this._=void 0}}function vI(n,e,t){return n instanceof ho?function(r,i){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(s.fields.__previous_value__=i),{mapValue:s}}(t,e):n instanceof Ii?ug(n,e):n instanceof Ei?cg(n,e):function(r,i){const s=ag(r,i),u=lg(s)+lg(r._t);return Kh(s)&&Kh(r._t)?sg(u):ig(r.wt,u)}(n,e)}function II(n,e,t){return n instanceof Ii?ug(n,e):n instanceof Ei?cg(n,e):t}function ag(n,e){return n instanceof fo?Kh(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class ho extends ql{}class Ii extends ql{constructor(e){super(),this.elements=e}}function ug(n,e){const t=dg(e);for(const r of n.elements)t.some(i=>Jt(i,r))||t.push(r);return{arrayValue:{values:t}}}class Ei extends ql{constructor(e){super(),this.elements=e}}function cg(n,e){let t=dg(e);for(const r of n.elements)t=t.filter(i=>!Jt(i,r));return{arrayValue:{values:t}}}class fo extends ql{constructor(e,t){super(),this.wt=e,this._t=t}}function lg(n){return pe(n.integerValue||n.doubleValue)}function dg(n){return mu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class vu{constructor(e,t){this.field=e,this.transform=t}}class wI{constructor(e,t){this.version=e,this.transformResults=t}}class de{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new de}static exists(e){return new de(void 0,e)}static updateTime(e){return new de(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Hl(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class $l{}function hg(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new mo(n.key,de.none()):new po(n.key,n.data,de.none());{const t=n.data,r=$e.empty();let i=new ne(g.comparator);for(let s of e.fields)if(!i.has(s)){let u=t.field(s);null===u&&s.length>1&&(s=s.popLast(),u=t.field(s)),null===u?r.delete(s):r.set(s,u),i=i.add(s)}return new xn(n.key,r,new gt(i.toArray()),de.none())}}function bI(n,e,t){n instanceof po?function(r,i,s){const u=r.value.clone(),d=mg(r.fieldTransforms,i,s.transformResults);u.setAll(d),i.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(n,e,t):n instanceof xn?function(r,i,s){if(!Hl(r.precondition,i))return void i.convertToUnknownDocument(s.version);const u=mg(r.fieldTransforms,i,s.transformResults),d=i.data;d.setAll(pg(r)),d.setAll(u),i.convertToFoundDocument(s.version,d).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Iu(n,e,t,r){return n instanceof po?function(i,s,u,d){if(!Hl(i.precondition,s))return u;const h=i.value.clone(),p=gg(i.fieldTransforms,d,s);return h.setAll(p),s.convertToFoundDocument(s.version,h).setHasLocalMutations(),null}(n,e,t,r):n instanceof xn?function(i,s,u,d){if(!Hl(i.precondition,s))return u;const h=gg(i.fieldTransforms,d,s),p=s.data;return p.setAll(pg(i)),p.setAll(h),s.convertToFoundDocument(s.version,p).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(_=>_.field))}(n,e,t,r):(u=t,Hl(n.precondition,s=e)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u);var s,u}function TI(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=ag(r.transform,i||null);null!=s&&(null===t&&(t=$e.empty()),t.set(r.field,s))}return t||null}function fg(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&ur(t,r,(i,s)=>function EI(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof Ii&&r instanceof Ii||t instanceof Ei&&r instanceof Ei?ur(t.elements,r.elements,Jt):t instanceof fo&&r instanceof fo?Jt(t._t,r._t):t instanceof ho&&r instanceof ho);var t,r}(i,s))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class po extends $l{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class xn extends $l{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function pg(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function mg(n,e,t){const r=new Map;G(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],u=s.transform,d=e.data.field(s.field);r.set(s.field,II(u,d,t[i]))}return r}function gg(n,e,t){const r=new Map;for(const i of n){const s=i.transform,u=t.data.field(i.field);r.set(i.field,vI(s,u,e))}return r}class mo extends $l{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Jh extends $l{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class AI{constructor(e){this.count=e}}var xe,ee;function _g(n){switch(n){default:return V();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0}}function yg(n){if(void 0===n)return oe("GRPC error has no .code"),C.UNKNOWN;switch(n){case xe.OK:return C.OK;case xe.CANCELLED:return C.CANCELLED;case xe.UNKNOWN:return C.UNKNOWN;case xe.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case xe.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case xe.INTERNAL:return C.INTERNAL;case xe.UNAVAILABLE:return C.UNAVAILABLE;case xe.UNAUTHENTICATED:return C.UNAUTHENTICATED;case xe.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case xe.NOT_FOUND:return C.NOT_FOUND;case xe.ALREADY_EXISTS:return C.ALREADY_EXISTS;case xe.PERMISSION_DENIED:return C.PERMISSION_DENIED;case xe.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case xe.ABORTED:return C.ABORTED;case xe.OUT_OF_RANGE:return C.OUT_OF_RANGE;case xe.UNIMPLEMENTED:return C.UNIMPLEMENTED;case xe.DATA_LOSS:return C.DATA_LOSS;default:return V()}}(ee=xe||(xe={}))[ee.OK=0]="OK",ee[ee.CANCELLED=1]="CANCELLED",ee[ee.UNKNOWN=2]="UNKNOWN",ee[ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ee[ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ee[ee.NOT_FOUND=5]="NOT_FOUND",ee[ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",ee[ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",ee[ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",ee[ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ee[ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ee[ee.ABORTED=10]="ABORTED",ee[ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",ee[ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",ee[ee.INTERNAL=13]="INTERNAL",ee[ee.UNAVAILABLE=14]="UNAVAILABLE",ee[ee.DATA_LOSS=15]="DATA_LOSS";class pr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){mi(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Fm(this.inner)}size(){return this.innerSize}}const CI=new fe(y.comparator);function ct(){return CI}const vg=new fe(y.comparator);function Eu(...n){let e=vg;for(const t of n)e=e.insert(t.key,t);return e}function Ig(n){let e=vg;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Qt(){return wu()}function Eg(){return wu()}function wu(){return new pr(n=>n.toString(),(n,e)=>n.isEqual(e))}const SI=new fe(y.comparator),xI=new ne(y.comparator);function K(...n){let e=xI;for(const t of n)e=e.add(t);return e}const DI=new ne(H);function Kl(){return DI}class bu{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t){const r=new Map;return r.set(e,Tu.createSynthesizedTargetChangeForCurrentChange(e,t)),new bu(o.min(),r,Kl(),ct(),K())}}class Tu{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t){return new Tu(Ne.EMPTY_BYTE_STRING,t,K(),K(),K())}}class zl{constructor(e,t,r,i){this.gt=e,this.removedTargetIds=t,this.key=r,this.yt=i}}class wg{constructor(e,t){this.targetId=e,this.It=t}}class bg{constructor(e,t,r=Ne.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Tg{constructor(){this.Tt=0,this.Et=Cg(),this.At=Ne.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return 0!==this.Tt}get vt(){return this.bt}Vt(e){e.approximateByteSize()>0&&(this.bt=!0,this.At=e)}St(){let e=K(),t=K(),r=K();return this.Et.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:V()}}),new Tu(this.At,this.Rt,e,t,r)}Dt(){this.bt=!1,this.Et=Cg()}Ct(e,t){this.bt=!0,this.Et=this.Et.insert(e,t)}xt(e){this.bt=!0,this.Et=this.Et.remove(e)}Nt(){this.Tt+=1}kt(){this.Tt-=1}Mt(){this.bt=!0,this.Rt=!0}}class MI{constructor(e){this.Ot=e,this.Ft=new Map,this.$t=ct(),this.Bt=Ag(),this.Lt=new ne(H)}Ut(e){for(const t of e.gt)e.yt&&e.yt.isFoundDocument()?this.qt(t,e.yt):this.Kt(t,e.key,e.yt);for(const t of e.removedTargetIds)this.Kt(t,e.key,e.yt)}Gt(e){this.forEachTarget(e,t=>{const r=this.Qt(t);switch(e.state){case 0:this.jt(t)&&r.Vt(e.resumeToken);break;case 1:r.kt(),r.Pt||r.Dt(),r.Vt(e.resumeToken);break;case 2:r.kt(),r.Pt||this.removeTarget(t);break;case 3:this.jt(t)&&(r.Mt(),r.Vt(e.resumeToken));break;case 4:this.jt(t)&&(this.Wt(t),r.Vt(e.resumeToken));break;default:V()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ft.forEach((r,i)=>{this.jt(i)&&t(i)})}zt(e){const t=e.targetId,r=e.It.count,i=this.Ht(t);if(i){const s=i.target;if(Bl(s))if(0===r){const u=new y(s.path);this.Kt(t,u,ie.newNoDocument(u,o.min()))}else G(1===r);else this.Jt(t)!==r&&(this.Wt(t),this.Lt=this.Lt.add(t))}}Yt(e){const t=new Map;this.Ft.forEach((s,u)=>{const d=this.Ht(u);if(d){if(s.current&&Bl(d.target)){const h=new y(d.target.path);null!==this.$t.get(h)||this.Xt(u,h)||this.Kt(u,h,ie.newNoDocument(h,e))}s.vt&&(t.set(u,s.St()),s.Dt())}});let r=K();this.Bt.forEach((s,u)=>{let d=!0;u.forEachWhile(h=>{const p=this.Ht(h);return!p||2===p.purpose||(d=!1,!1)}),d&&(r=r.add(s))}),this.$t.forEach((s,u)=>u.setReadTime(e));const i=new bu(e,t,this.Lt,this.$t,r);return this.$t=ct(),this.Bt=Ag(),this.Lt=new ne(H),i}qt(e,t){if(!this.jt(e))return;const r=this.Xt(e,t.key)?2:0;this.Qt(e).Ct(t.key,r),this.$t=this.$t.insert(t.key,t),this.Bt=this.Bt.insert(t.key,this.Zt(t.key).add(e))}Kt(e,t,r){if(!this.jt(e))return;const i=this.Qt(e);this.Xt(e,t)?i.Ct(t,1):i.xt(t),this.Bt=this.Bt.insert(t,this.Zt(t).delete(e)),r&&(this.$t=this.$t.insert(t,r))}removeTarget(e){this.Ft.delete(e)}Jt(e){const t=this.Qt(e).St();return this.Ot.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Nt(e){this.Qt(e).Nt()}Qt(e){let t=this.Ft.get(e);return t||(t=new Tg,this.Ft.set(e,t)),t}Zt(e){let t=this.Bt.get(e);return t||(t=new ne(H),this.Bt=this.Bt.insert(e,t)),t}jt(e){const t=null!==this.Ht(e);return t||M("WatchChangeAggregator","Detected inactive target",e),t}Ht(e){const t=this.Ft.get(e);return t&&t.Pt?null:this.Ot.te(e)}Wt(e){this.Ft.set(e,new Tg),this.Ot.getRemoteKeysForTarget(e).forEach(t=>{this.Kt(e,t,null)})}Xt(e,t){return this.Ot.getRemoteKeysForTarget(e).has(t)}}function Ag(){return new fe(y.comparator)}function Cg(){return new fe(y.comparator)}const kI={asc:"ASCENDING",desc:"DESCENDING"},NI={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class RI{constructor(e,t){this.databaseId=e,this.dt=t}}function Au(n,e){return n.dt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Sg(n,e){return n.dt?e.toBase64():e.toUint8Array()}function OI(n,e){return Au(n,e.toTimestamp())}function Pe(n){return G(!!n),o.fromTimestamp(function(e){const t=lr(e);return new c(t.seconds,t.nanos)}(n))}function Qh(n,e){return(t=n,new l(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function xg(n){const e=l.fromString(n);return G(Lg(e)),e}function Cu(n,e){return Qh(n.databaseId,e.path)}function en(n,e){const t=xg(e);if(t.get(1)!==n.databaseId.projectId)throw new D(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new y(Mg(t))}function ef(n,e){return Qh(n.databaseId,e)}function Dg(n){const e=xg(n);return 4===e.length?l.emptyPath():Mg(e)}function Su(n){return new l(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Mg(n){return G(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function kg(n,e,t){return{name:Cu(n,e),fields:t.value.mapValue.fields}}function Ng(n,e,t){const r=en(n,e.name),i=Pe(e.updateTime),s=new $e({mapValue:{fields:e.fields}}),u=ie.newFoundDocument(r,i,s);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function xu(n,e){let t;if(e instanceof po)t={update:kg(n,e.key,e.value)};else if(e instanceof mo)t={delete:Cu(n,e.key)};else if(e instanceof xn)t={update:kg(n,e.key,e.data),updateMask:qI(e.fieldMask)};else{if(!(e instanceof Jh))return V();t={verify:Cu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,s){const u=s.transform;if(u instanceof ho)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Ii)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ei)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof fo)return{fieldPath:s.field.canonicalString(),increment:u._t};throw V()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:OI(n,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:V()),t;var i}function tf(n,e){const t=e.currentDocument?void 0!==(i=e.currentDocument).updateTime?de.updateTime(Pe(i.updateTime)):void 0!==i.exists?de.exists(i.exists):de.none():de.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,u){let d=null;"setToServerValue"in u?(G("REQUEST_TIME"===u.setToServerValue),d=new ho):"appendMissingElements"in u?d=new Ii(u.appendMissingElements.values||[]):"removeAllFromArray"in u?d=new Ei(u.removeAllFromArray.values||[]):"increment"in u?d=new fo(s,u.increment):V();const h=g.fromServerFormat(u.fieldPath);return new vu(h,d)}(n,i)):[];var i;if(e.update){const i=en(n,e.update.name),s=new $e({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=new gt((e.updateMask.fieldPaths||[]).map(p=>g.fromServerFormat(p)));return new xn(i,s,u,t,r)}return new po(i,s,t,r)}if(e.delete){const i=en(n,e.delete);return new mo(i,t)}if(e.verify){const i=en(n,e.verify);return new Jh(i,t)}return V()}function Rg(n,e){return{documents:[ef(n,e.path)]}}function Og(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=ef(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=ef(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(h){if(0===h.length)return;const p=h.map(_=>function(v){if("=="===v.op){if(jm(v.value))return{unaryFilter:{field:go(v.field),op:"IS_NAN"}};if(Gm(v.value))return{unaryFilter:{field:go(v.field),op:"IS_NULL"}}}else if("!="===v.op){if(jm(v.value))return{unaryFilter:{field:go(v.field),op:"IS_NOT_NAN"}};if(Gm(v.value))return{unaryFilter:{field:go(v.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:go(v.field),op:BI(v.op),value:v.value}}}(_));return 1===p.length?p[0]:{compositeFilter:{op:"AND",filters:p}}}(e.filters);i&&(t.structuredQuery.where=i);const s=function(h){if(0!==h.length)return h.map(p=>{return{field:go((_=p).field),direction:UI(_.dir)};var _})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=(p=e.limit,n.dt||hu(p)?p:{value:p});var p,d,h;return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(d=e.startAt).inclusive,values:d.position}),e.endAt&&(t.structuredQuery.endAt={before:!(h=e.endAt).inclusive,values:h.position}),t}function Pg(n){let e=Dg(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){G(1===r);const _=t.from[0];_.allDescendants?i=_.collectionId:e=e.child(_.collectionId)}let s=[];t.where&&(s=Fg(t.where));let u=[];t.orderBy&&(u=t.orderBy.map(_=>{return new uo(_o((v=_).field),function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction));var v}));let d=null;t.limit&&(d=function(_){let v;return v="object"==typeof _?_.value:_,hu(v)?null:v}(t.limit));let h=null;var _;t.startAt&&(h=new fr((_=t.startAt).values||[],!!_.before));let p=null;return t.endAt&&(p=function(_){return new fr(_.values||[],!_.before)}(t.endAt)),Qm(e,i,u,s,d,"F",h,p)}function Fg(n){return n?void 0!==n.unaryFilter?[jI(n)]:void 0!==n.fieldFilter?[GI(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(e=>Fg(e)).reduce((e,t)=>e.concat(t)):V():[]}function UI(n){return kI[n]}function BI(n){return NI[n]}function go(n){return{fieldPath:n.canonicalString()}}function _o(n){return g.fromServerFormat(n.fieldPath)}function GI(n){return Ke.create(_o(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return V()}}(n.fieldFilter.op),n.fieldFilter.value)}function jI(n){switch(n.unaryFilter.op){case"IS_NAN":const e=_o(n.unaryFilter.field);return Ke.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=_o(n.unaryFilter.field);return Ke.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=_o(n.unaryFilter.field);return Ke.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=_o(n.unaryFilter.field);return Ke.create(i,"!=",{nullValue:"NULL_VALUE"});default:return V()}}function qI(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Lg(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function tt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Vg(e)),e=HI(n.get(t),e);return Vg(e)}function HI(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Vg(n){return n+"\x01\x01"}function tn(n){const e=n.length;if(G(e>=2),2===e)return G("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),l.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const u=n.indexOf("\x01",s);switch((u<0||u>t)&&V(),n.charAt(u+1)){case"\x01":const d=n.substring(s,u);let h;0===i.length?h=d:(i+=d,h=i,i=""),r.push(h);break;case"\x10":i+=n.substring(s,u),i+="\0";break;case"\x11":i+=n.substring(s,u+1);break;default:V()}s=u+2}return new l(r)}const Ug=["userId","batchId"];function Wl(n,e){return[n,tt(e)]}function Bg(n,e,t){return[n,tt(e),t]}const $I={},KI=["prefixPath","collectionGroup","readTime","documentId"],zI=["prefixPath","collectionGroup","documentId"],WI=["collectionGroup","readTime","prefixPath","documentId"],ZI=["canonicalId","targetId"],YI=["targetId","path"],XI=["path","targetId"],JI=["collectionId","parent"],QI=["indexId","uid"],e0=["uid","sequenceNumber"],t0=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],n0=["indexId","uid","orderedDocumentKey"],r0=["userId","collectionPath","documentId"],s0=["userId","collectionPath","largestBatchId"],o0=["userId","collectionGroup","largestBatchId"],Gg=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],a0=[...Gg,"documentOverlays"],jg=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],qg=jg,u0=[...qg,"indexConfiguration","indexState","indexEntries"];class nf extends io{constructor(e,t){super(),this.ee=e,this.currentSequenceNumber=t}}function Fe(n,e){const t=O(n);return mt.N(t.ee,e)}class rf{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&bI(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Iu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Iu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Eg();return this.mutations.forEach(i=>{const s=e.get(i.key),u=s.overlayedDocument;let d=this.applyToLocalView(u,s.mutatedFields);d=t.has(i.key)?null:d;const h=hg(u,d);null!==h&&r.set(i.key,h),u.isValidDocument()||u.convertToNoDocument(o.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),K())}isEqual(e){return this.batchId===e.batchId&&ur(this.mutations,e.mutations,(t,r)=>fg(t,r))&&ur(this.baseMutations,e.baseMutations,(t,r)=>fg(t,r))}}class sf{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){G(e.mutations.length===r.length);let i=SI;const s=e.mutations;for(let u=0;u<s.length;u++)i=i.insert(s[u].key,r[u].version);return new sf(e,t,r,i)}}class af{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class mr{constructor(e,t,r,i,s=o.min(),u=o.min(),d=Ne.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=d}withSequenceNumber(e){return new mr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new mr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new mr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Hg{constructor(e){this.ne=e}}function $g(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Zl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Cu(i=n.ne,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:Au(i,s.version.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:wi(e.version)};else{if(!e.isUnknownDocument())return V();r.unknownDocument={path:t.path.toArray(),version:wi(e.version)}}var i,s;return r}function Zl(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function wi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function bi(n){const e=new c(n.seconds,n.nanoseconds);return o.fromTimestamp(e)}function Ti(n,e){const t=(e.baseMutations||[]).map(s=>tf(n.ne,s));for(let s=0;s<e.mutations.length-1;++s){const u=e.mutations[s];s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(u.updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s)}const r=e.mutations.map(s=>tf(n.ne,s)),i=c.fromMillis(e.localWriteTimeMs);return new rf(e.batchId,i,t,r)}function Du(n){const e=bi(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?bi(n.lastLimboFreeSnapshotVersion):o.min();let r;var i;return void 0!==n.query.documents?(G(1===(i=n.query).documents.length),r=ut(co(Dg(i.documents[0])))):r=ut(Pg(n.query)),new mr(r,n.targetId,0,n.lastListenSequenceNumber,e,t,Ne.fromBase64String(n.resumeToken))}function Kg(n,e){const t=wi(e.snapshotVersion),r=wi(e.lastLimboFreeSnapshotVersion);let i;i=Bl(e.target)?Rg(n.ne,e.target):Og(n.ne,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:vi(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function uf(n){const e=Pg({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?jl(e,e.limit,"L"):e}function cf(n,e){return new af(e.largestBatchId,tf(n.ne,e.overlayMutation))}function zg(n,e){const t=e.path.lastSegment();return[n,tt(e.path.popLast()),t]}function Wg(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:wi(r.readTime),documentKey:tt(r.documentKey.path),largestBatchId:r.largestBatchId}}class l0{getBundleMetadata(e,t){return Zg(e).get(t).next(r=>{if(r)return{id:(i=r).bundleId,createTime:bi(i.createTime),version:i.version};var i})}saveBundleMetadata(e,t){return Zg(e).put({bundleId:(r=t).id,createTime:wi(Pe(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return Yg(e).get(t).next(r=>{if(r)return{name:(i=r).name,query:uf(i.bundledQuery),readTime:bi(i.readTime)};var i})}saveNamedQuery(e,t){return Yg(e).put({name:(r=t).name,readTime:wi(Pe(r.readTime)),bundledQuery:r.bundledQuery});var r}}function Zg(n){return Fe(n,"bundles")}function Yg(n){return Fe(n,"namedQueries")}class Yl{constructor(e,t){this.wt=e,this.userId=t}static se(e,t){return new Yl(e,t.uid||"")}getOverlay(e,t){return Mu(e).get(zg(this.userId,t)).next(r=>r?cf(this.wt,r):null)}getOverlays(e,t){const r=Qt();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,u)=>{const d=new af(t,u);i.push(this.ie(e,d))}),w.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(u=>i.add(tt(u.getCollectionPath())));const s=[];return i.forEach(u=>{const d=IDBKeyRange.bound([this.userId,u,r],[this.userId,u,r+1],!1,!0);s.push(Mu(e).W("collectionPathOverlayIndex",d))}),w.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Qt(),s=tt(t),u=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Mu(e).K("collectionPathOverlayIndex",u).next(d=>{for(const h of d){const p=cf(this.wt,h);i.set(p.getKey(),p)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=Qt();let u;const d=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Mu(e).J({index:"collectionGroupOverlayIndex",range:d},(h,p,_)=>{const v=cf(this.wt,p);s.size()<i||v.largestBatchId===u?(s.set(v.getKey(),v),u=v.largestBatchId):_.done()}).next(()=>s)}ie(e,t){return Mu(e).put(function(r,i,s){const[u,d,h]=zg(i,s.mutation.key);return{userId:i,collectionPath:d,documentId:h,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:xu(r.ne,s.mutation)}}(this.wt,this.userId,t))}}function Mu(n){return Fe(n,"documentOverlays")}class Ai{constructor(){}re(e,t){this.oe(e,t),t.ue()}oe(e,t){if("nullValue"in e)this.ce(t,5);else if("booleanValue"in e)this.ce(t,10),t.ae(e.booleanValue?1:0);else if("integerValue"in e)this.ce(t,15),t.ae(pe(e.integerValue));else if("doubleValue"in e){const r=pe(e.doubleValue);isNaN(r)?this.ce(t,13):(this.ce(t,15),fu(r)?t.ae(0):t.ae(r))}else if("timestampValue"in e){const r=e.timestampValue;this.ce(t,20),"string"==typeof r?t.he(r):(t.he(`${r.seconds||""}`),t.ae(r.nanos||0))}else if("stringValue"in e)this.le(e.stringValue,t),this.fe(t);else if("bytesValue"in e)this.ce(t,30),t.de(gi(e.bytesValue)),this.fe(t);else if("referenceValue"in e)this._e(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.ce(t,45),t.ae(r.latitude||0),t.ae(r.longitude||0)}else"mapValue"in e?qm(e)?this.ce(t,Number.MAX_SAFE_INTEGER):(this.we(e.mapValue,t),this.fe(t)):"arrayValue"in e?(this.me(e.arrayValue,t),this.fe(t)):V()}le(e,t){this.ce(t,25),this.ge(e,t)}ge(e,t){t.he(e)}we(e,t){const r=e.fields||{};this.ce(t,55);for(const i of Object.keys(r))this.le(i,t),this.oe(r[i],t)}me(e,t){const r=e.values||[];this.ce(t,50);for(const i of r)this.oe(i,t)}_e(e,t){this.ce(t,37),y.fromName(e).path.forEach(r=>{this.ce(t,60),this.ge(r,t)})}ce(e,t){e.ae(t)}fe(e){e.ae(2)}}function d0(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function Xg(n){const e=64-function(t){let r=0;for(let i=0;i<8;++i){const s=d0(255&t[i]);if(r+=s,8!==s)break}return r}(n);return Math.ceil(e/8)}Ai.ye=new Ai;class h0{constructor(){this.buffer=new Uint8Array(1024),this.position=0}pe(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ie(r.value),r=t.next();this.Te()}Ee(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ae(r.value),r=t.next();this.Re()}be(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ie(r);else if(r<2048)this.Ie(960|r>>>6),this.Ie(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ie(480|r>>>12),this.Ie(128|63&r>>>6),this.Ie(128|63&r);else{const i=t.codePointAt(0);this.Ie(240|i>>>18),this.Ie(128|63&i>>>12),this.Ie(128|63&i>>>6),this.Ie(128|63&i)}}this.Te()}Pe(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ae(r);else if(r<2048)this.Ae(960|r>>>6),this.Ae(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ae(480|r>>>12),this.Ae(128|63&r>>>6),this.Ae(128|63&r);else{const i=t.codePointAt(0);this.Ae(240|i>>>18),this.Ae(128|63&i>>>12),this.Ae(128|63&i>>>6),this.Ae(128|63&i)}}this.Re()}ve(e){const t=this.Ve(e),r=Xg(t);this.Se(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}De(e){const t=this.Ve(e),r=Xg(t);this.Se(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Ce(){this.xe(255),this.xe(255)}Ne(){this.ke(255),this.ke(255)}reset(){this.position=0}seed(e){this.Se(e.length),this.buffer.set(e,this.position),this.position+=e.length}Me(){return this.buffer.slice(0,this.position)}Ve(e){const t=function(i){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,i,!1),new Uint8Array(s.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ie(e){const t=255&e;0===t?(this.xe(0),this.xe(255)):255===t?(this.xe(255),this.xe(0)):this.xe(t)}Ae(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(e)}Te(){this.xe(0),this.xe(1)}Re(){this.ke(0),this.ke(1)}xe(e){this.Se(1),this.buffer[this.position++]=e}ke(e){this.Se(1),this.buffer[this.position++]=~e}Se(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class f0{constructor(e){this.Oe=e}de(e){this.Oe.pe(e)}he(e){this.Oe.be(e)}ae(e){this.Oe.ve(e)}ue(){this.Oe.Ce()}}class p0{constructor(e){this.Oe=e}de(e){this.Oe.Ee(e)}he(e){this.Oe.Pe(e)}ae(e){this.Oe.De(e)}ue(){this.Oe.Ne()}}class ku{constructor(){this.Oe=new h0,this.Fe=new f0(this.Oe),this.$e=new p0(this.Oe)}seed(e){this.Oe.seed(e)}Be(e){return 0===e?this.Fe:this.$e}Me(){return this.Oe.Me()}reset(){this.Oe.reset()}}class Ci{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Le(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ci(this.indexId,this.documentKey,this.arrayValue,r)}}function Si(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=Jg(n.arrayValue,e.arrayValue),0!==t?t:(t=Jg(n.directionalValue,e.directionalValue),0!==t?t:y.comparator(n.documentKey,e.documentKey)))}function Jg(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class m0{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ue=e.orderBy,this.qe=[];for(const t of e.filters){const r=t;r.ht()?this.Ke=r:this.qe.push(r)}}Ge(e){const t=N(e);if(void 0!==t&&!this.Qe(t))return!1;const r=P(e);let i=0,s=0;for(;i<r.length&&this.Qe(r[i]);++i);if(i===r.length)return!0;if(void 0!==this.Ke){const u=r[i];if(!this.je(this.Ke,u)||!this.We(this.Ue[s++],u))return!1;++i}for(;i<r.length;++i){const u=r[i];if(s>=this.Ue.length||!this.We(this.Ue[s++],u))return!1}return!0}Qe(e){for(const t of this.qe)if(this.je(t,e))return!0;return!1}je(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}We(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class g0{constructor(){this.ze=new lf}addToCollectionParentIndex(e,t){return this.ze.add(t),w.resolve()}getCollectionParents(e,t){return w.resolve(this.ze.getEntries(t))}addFieldIndex(e,t){return w.resolve()}deleteFieldIndex(e,t){return w.resolve()}getDocumentsMatchingTarget(e,t){return w.resolve(null)}getIndexType(e,t){return w.resolve(0)}getFieldIndexes(e,t){return w.resolve([])}getNextCollectionGroupToUpdate(e){return w.resolve(null)}getMinOffset(e,t){return w.resolve(qe.min())}getMinOffsetFromCollectionGroup(e,t){return w.resolve(qe.min())}updateCollectionGroup(e,t,r){return w.resolve()}updateIndexEntries(e,t){return w.resolve()}}class lf{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ne(l.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ne(l.comparator)).toArray()}}const Xl=new Uint8Array(0);class _0{constructor(e,t){this.user=e,this.databaseId=t,this.He=new lf,this.Je=new pr(r=>vi(r),(r,i)=>_u(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.He.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.He.add(t)});const s={collectionId:r,parent:tt(i)};return Qg(e).put(s)}return w.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Fl(t),""],!1,!0);return Qg(e).K(i).next(s=>{for(const u of s){if(u.collectionId!==t)break;r.push(tn(u.parent))}return r})}addFieldIndex(e,t){const r=Jl(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(d=>[d.fieldPath.canonicalString(),d.kind])};var u;delete i.indexId;const s=r.add(i);if(t.indexState){const u=Ru(e);return s.next(d=>{u.put(Wg(d,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=Jl(e),i=Ru(e),s=Nu(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=Nu(e);let i=!0;const s=new Map;return w.forEach(this.Ye(t),u=>this.Xe(e,u).next(d=>{i&&(i=!!d),s.set(u,d)})).next(()=>{if(i){let u=K();const d=[];return w.forEach(s,(h,p)=>{var _;M("IndexedDbIndexManager",`Using index ${_=h,`id=${_.indexId}|cg=${_.collectionGroup}|f=${_.fields.map(J=>`${J.fieldPath}:${J.kind}`).join(",")}`} to execute ${vi(t)}`);const v=function(J,$){const z=N($);if(void 0===z)return null;for(const X of Gl(J,z.fieldPath))switch(X.op){case"array-contains-any":return X.value.arrayValue.values||[];case"array-contains":return[X.value]}return null}(p,h),E=function(J,$){const z=new Map;for(const X of P($))for(const Re of Gl(J,X.fieldPath))switch(Re.op){case"==":case"in":z.set(X.fieldPath.canonicalString(),Re.value);break;case"not-in":case"!=":return z.set(X.fieldPath.canonicalString(),Re.value),Array.from(z.values())}return null}(p,h),b=function(J,$){const z=[];let X=!0;for(const Re of P($)){const ec=0===Re.kind?Wm(J,Re.fieldPath,J.startAt):Zm(J,Re.fieldPath,J.startAt);z.push(ec.value),X&&(X=ec.inclusive)}return new fr(z,X)}(p,h),S=function(J,$){const z=[];let X=!0;for(const Re of P($)){const ec=0===Re.kind?Zm(J,Re.fieldPath,J.endAt):Wm(J,Re.fieldPath,J.endAt);z.push(ec.value),X&&(X=ec.inclusive)}return new fr(z,X)}(p,h),R=this.Ze(h,p,b),L=this.Ze(h,p,S),Y=this.tn(h,p,E),te=this.en(h.indexId,v,R,b.inclusive,L,S.inclusive,Y);return w.forEach(te,J=>r.j(J,t.limit).next($=>{$.forEach(z=>{const X=y.fromSegments(z.documentKey);u.has(X)||(u=u.add(X),d.push(X))})}))}).next(()=>d)}return w.resolve(null)})}Ye(e){let t=this.Je.get(e);return t||(t=[e],this.Je.set(e,t),t)}en(e,t,r,i,s,u,d){const h=(null!=t?t.length:1)*Math.max(r.length,s.length),p=h/(null!=t?t.length:1),_=[];for(let v=0;v<h;++v){const E=t?this.nn(t[v/p]):Xl,b=this.sn(e,E,r[v%p],i),S=this.rn(e,E,s[v%p],u),R=d.map(L=>this.sn(e,E,L,!0));_.push(...this.createRange(b,S,R))}return _}sn(e,t,r,i){const s=new Ci(e,y.empty(),t,r);return i?s:s.Le()}rn(e,t,r,i){const s=new Ci(e,y.empty(),t,r);return i?s.Le():s}Xe(e,t){const r=new m0(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let u=null;for(const d of s)r.Ge(d)&&(!u||d.fields.length>u.fields.length)&&(u=d);return u})}getIndexType(e,t){let r=2;return w.forEach(this.Ye(t),i=>this.Xe(e,i).next(s=>{s?0!==r&&s.fields.length<function(u){let d=new ne(g.comparator),h=!1;for(const p of u.filters){const _=p;_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?h=!0:d=d.add(_.field))}for(const p of u.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>r)}on(e,t){const r=new ku;for(const i of P(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const u=r.Be(i.kind);Ai.ye.re(s,u)}return r.Me()}nn(e){const t=new ku;return Ai.ye.re(e,t.Be(0)),t.Me()}un(e,t){const r=new ku;return Ai.ye.re(yi(this.databaseId,t),r.Be(function(i){const s=P(i);return 0===s.length?0:s[s.length-1].kind}(e))),r.Me()}tn(e,t,r){if(null===r)return[];let i=[];i.push(new ku);let s=0;for(const u of P(e)){const d=r[s++];for(const h of i)if(this.cn(t,u.fieldPath)&&mu(d))i=this.an(i,u,d);else{const p=h.Be(u.kind);Ai.ye.re(d,p)}}return this.hn(i)}Ze(e,t,r){return this.tn(e,t,r.position)}hn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Me();return t}an(e,t,r){const i=[...e],s=[];for(const u of r.arrayValue.values||[])for(const d of i){const h=new ku;h.seed(d.Me()),Ai.ye.re(u,h.Be(t.kind)),s.push(h)}return s}cn(e,t){return!!e.filters.find(r=>r instanceof Ke&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Jl(e),i=Ru(e);return(t?r.K("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.K()).next(s=>{const u=[];return w.forEach(s,d=>i.get([d.indexId,this.uid]).next(h=>{u.push(function(p,_){const v=_?new je(_.sequenceNumber,new qe(bi(_.readTime),new y(tn(_.documentKey)),_.largestBatchId)):je.empty(),E=p.fields.map(([b,S])=>new U(g.fromServerFormat(b),S));return new T(p.indexId,p.collectionGroup,E,v)}(d,h))})).next(()=>u)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:H(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=Jl(e),s=Ru(e);return this.ln(e).next(u=>i.K("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(d=>w.forEach(d,h=>s.put(Wg(h.indexId,this.user,u,r)))))}updateIndexEntries(e,t){const r=new Map;return w.forEach(t,(i,s)=>{const u=r.get(i.collectionGroup);return(u?w.resolve(u):this.getFieldIndexes(e,i.collectionGroup)).next(d=>(r.set(i.collectionGroup,d),w.forEach(d,h=>this.fn(e,i,h).next(p=>{const _=this.dn(s,h);return p.isEqual(_)?w.resolve():this._n(e,s,h,p,_)}))))})}wn(e,t,r,i){return Nu(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.un(r,t.key),documentKey:t.key.path.toArray()})}mn(e,t,r,i){return Nu(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.un(r,t.key),t.key.path.toArray()])}fn(e,t,r){const i=Nu(e);let s=new ne(Si);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.un(r,t)])},(u,d)=>{s=s.add(new Ci(r.indexId,t,d.arrayValue,d.directionalValue))}).next(()=>s)}dn(e,t){let r=new ne(Si);const i=this.on(t,e);if(null==i)return r;const s=N(t);if(null!=s){const u=e.data.field(s.fieldPath);if(mu(u))for(const d of u.arrayValue.values||[])r=r.add(new Ci(t.indexId,e.key,this.nn(d),i))}else r=r.add(new Ci(t.indexId,e.key,Xl,i));return r}_n(e,t,r,i,s){M("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const u=[];return function(d,h,p,_,v){const E=d.getIterator(),b=h.getIterator();let S=oo(E),R=oo(b);for(;S||R;){let L=!1,Y=!1;if(S&&R){const te=p(S,R);te<0?Y=!0:te>0&&(L=!0)}else null!=S?Y=!0:L=!0;L?(_(R),R=oo(b)):Y?(v(S),S=oo(E)):(S=oo(E),R=oo(b))}}(i,s,Si,d=>{u.push(this.wn(e,t,r,d))},d=>{u.push(this.mn(e,t,r,d))}),w.waitFor(u)}ln(e){let t=1;return Ru(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((u,d)=>Si(u,d)).filter((u,d,h)=>!d||0!==Si(u,h[d-1]));const i=[];i.push(e);for(const u of r){const d=Si(u,e),h=Si(u,t);if(0===d)i[0]=e.Le();else if(d>0&&h<0)i.push(u),i.push(u.Le());else if(h>0)break}i.push(t);const s=[];for(let u=0;u<i.length;u+=2)s.push(IDBKeyRange.bound([i[u].indexId,this.uid,i[u].arrayValue,i[u].directionalValue,Xl,[]],[i[u+1].indexId,this.uid,i[u+1].arrayValue,i[u+1].directionalValue,Xl,[]]));return s}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(e_)}getMinOffset(e,t){return w.mapArray(this.Ye(t),r=>this.Xe(e,r).next(i=>i||V())).next(e_)}}function Qg(n){return Fe(n,"collectionParents")}function Nu(n){return Fe(n,"indexEntries")}function Jl(n){return Fe(n,"indexConfiguration")}function Ru(n){return Fe(n,"indexState")}function e_(n){G(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;ro(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new qe(e.readTime,e.documentKey,t)}const t_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class lt{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new lt(e,lt.DEFAULT_COLLECTION_PERCENTILE,lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function n_(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],u=IDBKeyRange.only(t.batchId);let d=0;const h=r.J({range:u},(_,v,E)=>(d++,E.delete()));s.push(h.next(()=>{G(1===d)}));const p=[];for(const _ of t.mutations){const v=Bg(e,_.key.path,t.batchId);s.push(i.delete(v)),p.push(_.key)}return w.waitFor(s).next(()=>p)}function Ql(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw V();e=n.noDocument}return JSON.stringify(e).length}lt.DEFAULT_COLLECTION_PERCENTILE=10,lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lt.DEFAULT=new lt(41943040,lt.DEFAULT_COLLECTION_PERCENTILE,lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lt.DISABLED=new lt(-1,0,0);class ed{constructor(e,t,r,i){this.userId=e,this.wt=t,this.indexManager=r,this.referenceDelegate=i,this.gn={}}static se(e,t,r,i){G(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new ed(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return gr(e).J({index:"userMutationsIndex",range:r},(i,s,u)=>{t=!1,u.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=yo(e),u=gr(e);return u.add({}).next(d=>{G("number"==typeof d);const h=new rf(d,t,r,i),p=function(E,b,S){const R=S.baseMutations.map(Y=>xu(E.ne,Y)),L=S.mutations.map(Y=>xu(E.ne,Y));return{userId:b,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:R,mutations:L}}(this.wt,this.userId,h),_=[];let v=new ne((E,b)=>H(E.canonicalString(),b.canonicalString()));for(const E of i){const b=Bg(this.userId,E.key.path,d);v=v.add(E.key.path.popLast()),_.push(u.put(p)),_.push(s.put(b,$I))}return v.forEach(E=>{_.push(this.indexManager.addToCollectionParentIndex(e,E))}),e.addOnCommittedListener(()=>{this.gn[d]=h.keys()}),w.waitFor(_).next(()=>h)})}lookupMutationBatch(e,t){return gr(e).get(t).next(r=>r?(G(r.userId===this.userId),Ti(this.wt,r)):null)}yn(e,t){return this.gn[t]?w.resolve(this.gn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.gn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return gr(e).J({index:"userMutationsIndex",range:i},(u,d,h)=>{d.userId===this.userId&&(G(d.batchId>=r),s=Ti(this.wt,d)),h.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return gr(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,u)=>{r=s.batchId,u.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return gr(e).K("userMutationsIndex",t).next(r=>r.map(i=>Ti(this.wt,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Wl(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return yo(e).J({range:i},(u,d,h)=>{const[p,_,v]=u,E=tn(_);if(p===this.userId&&t.path.isEqual(E))return gr(e).get(v).next(b=>{if(!b)throw V();G(b.userId===this.userId),s.push(Ti(this.wt,b))});h.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ne(H);const i=[];return t.forEach(s=>{const u=Wl(this.userId,s.path),d=IDBKeyRange.lowerBound(u),h=yo(e).J({range:d},(p,_,v)=>{const[E,b,S]=p,R=tn(b);E===this.userId&&s.path.isEqual(R)?r=r.add(S):v.done()});i.push(h)}),w.waitFor(i).next(()=>this.pn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Wl(this.userId,r),u=IDBKeyRange.lowerBound(s);let d=new ne(H);return yo(e).J({range:u},(h,p,_)=>{const[v,E,b]=h,S=tn(E);v===this.userId&&r.isPrefixOf(S)?S.length===i&&(d=d.add(b)):_.done()}).next(()=>this.pn(e,d))}pn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(gr(e).get(s).next(u=>{if(null===u)throw V();G(u.userId===this.userId),r.push(Ti(this.wt,u))}))}),w.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return n_(e.ee,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.In(t.batchId)}),w.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}In(e){delete this.gn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return w.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return yo(e).J({range:r},(s,u,d)=>{if(s[0]===this.userId){const h=tn(s[1]);i.push(h)}else d.done()}).next(()=>{G(0===i.length)})})}containsKey(e,t){return r_(e,this.userId,t)}Tn(e){return i_(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function r_(n,e,t){const r=Wl(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let u=!1;return yo(n).J({range:s,H:!0},(d,h,p)=>{const[_,v,E]=d;_===e&&v===i&&(u=!0),p.done()}).next(()=>u)}function gr(n){return Fe(n,"mutations")}function yo(n){return Fe(n,"documentMutations")}function i_(n){return Fe(n,"mutationQueues")}class xi{constructor(e){this.En=e}next(){return this.En+=2,this.En}static An(){return new xi(0)}static Rn(){return new xi(-1)}}class y0{constructor(e,t){this.referenceDelegate=e,this.wt=t}allocateTargetId(e){return this.bn(e).next(t=>{const r=new xi(t.highestTargetId);return t.highestTargetId=r.next(),this.Pn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.bn(e).next(t=>o.fromTimestamp(new c(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Pn(e,i)))}addTargetData(e,t){return this.vn(e,t).next(()=>this.bn(e).next(r=>(r.targetCount+=1,this.Vn(t,r),this.Pn(e,r))))}updateTargetData(e,t){return this.vn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>vo(e).delete(t.targetId)).next(()=>this.bn(e)).next(r=>(G(r.targetCount>0),r.targetCount-=1,this.Pn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return vo(e).J((u,d)=>{const h=Du(d);h.sequenceNumber<=t&&null===r.get(h.targetId)&&(i++,s.push(this.removeTargetData(e,h)))}).next(()=>w.waitFor(s)).next(()=>i)}forEachTarget(e,t){return vo(e).J((r,i)=>{const s=Du(i);t(s)})}bn(e){return s_(e).get("targetGlobalKey").next(t=>(G(null!==t),t))}Pn(e,t){return s_(e).put("targetGlobalKey",t)}vn(e,t){return vo(e).put(Kg(this.wt,t))}Vn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=vi(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return vo(e).J({range:i,index:"queryTargetsIndex"},(u,d,h)=>{const p=Du(d);_u(t,p.target)&&(s=p,h.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=_r(e);return t.forEach(u=>{const d=tt(u.path);i.push(s.put({targetId:r,path:d})),i.push(this.referenceDelegate.addReference(e,r,u))}),w.waitFor(i)}removeMatchingKeys(e,t,r){const i=_r(e);return w.forEach(t,s=>{const u=tt(s.path);return w.waitFor([i.delete([r,u]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=_r(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=_r(e);let s=K();return i.J({range:r,H:!0},(u,d,h)=>{const p=tn(u[1]),_=new y(p);s=s.add(_)}).next(()=>s)}containsKey(e,t){const r=tt(t.path),i=IDBKeyRange.bound([r],[Fl(r)],!1,!0);let s=0;return _r(e).J({index:"documentTargetsIndex",H:!0,range:i},([u,d],h,p)=>{0!==u&&(s++,p.done())}).next(()=>s>0)}te(e,t){return vo(e).get(t).next(r=>r?Du(r):null)}}function vo(n){return Fe(n,"targets")}function s_(n){return Fe(n,"targetGlobal")}function _r(n){return Fe(n,"targetDocuments")}function o_([n,e],[t,r]){const i=H(n,t);return 0===i?H(e,r):i}class v0{constructor(e){this.Sn=e,this.buffer=new ne(o_),this.Dn=0}Cn(){return++this.Dn}xn(e){const t=[e,this.Cn()];if(this.buffer.size<this.Sn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();o_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class I0{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Nn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.kn(6e4)}stop(){this.Nn&&(this.Nn.cancel(),this.Nn=null)}get started(){return null!==this.Nn}kn(e){var t=this;M("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Nn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,x.Z)(function*(){t.Nn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){cr(r)?M("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield Ut(r)}yield t.kn(3e5)}))}}class E0{constructor(e,t){this.Mn=e,this.params=t}calculateTargetCount(e,t){return this.Mn.On(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return w.resolve(at.ot);const r=new v0(t);return this.Mn.forEachTarget(e,i=>r.xn(i.sequenceNumber)).next(()=>this.Mn.Fn(e,i=>r.xn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Mn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Mn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector","Garbage collection skipped; disabled"),w.resolve(t_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),t_):this.$n(e,t))}getCacheSize(e){return this.Mn.getCacheSize(e)}$n(e,t){let r,i,s,u,d,h,p;const _=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(v=>(v>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),i=this.params.maximumSequenceNumbersToCollect):i=v,u=Date.now(),this.nthSequenceNumber(e,i))).next(v=>(r=v,d=Date.now(),this.removeTargets(e,r,t))).next(v=>(s=v,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(v=>(p=Date.now(),to()<=At.in.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-_}ms\n\tDetermined least recently used ${i} in `+(d-u)+`ms\n\tRemoved ${s} targets in `+(h-d)+`ms\n\tRemoved ${v} documents in `+(p-h)+`ms\nTotal Duration: ${p-_}ms`),w.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:v})))}}class w0{constructor(e,t){this.db=e,this.garbageCollector=new E0(this,t)}On(e){const t=this.Bn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Bn(e){let t=0;return this.Fn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Fn(e,t){return this.Ln(e,(r,i)=>t(i))}addReference(e,t,r){return td(e,r)}removeReference(e,t,r){return td(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return td(e,t)}Un(e,t){return function(r,i){let s=!1;return i_(r).Y(u=>r_(r,u,i).next(d=>(d&&(s=!0),w.resolve(!d)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Ln(e,(u,d)=>{if(d<=t){const h=this.Un(e,u).next(p=>{if(!p)return s++,r.getEntry(e,u).next(()=>(r.removeEntry(u,o.min()),_r(e).delete([0,tt(u.path)])))});i.push(h)}}).next(()=>w.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return td(e,t)}Ln(e,t){const r=_r(e);let i,s=at.ot;return r.J({index:"documentTargetsIndex"},([u,d],{path:h,sequenceNumber:p})=>{0===u?(s!==at.ot&&t(new y(tn(i)),s),s=p,i=h):s=at.ot}).next(()=>{s!==at.ot&&t(new y(tn(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function td(n,e){return _r(n).put((r=n.currentSequenceNumber,{targetId:0,path:tt(e.path),sequenceNumber:r}));var r}class a_{constructor(){this.changes=new pr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ie.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?w.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class b0{constructor(e){this.wt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Di(e).put(r)}removeEntry(e,t,r){return Di(e).delete(function(i,s){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Zl(s),u[u.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.qn(e,r)))}getEntry(e,t){let r=ie.newInvalidDocument(t);return Di(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ou(t))},(i,s)=>{r=this.Kn(t,s)}).next(()=>r)}Gn(e,t){let r={size:0,document:ie.newInvalidDocument(t)};return Di(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ou(t))},(i,s)=>{r={document:this.Kn(t,s),size:Ql(s)}}).next(()=>r)}getEntries(e,t){let r=ct();return this.Qn(e,t,(i,s)=>{const u=this.Kn(i,s);r=r.insert(i,u)}).next(()=>r)}jn(e,t){let r=ct(),i=new fe(y.comparator);return this.Qn(e,t,(s,u)=>{const d=this.Kn(s,u);r=r.insert(s,d),i=i.insert(s,Ql(u))}).next(()=>({documents:r,Wn:i}))}Qn(e,t,r){if(t.isEmpty())return w.resolve();let i=new ne(d_);t.forEach(h=>i=i.add(h));const s=IDBKeyRange.bound(Ou(i.first()),Ou(i.last())),u=i.getIterator();let d=u.getNext();return Di(e).J({index:"documentKeyIndex",range:s},(h,p,_)=>{const v=y.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;d&&d_(d,v)<0;)r(d,null),d=u.getNext();d&&d.isEqual(v)&&(r(d,p),d=u.hasNext()?u.getNext():null),d?_.q(Ou(d)):_.done()}).next(()=>{for(;d;)r(d,null),d=u.hasNext()?u.getNext():null})}getAllFromCollection(e,t,r){const i=[t.popLast().toArray(),t.lastSegment(),Zl(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],s=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Di(e).K(IDBKeyRange.bound(i,s,!0)).next(u=>{let d=ct();for(const h of u){const p=this.Kn(y.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d=d.insert(p.key,p)}return d})}getAllFromCollectionGroup(e,t,r,i){let s=ct();const u=l_(t,r),d=l_(t,qe.max());return Di(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,d,!0)},(h,p,_)=>{const v=this.Kn(y.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);s=s.insert(v.key,v),s.size===i&&_.done()}).next(()=>s)}newChangeBuffer(e){return new T0(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return c_(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}qn(e,t){return c_(e).put("remoteDocumentGlobalKey",t)}Kn(e,t){if(t){const r=function c0(n,e){let t;if(e.document)t=Ng(n.ne,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=y.fromSegments(e.noDocument.path),i=bi(e.noDocument.readTime);t=ie.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return V();{const r=y.fromSegments(e.unknownDocument.path),i=bi(e.unknownDocument.version);t=ie.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(r){const i=new c(r[0],r[1]);return o.fromTimestamp(i)}(e.readTime)),t}(this.wt,t);if(!r.isNoDocument()||!r.version.isEqual(o.min()))return r}return ie.newInvalidDocument(e)}}function u_(n){return new b0(n)}class T0 extends a_{constructor(e,t){super(),this.zn=e,this.trackRemovals=t,this.Hn=new pr(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new ne((s,u)=>H(s.canonicalString(),u.canonicalString()));return this.changes.forEach((s,u)=>{const d=this.Hn.get(s);if(t.push(this.zn.removeEntry(e,s,d.readTime)),u.isValidDocument()){const h=$g(this.zn.wt,u);i=i.add(s.path.popLast()),r+=Ql(h)-d.size,t.push(this.zn.addEntry(e,s,h))}else if(r-=d.size,this.trackRemovals){const h=$g(this.zn.wt,u.convertToNoDocument(o.min()));t.push(this.zn.addEntry(e,s,h))}}),i.forEach(s=>{t.push(this.zn.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.zn.updateMetadata(e,r)),w.waitFor(t)}getFromCache(e,t){return this.zn.Gn(e,t).next(r=>(this.Hn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.zn.jn(e,t).next(({documents:r,Wn:i})=>(i.forEach((s,u)=>{this.Hn.set(s,{size:u,readTime:r.get(s).readTime})}),r))}}function c_(n){return Fe(n,"remoteDocumentGlobal")}function Di(n){return Fe(n,"remoteDocumentsV14")}function Ou(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function l_(n,e){const t=e.documentKey.path.toArray();return[n,Zl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function d_(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=H(t[s],r[s]),i)return i;return i=H(t.length,r.length),i||(i=H(t[t.length-2],r[r.length-2]),i||H(t[t.length-1],r[r.length-1]))}class A0{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class h_{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.getBaseDocument(e,t,r))).next(i=>(null!==r&&Iu(r.mutation,i,gt.empty(),c.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,K()).next(()=>r))}getLocalViewOfDocuments(e,t,r=K()){const i=Qt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let u=Eu();return s.forEach((d,h)=>{u=u.insert(d,h.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const r=Qt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,K()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((u,d)=>{t.set(u,d)})})}computeViews(e,t,r,i){let s=ct();const u=wu(),d=wu();return t.forEach((h,p)=>{const _=r.get(p.key);i.has(p.key)&&(void 0===_||_.mutation instanceof xn)?s=s.insert(p.key,p):void 0!==_&&(u.set(p.key,_.mutation.getFieldMask()),Iu(_.mutation,p,_.mutation.getFieldMask(),c.now()))}),this.recalculateAndSaveOverlays(e,s).next(h=>(h.forEach((p,_)=>u.set(p,_)),t.forEach((p,_)=>{var v;return d.set(p,new A0(_,null!==(v=u.get(p))&&void 0!==v?v:null))}),d))}recalculateAndSaveOverlays(e,t){const r=wu();let i=new fe((u,d)=>u-d),s=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const d of u)d.keys().forEach(h=>{const p=t.get(h);if(null===p)return;let _=r.get(h)||gt.empty();_=d.applyToLocalView(p,_),r.set(h,_);const v=(i.get(d.batchId)||K()).add(h);i=i.insert(d.batchId,v)})}).next(()=>{const u=[],d=i.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),p=h.key,_=h.value,v=Eg();_.forEach(E=>{if(!s.has(E)){const b=hg(t.get(E),r.get(E));null!==b&&v.set(E,b),s=s.add(E)}}),u.push(this.documentOverlayCache.saveOverlays(e,p,v))}return w.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return y.isDocumentKey((i=t).path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Zh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var i}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const u=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):w.resolve(Qt());let d=-1,h=s;return u.next(p=>w.forEach(p,(_,v)=>(d<v.largestBatchId&&(d=v.largestBatchId),s.get(_)?w.resolve():this.getBaseDocument(e,_,v).next(E=>{h=h.insert(_,E)}))).next(()=>this.populateOverlays(e,p,s)).next(()=>this.computeViews(e,h,p,K())).next(_=>({batchId:d,changes:Ig(_)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new y(t)).next(r=>{let i=Eu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const i=t.collectionGroup;let s=Eu();return this.indexManager.getCollectionParents(e,i).next(u=>w.forEach(u,d=>{const h=(p=t,_=d.child(i),new Sn(_,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt));var p,_;return this.getDocumentsMatchingCollectionQuery(e,h,r).next(p=>{p.forEach((_,v)=>{s=s.insert(_,v)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r){let i;return this.remoteDocumentCache.getAllFromCollection(e,t.path,r).next(s=>(i=s,this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId))).next(s=>{s.forEach((d,h)=>{const p=h.getKey();null===i.get(p)&&(i=i.insert(p,ie.newInvalidDocument(p)))});let u=Eu();return i.forEach((d,h)=>{const p=s.get(d);void 0!==p&&Iu(p.mutation,h,gt.empty(),c.now()),Xh(t,h)&&(u=u.insert(d,h))}),u})}getBaseDocument(e,t,r){return null===r||1===r.mutation.type?this.remoteDocumentCache.getEntry(e,t):w.resolve(ie.newInvalidDocument(t))}}class C0{constructor(e){this.wt=e,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(e,t){return w.resolve(this.Jn.get(t))}saveBundleMetadata(e,t){var r;return this.Jn.set(t.id,{id:(r=t).id,version:r.version,createTime:Pe(r.createTime)}),w.resolve()}getNamedQuery(e,t){return w.resolve(this.Yn.get(t))}saveNamedQuery(e,t){return this.Yn.set(t.name,{name:(r=t).name,query:uf(r.bundledQuery),readTime:Pe(r.readTime)}),w.resolve();var r}}class S0{constructor(){this.overlays=new fe(y.comparator),this.Xn=new Map}getOverlay(e,t){return w.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Qt();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ie(e,t,s)}),w.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.Xn.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Xn.delete(r)),w.resolve()}getOverlaysForCollection(e,t,r){const i=Qt(),s=t.length+1,u=new y(t.child("")),d=this.overlays.getIteratorFrom(u);for(;d.hasNext();){const h=d.getNext().value,p=h.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===s&&h.largestBatchId>r&&i.set(h.getKey(),h)}return w.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new fe((p,_)=>p-_);const u=this.overlays.getIterator();for(;u.hasNext();){const p=u.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>r){let _=s.get(p.largestBatchId);null===_&&(_=Qt(),s=s.insert(p.largestBatchId,_)),_.set(p.getKey(),p)}}const d=Qt(),h=s.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((p,_)=>d.set(p,_)),!(d.size()>=i)););return w.resolve(d)}ie(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const u=this.Xn.get(i.largestBatchId).delete(r.key);this.Xn.set(i.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new af(t,r));let s=this.Xn.get(t);void 0===s&&(s=K(),this.Xn.set(t,s)),this.Xn.set(t,s.add(r.key))}}class df{constructor(){this.Zn=new ne(Le.ts),this.es=new ne(Le.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){const r=new Le(e,t);this.Zn=this.Zn.add(r),this.es=this.es.add(r)}ss(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.rs(new Le(e,t))}os(e,t){e.forEach(r=>this.removeReference(r,t))}us(e){const t=new y(new l([])),r=new Le(t,e),i=new Le(t,e+1),s=[];return this.es.forEachInRange([r,i],u=>{this.rs(u),s.push(u.key)}),s}cs(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){const t=new y(new l([])),r=new Le(t,e),i=new Le(t,e+1);let s=K();return this.es.forEachInRange([r,i],u=>{s=s.add(u.key)}),s}containsKey(e){const t=new Le(e,0),r=this.Zn.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Le{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return y.comparator(e.key,t.key)||H(e.ls,t.ls)}static ns(e,t){return H(e.ls,t.ls)||y.comparator(e.key,t.key)}}class x0{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.fs=1,this.ds=new ne(Le.ts)}checkEmpty(e){return w.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.fs;this.fs++;const u=new rf(s,t,r,i);this.mutationQueue.push(u);for(const d of i)this.ds=this.ds.add(new Le(d.key,s)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return w.resolve(u)}lookupMutationBatch(e,t){return w.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.ws(t+1),s=i<0?0:i;return w.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return w.resolve(0===this.mutationQueue.length?-1:this.fs-1)}getAllMutationBatches(e){return w.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Le(t,0),i=new Le(t,Number.POSITIVE_INFINITY),s=[];return this.ds.forEachInRange([r,i],u=>{const d=this._s(u.ls);s.push(d)}),w.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ne(H);return t.forEach(i=>{const s=new Le(i,0),u=new Le(i,Number.POSITIVE_INFINITY);this.ds.forEachInRange([s,u],d=>{r=r.add(d.ls)})}),w.resolve(this.gs(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;y.isDocumentKey(s)||(s=s.child(""));const u=new Le(new y(s),0);let d=new ne(H);return this.ds.forEachWhile(h=>{const p=h.key.path;return!!r.isPrefixOf(p)&&(p.length===i&&(d=d.add(h.ls)),!0)},u),w.resolve(this.gs(d))}gs(e){const t=[];return e.forEach(r=>{const i=this._s(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){G(0===this.ys(t.batchId,"removed")),this.mutationQueue.shift();let r=this.ds;return w.forEach(t.mutations,i=>{const s=new Le(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.ds=r})}In(e){}containsKey(e,t){const r=new Le(t,0),i=this.ds.firstAfterOrEqual(r);return w.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return w.resolve()}ys(e,t){return this.ws(e)}ws(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}_s(e){const t=this.ws(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class D0{constructor(e){this.ps=e,this.docs=new fe(y.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,u=this.ps(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:u}),this.size+=u-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return w.resolve(r?r.document.mutableCopy():ie.newInvalidDocument(t))}getEntries(e,t){let r=ct();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ie.newInvalidDocument(i))}),w.resolve(r)}getAllFromCollection(e,t,r){let i=ct();const s=new y(t.child("")),u=this.docs.getIteratorFrom(s);for(;u.hasNext();){const{key:d,value:{document:h}}=u.getNext();if(!t.isPrefixOf(d.path))break;d.path.length>t.length+1||ro(uu(h),r)<=0||(i=i.insert(h.key,h.mutableCopy()))}return w.resolve(i)}getAllFromCollectionGroup(e,t,r,i){V()}Is(e,t){return w.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new M0(this)}getSize(e){return w.resolve(this.size)}}class M0 extends a_{constructor(e){super(),this.zn=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.zn.addEntry(e,i)):this.zn.removeEntry(r)}),w.waitFor(t)}getFromCache(e,t){return this.zn.getEntry(e,t)}getAllFromCache(e,t){return this.zn.getEntries(e,t)}}class k0{constructor(e){this.persistence=e,this.Ts=new pr(t=>vi(t),_u),this.lastRemoteSnapshotVersion=o.min(),this.highestTargetId=0,this.Es=0,this.As=new df,this.targetCount=0,this.Rs=xi.An()}forEachTarget(e,t){return this.Ts.forEach((r,i)=>t(i)),w.resolve()}getLastRemoteSnapshotVersion(e){return w.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return w.resolve(this.Es)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),w.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Es&&(this.Es=t),w.resolve()}vn(e){this.Ts.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Rs=new xi(t),this.highestTargetId=t),e.sequenceNumber>this.Es&&(this.Es=e.sequenceNumber)}addTargetData(e,t){return this.vn(t),this.targetCount+=1,w.resolve()}updateTargetData(e,t){return this.vn(t),w.resolve()}removeTargetData(e,t){return this.Ts.delete(t.target),this.As.us(t.targetId),this.targetCount-=1,w.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Ts.forEach((u,d)=>{d.sequenceNumber<=t&&null===r.get(d.targetId)&&(this.Ts.delete(u),s.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)}),w.waitFor(s).next(()=>i)}getTargetCount(e){return w.resolve(this.targetCount)}getTargetData(e,t){const r=this.Ts.get(t)||null;return w.resolve(r)}addMatchingKeys(e,t,r){return this.As.ss(t,r),w.resolve()}removeMatchingKeys(e,t,r){this.As.os(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(u=>{s.push(i.markPotentiallyOrphaned(e,u))}),w.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.As.us(t),w.resolve()}getMatchingKeysForTargetId(e,t){const r=this.As.hs(t);return w.resolve(r)}containsKey(e,t){return w.resolve(this.As.containsKey(t))}}class f_{constructor(e,t){this.bs={},this.overlays={},this.Ps=new at(0),this.vs=!1,this.vs=!0,this.referenceDelegate=e(this),this.Vs=new k0(this),this.indexManager=new g0,this.remoteDocumentCache=new D0(r=>this.referenceDelegate.Ss(r)),this.wt=new Hg(t),this.Ds=new C0(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new S0,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.bs[e.toKey()];return r||(r=new x0(t,this.referenceDelegate),this.bs[e.toKey()]=r),r}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(e,t,r){M("MemoryPersistence","Starting transaction:",e);const i=new N0(this.Ps.next());return this.referenceDelegate.Cs(),r(i).next(s=>this.referenceDelegate.xs(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ns(e,t){return w.or(Object.values(this.bs).map(r=>()=>r.containsKey(e,t)))}}class N0 extends io{constructor(e){super(),this.currentSequenceNumber=e}}class nd{constructor(e){this.persistence=e,this.ks=new df,this.Ms=null}static Os(e){return new nd(e)}get Fs(){if(this.Ms)return this.Ms;throw V()}addReference(e,t,r){return this.ks.addReference(r,t),this.Fs.delete(r.toString()),w.resolve()}removeReference(e,t,r){return this.ks.removeReference(r,t),this.Fs.add(r.toString()),w.resolve()}markPotentiallyOrphaned(e,t){return this.Fs.add(t.toString()),w.resolve()}removeTarget(e,t){this.ks.us(t.targetId).forEach(i=>this.Fs.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Fs.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Cs(){this.Ms=new Set}xs(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return w.forEach(this.Fs,r=>{const i=y.fromPath(r);return this.$s(e,i).next(s=>{s||t.removeEntry(i,o.min())})}).next(()=>(this.Ms=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(r=>{r?this.Fs.delete(t.toString()):this.Fs.add(t.toString())})}Ss(e){return 0}$s(e,t){return w.or([()=>w.resolve(this.ks.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ns(e,t)])}}class R0{constructor(e){this.wt=e}M(e,t,r,i){const s=new hi("createOrUpgrade",t);var d;r<1&&i>=1&&(e.createObjectStore("owner"),(d=e).createObjectStore("mutationQueues",{keyPath:"userId"}),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ug,{unique:!0}),d.createObjectStore("documentMutations"),p_(e),function(d){d.createObjectStore("remoteDocuments")}(e));let u=w.resolve();return r<3&&i>=3&&(0!==r&&(function(d){d.deleteObjectStore("targetDocuments"),d.deleteObjectStore("targets"),d.deleteObjectStore("targetGlobal")}(e),p_(e)),u=u.next(()=>function(d){const h=d.store("targetGlobal"),p={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:o.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",p)}(s))),r<4&&i>=4&&(0!==r&&(u=u.next(()=>function(d,h){return h.store("mutations").K().next(p=>{d.deleteObjectStore("mutations"),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ug,{unique:!0});const _=h.store("mutations"),v=p.map(E=>_.put(E));return w.waitFor(v)})}(e,s))),u=u.next(()=>{!function(d){d.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(u=u.next(()=>this.Bs(s))),r<6&&i>=6&&(u=u.next(()=>(function(d){d.createObjectStore("remoteDocumentGlobal")}(e),this.Ls(s)))),r<7&&i>=7&&(u=u.next(()=>this.Us(s))),r<8&&i>=8&&(u=u.next(()=>this.qs(e,s))),r<9&&i>=9&&(u=u.next(()=>{!function(d){d.objectStoreNames.contains("remoteDocumentChanges")&&d.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(u=u.next(()=>this.Ks(s))),r<11&&i>=11&&(u=u.next(()=>{(function(d){d.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(d){d.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(u=u.next(()=>{!function(d){const h=d.createObjectStore("documentOverlays",{keyPath:r0});h.createIndex("collectionPathOverlayIndex",s0,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",o0,{unique:!1})}(e)})),r<13&&i>=13&&(u=u.next(()=>function(d){const h=d.createObjectStore("remoteDocumentsV14",{keyPath:KI});h.createIndex("documentKeyIndex",zI),h.createIndex("collectionGroupIndex",WI)}(e)).next(()=>this.Gs(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(u=u.next(()=>this.Qs(e,s))),r<15&&i>=15&&(u=u.next(()=>function(d){d.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),d.createObjectStore("indexState",{keyPath:QI}).createIndex("sequenceNumberIndex",e0,{unique:!1}),d.createObjectStore("indexEntries",{keyPath:t0}).createIndex("documentKeyIndex",n0,{unique:!1})}(e))),u}Ls(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=Ql(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Bs(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.K().next(i=>w.forEach(i,s=>{const u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.K("userMutationsIndex",u).next(d=>w.forEach(d,h=>{G(h.userId===s.userId);const p=Ti(this.wt,h);return n_(e,s.userId,p).next(()=>{})}))}))}Us(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.J((u,d)=>{const h=new l(u),p=[0,tt(h)];s.push(t.get(p).next(_=>_?w.resolve():t.put({targetId:0,path:tt(h),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>w.waitFor(s))})}qs(e,t){e.createObjectStore("collectionParents",{keyPath:JI});const r=t.store("collectionParents"),i=new lf,s=u=>{if(i.add(u)){const d=u.lastSegment(),h=u.popLast();return r.put({collectionId:d,parent:tt(h)})}};return t.store("remoteDocuments").J({H:!0},(u,d)=>{const h=new l(u);return s(h.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([u,d,h],p)=>{const _=tn(d);return s(_.popLast())}))}Ks(e){const t=e.store("targets");return t.J((r,i)=>{const s=Du(i),u=Kg(this.wt,s);return t.put(u)})}Gs(e,t){const r=t.store("remoteDocuments"),i=[];return r.J((s,u)=>{const d=t.store("remoteDocumentsV14"),h=(p=u,p.document?new y(l.fromString(p.document.name).popFirst(5)):p.noDocument?y.fromSegments(p.noDocument.path):p.unknownDocument?y.fromSegments(p.unknownDocument.path):V()).path.toArray();var p;const _={prefixPath:h.slice(0,h.length-2),collectionGroup:h[h.length-2],documentId:h[h.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};i.push(d.put(_))}).next(()=>w.waitFor(i))}Qs(e,t){const r=t.store("mutations"),i=u_(this.wt),s=new f_(nd.Os,this.wt.ne);return r.K().next(u=>{const d=new Map;return u.forEach(h=>{var p;let _=null!==(p=d.get(h.userId))&&void 0!==p?p:K();Ti(this.wt,h).keys().forEach(v=>_=_.add(v)),d.set(h.userId,_)}),w.forEach(d,(h,p)=>{const _=new Ce(p),v=Yl.se(this.wt,_),E=s.getIndexManager(_),b=ed.se(_,this.wt,E,s.referenceDelegate);return new h_(i,b,v,E).recalculateAndSaveOverlaysForDocumentKeys(new nf(t,at.ot),h).next()})})}}function p_(n){n.createObjectStore("targetDocuments",{keyPath:YI}).createIndex("documentTargetsIndex",XI,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ZI,{unique:!0}),n.createObjectStore("targetGlobal")}const hf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ff{constructor(e,t,r,i,s,u,d,h,p,_,v=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.js=s,this.window=u,this.document=d,this.Ws=p,this.zs=_,this.Hs=v,this.Ps=null,this.vs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Js=null,this.inForeground=!1,this.Ys=null,this.Xs=null,this.Zs=Number.NEGATIVE_INFINITY,this.ti=E=>Promise.resolve(),!ff.V())throw new D(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new w0(this,i),this.ei=t+"main",this.wt=new Hg(h),this.ni=new mt(this.ei,this.Hs,new R0(this.wt)),this.Vs=new y0(this.referenceDelegate,this.wt),this.remoteDocumentCache=u_(this.wt),this.Ds=new l0,this.window&&this.window.localStorage?this.si=this.window.localStorage:(this.si=null,!1===_&&oe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ii().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(C.FAILED_PRECONDITION,hf);return this.ri(),this.oi(),this.ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Vs.getHighestSequenceNumber(e))}).then(e=>{this.Ps=new at(e,this.Ws)}).then(()=>{this.vs=!0}).catch(e=>(this.ni&&this.ni.close(),Promise.reject(e)))}ci(e){var t=this;return this.ti=function(){var r=(0,x.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ni.F(function(){var t=(0,x.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.js.enqueueAndForget((0,x.Z)(function*(){t.started&&(yield t.ii())})))}ii(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>rd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ai(e).next(t=>{t||(this.isPrimary=!1,this.js.enqueueRetryable(()=>this.ti(!1)))})}).next(()=>this.hi(e)).next(t=>this.isPrimary&&!t?this.li(e).next(()=>!1):!!t&&this.fi(e).next(()=>!0))).catch(e=>{if(cr(e))return M("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return M("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.js.enqueueRetryable(()=>this.ti(e)),this.isPrimary=e})}ai(e){return Pu(e).get("owner").next(t=>w.resolve(this.di(t)))}_i(e){return rd(e).delete(this.clientId)}wi(){var e=this;return(0,x.Z)(function*(){if(e.isPrimary&&!e.mi(e.Zs,18e5)){e.Zs=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=Fe(r,"clientMetadata");return i.K().next(s=>{const u=e.gi(s,18e5),d=s.filter(h=>-1===u.indexOf(h));return w.forEach(d,h=>i.delete(h.clientId)).next(()=>d)})}).catch(()=>[]);if(e.si)for(const r of t)e.si.removeItem(e.yi(r.clientId))}})()}ui(){this.Xs=this.js.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ii().then(()=>this.wi()).then(()=>this.ui()))}di(e){return!!e&&e.ownerId===this.clientId}hi(e){return this.zs?w.resolve(!0):Pu(e).get("owner").next(t=>{if(null!==t&&this.mi(t.leaseTimestampMs,5e3)&&!this.pi(t.ownerId)){if(this.di(t)&&this.networkEnabled)return!0;if(!this.di(t)){if(!t.allowTabSynchronization)throw new D(C.FAILED_PRECONDITION,hf);return!1}}return!(!this.networkEnabled||!this.inForeground)||rd(e).K().next(r=>void 0===this.gi(r,5e3).find(i=>{if(this.clientId!==i.clientId){const u=!this.inForeground&&i.inForeground,d=this.networkEnabled===i.networkEnabled;if(!this.networkEnabled&&i.networkEnabled||u&&d)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&M("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,x.Z)(function*(){e.vs=!1,e.Ii(),e.Xs&&(e.Xs.cancel(),e.Xs=null),e.Ti(),e.Ei(),yield e.ni.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new nf(t,at.ot);return e.li(r).next(()=>e._i(r))}),e.ni.close(),e.Ai()})()}gi(e,t){return e.filter(r=>this.mi(r.updateTimeMs,t)&&!this.pi(r.clientId))}Ri(){return this.runTransaction("getActiveClients","readonly",e=>rd(e).K().next(t=>this.gi(t,18e5).map(r=>r.clientId)))}get started(){return this.vs}getMutationQueue(e,t){return ed.se(e,this.wt,t,this.referenceDelegate)}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new _0(e,this.wt.ne.databaseId)}getDocumentOverlayCache(e){return Yl.se(this.wt,e)}getBundleCache(){return this.Ds}runTransaction(e,t,r){M("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(u=this.Hs)?u0:14===u?qg:13===u?jg:12===u?a0:11===u?Gg:void V();var u;let d;return this.ni.runTransaction(e,i,s,h=>(d=new nf(h,this.Ps?this.Ps.next():at.ot),"readwrite-primary"===t?this.ai(d).next(p=>!!p||this.hi(d)).next(p=>{if(!p)throw oe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.js.enqueueRetryable(()=>this.ti(!1)),new D(C.FAILED_PRECONDITION,cu);return r(d)}).next(p=>this.fi(d).next(()=>p)):this.bi(d).next(()=>r(d)))).then(h=>(d.raiseOnCommittedEvent(),h))}bi(e){return Pu(e).get("owner").next(t=>{if(null!==t&&this.mi(t.leaseTimestampMs,5e3)&&!this.pi(t.ownerId)&&!this.di(t)&&!(this.zs||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(C.FAILED_PRECONDITION,hf)})}fi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Pu(e).put("owner",t)}static V(){return mt.V()}li(e){const t=Pu(e);return t.get("owner").next(r=>this.di(r)?(M("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):w.resolve())}mi(e,t){const r=Date.now();return!(e<r-t||e>r&&(oe(`Detected an update time that is in the future: ${e} > ${r}`),1))}ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ys=()=>{this.js.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ii()))},this.document.addEventListener("visibilitychange",this.Ys),this.inForeground="visible"===this.document.visibilityState)}Ti(){this.Ys&&(this.document.removeEventListener("visibilitychange",this.Ys),this.Ys=null)}oi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Js=()=>{this.Ii(),(0,W.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.js.enterRestrictedMode(!0),this.js.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Js))}Ei(){this.Js&&(this.window.removeEventListener("pagehide",this.Js),this.Js=null)}pi(e){var t;try{const r=null!==(null===(t=this.si)||void 0===t?void 0:t.getItem(this.yi(e)));return M("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return oe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ii(){if(this.si)try{this.si.setItem(this.yi(this.clientId),String(Date.now()))}catch(e){oe("Failed to set zombie client id.",e)}}Ai(){if(this.si)try{this.si.removeItem(this.yi(this.clientId))}catch(e){}}yi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Pu(n){return Fe(n,"owner")}function rd(n){return Fe(n,"clientMetadata")}function pf(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class mf{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Pi=r,this.vi=i}static Vi(e,t){let r=K(),i=K();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new mf(e,t.fromCache,r,i)}}class m_{constructor(){this.Si=!1}initialize(e,t){this.Di=e,this.indexManager=t,this.Si=!0}getDocumentsMatchingQuery(e,t,r,i){return this.Ci(e,t).next(s=>s||this.xi(e,t,i,r)).next(s=>s||this.Ni(e,t))}Ci(e,t){if(eg(t))return w.resolve(null);let r=ut(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=jl(t,null,"F"),r=ut(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const u=K(...s);return this.Di.getDocuments(e,u).next(d=>this.indexManager.getMinOffset(e,r).next(h=>{const p=this.ki(t,d);return this.Mi(t,p,u,h.readTime)?this.Ci(e,jl(t,null,"F")):this.Oi(e,p,t,h)}))})))}xi(e,t,r,i){return eg(t)||i.isEqual(o.min())?this.Ni(e,t):this.Di.getDocuments(e,r).next(s=>{const u=this.ki(t,s);return this.Mi(t,u,r,i)?this.Ni(e,t):(to()<=At.in.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Yh(t)),this.Oi(e,u,t,di(i,-1)))})}ki(e,t){let r=new ne(rg(e));return t.forEach((i,s)=>{Xh(e,s)&&(r=r.add(s))}),r}Mi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ni(e,t){return to()<=At.in.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",Yh(t)),this.Di.getDocumentsMatchingQuery(e,t,qe.min())}Oi(e,t,r,i){return this.Di.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(u=>{s=s.insert(u.key,u)}),s))}}class O0{constructor(e,t,r,i){this.persistence=e,this.Fi=t,this.wt=i,this.$i=new fe(H),this.Bi=new pr(s=>vi(s),_u),this.Li=new Map,this.Ui=e.getRemoteDocumentCache(),this.Vs=e.getTargetCache(),this.Ds=e.getBundleCache(),this.qi(r)}qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new h_(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.$i))}}function g_(n,e,t,r){return new O0(n,e,t,r)}function __(n,e){return gf.apply(this,arguments)}function gf(){return gf=(0,x.Z)(function*(n,e){const t=O(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.qi(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const u=[],d=[];let h=K();for(const p of i){u.push(p.batchId);for(const _ of p.mutations)h=h.add(_.key)}for(const p of s){d.push(p.batchId);for(const _ of p.mutations)h=h.add(_.key)}return t.localDocuments.getDocuments(r,h).next(p=>({Ki:p,removedBatchIds:u,addedBatchIds:d}))})})}),gf.apply(this,arguments)}function P0(n,e){const t=O(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Ui.newChangeBuffer({trackRemovals:!0});return function(u,d,h,p){const _=h.batch,v=_.keys();let E=w.resolve();return v.forEach(b=>{E=E.next(()=>p.getEntry(d,b)).next(S=>{const R=h.docVersions.get(b);G(null!==R),S.version.compareTo(R)<0&&(_.applyToRemoteDocument(S,h),S.isValidDocument()&&(S.setReadTime(h.commitVersion),p.addEntry(S)))})}),E.next(()=>u.mutationQueue.removeMutationBatch(d,_))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let d=K();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(d=d.add(u.batch.mutations[h].key));return d}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function y_(n){const e=O(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Vs.getLastRemoteSnapshotVersion(t))}function F0(n,e){const t=O(n),r=e.snapshotVersion;let i=t.$i;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const u=t.Ui.newChangeBuffer({trackRemovals:!0});i=t.$i;const d=[];e.targetChanges.forEach((_,v)=>{const E=i.get(v);if(!E)return;d.push(t.Vs.removeMatchingKeys(s,_.removedDocuments,v).next(()=>t.Vs.addMatchingKeys(s,_.addedDocuments,v)));let b=E.withSequenceNumber(s.currentSequenceNumber);var S,R,L;e.targetMismatches.has(v)?b=b.withResumeToken(Ne.EMPTY_BYTE_STRING,o.min()).withLastLimboFreeSnapshotVersion(o.min()):_.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(_.resumeToken,r)),i=i.insert(v,b),R=b,L=_,(0===(S=E).resumeToken.approximateByteSize()||R.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8||L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0)&&d.push(t.Vs.updateTargetData(s,b))});let h=ct(),p=K();if(e.documentUpdates.forEach(_=>{e.resolvedLimboDocuments.has(_)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(s,_))}),d.push(v_(s,u,e.documentUpdates).next(_=>{h=_.Gi,p=_.Qi})),!r.isEqual(o.min())){const _=t.Vs.getLastRemoteSnapshotVersion(s).next(v=>t.Vs.setTargetsMetadata(s,s.currentSequenceNumber,r));d.push(_)}return w.waitFor(d).next(()=>u.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,h,p)).next(()=>h)}).then(s=>(t.$i=i,s))}function v_(n,e,t){let r=K(),i=K();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let u=ct();return t.forEach((d,h)=>{const p=s.get(d);h.isFoundDocument()!==p.isFoundDocument()&&(i=i.add(d)),h.isNoDocument()&&h.version.isEqual(o.min())?(e.removeEntry(d,h.readTime),u=u.insert(d,h)):!p.isValidDocument()||h.version.compareTo(p.version)>0||0===h.version.compareTo(p.version)&&p.hasPendingWrites?(e.addEntry(h),u=u.insert(d,h)):M("LocalStore","Ignoring outdated watch update for ",d,". Current version:",p.version," Watch version:",h.version)}),{Gi:u,Qi:i}})}function L0(n,e){const t=O(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Io(n,e){const t=O(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Vs.getTargetData(r,e).next(s=>s?(i=s,w.resolve(i)):t.Vs.allocateTargetId(r).next(u=>(i=new mr(e,u,0,r.currentSequenceNumber),t.Vs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.$i.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.$i=t.$i.insert(r.targetId,r),t.Bi.set(e,r.targetId)),r})}function Eo(n,e,t){return _f.apply(this,arguments)}function _f(){return _f=(0,x.Z)(function*(n,e,t){const r=O(n),i=r.$i.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,u=>r.persistence.referenceDelegate.removeTarget(u,i)))}catch(u){if(!cr(u))throw u;M("LocalStore",`Failed to update sequence numbers for target ${e}: ${u}`)}r.$i=r.$i.remove(e),r.Bi.delete(i.target)}),_f.apply(this,arguments)}function id(n,e,t){const r=O(n);let i=o.min(),s=K();return r.persistence.runTransaction("Execute query","readonly",u=>function(d,h,p){const _=O(d),v=_.Bi.get(p);return void 0!==v?w.resolve(_.$i.get(v)):_.Vs.getTargetData(h,p)}(r,u,ut(e)).next(d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.Vs.getMatchingKeysForTargetId(u,d.targetId).next(h=>{s=h})}).next(()=>r.Fi.getDocumentsMatchingQuery(u,e,t?i:o.min(),t?s:K())).next(d=>(w_(r,ng(e),d),{documents:d,ji:s})))}function I_(n,e){const t=O(n),r=O(t.Vs),i=t.$i.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.te(s,e).next(u=>u?u.target:null))}function E_(n,e){const t=O(n),r=t.Li.get(e)||o.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Ui.getAllFromCollectionGroup(i,e,di(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(w_(t,e,i),i))}function w_(n,e,t){let r=o.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Li.set(e,r)}function yf(){return yf=(0,x.Z)(function*(n,e,t,r){const i=O(n);let s=K(),u=ct();for(const p of t){const _=e.Wi(p.metadata.name);p.document&&(s=s.add(_));const v=e.zi(p);v.setReadTime(e.Hi(p.metadata.readTime)),u=u.insert(_,v)}const d=i.Ui.newChangeBuffer({trackRemovals:!0}),h=yield Io(i,(p=r,ut(co(l.fromString(`__bundle__/docs/${p}`)))));var p;return i.persistence.runTransaction("Apply bundle documents","readwrite",p=>v_(p,d,u).next(_=>(d.apply(p),_)).next(_=>i.Vs.removeMatchingKeysForTargetId(p,h.targetId).next(()=>i.Vs.addMatchingKeys(p,s,h.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(p,_.Gi,_.Qi)).next(()=>_.Gi)))}),yf.apply(this,arguments)}function U0(n,e){return vf.apply(this,arguments)}function vf(){return vf=(0,x.Z)(function*(n,e,t=K()){const r=yield Io(n,ut(uf(e.bundledQuery))),i=O(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const u=Pe(e.readTime);if(r.snapshotVersion.compareTo(u)>=0)return i.Ds.saveNamedQuery(s,e);const d=r.withResumeToken(Ne.EMPTY_BYTE_STRING,u);return i.$i=i.$i.insert(d.targetId,d),i.Vs.updateTargetData(s,d).next(()=>i.Vs.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.Vs.addMatchingKeys(s,t,r.targetId)).next(()=>i.Ds.saveNamedQuery(s,e))})}),vf.apply(this,arguments)}function b_(n,e){return`firestore_clients_${n}_${e}`}function T_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function If(n,e){return`firestore_targets_${n}_${e}`}class sd{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ji(e,t,r){const i=JSON.parse(r);let s,u="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return u&&i.error&&(u="string"==typeof i.error.message&&"string"==typeof i.error.code,u&&(s=new D(i.error.code,i.error.message))),u?new sd(e,t,i.state,s):(oe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Yi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Fu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ji(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new D(r.error.code,r.error.message))),s?new Fu(e,r.state,i):(oe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Yi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class od{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ji(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=Kl();for(let u=0;i&&u<r.activeTargetIds.length;++u)i=Um(r.activeTargetIds[u]),s=s.add(r.activeTargetIds[u]);return i?new od(e,s):(oe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ef{constructor(e,t){this.clientId=e,this.onlineState=t}static Ji(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ef(t.clientId,t.onlineState):(oe("SharedClientState",`Failed to parse online state: ${e}`),null)}}class wf{constructor(){this.activeTargetIds=Kl()}Xi(e){this.activeTargetIds=this.activeTargetIds.add(e)}Zi(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Yi(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class bf{constructor(e,t,r,i,s){this.window=e,this.js=t,this.persistenceKey=r,this.tr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.er=this.nr.bind(this),this.sr=new fe(H),this.started=!1,this.ir=[];const u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.rr=b_(this.persistenceKey,this.tr),this.ur=`firestore_sequence_number_${this.persistenceKey}`,this.sr=this.sr.insert(this.tr,new wf),this.cr=new RegExp(`^firestore_clients_${u}_([^_]*)$`),this.ar=new RegExp(`^firestore_mutations_${u}_(\\d+)(?:_(.*))?$`),this.hr=new RegExp(`^firestore_targets_${u}_(\\d+)$`),this.lr=`firestore_online_state_${this.persistenceKey}`,this.dr=function(d){return`firestore_bundle_loaded_v2_${d}`}(this.persistenceKey),this.window.addEventListener("storage",this.er)}static V(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,x.Z)(function*(){const t=yield e.syncEngine.Ri();for(const i of t){if(i===e.tr)continue;const s=e.getItem(b_(e.persistenceKey,i));if(s){const u=od.Ji(i,s);u&&(e.sr=e.sr.insert(u.clientId,u))}}e._r();const r=e.storage.getItem(e.lr);if(r){const i=e.wr(r);i&&e.mr(i)}for(const i of e.ir)e.nr(i);e.ir=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ur,JSON.stringify(e))}getAllActiveQueryTargets(){return this.gr(this.sr)}isActiveQueryTarget(e){let t=!1;return this.sr.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.yr(e,"pending")}updateMutationState(e,t,r){this.yr(e,t,r),this.pr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(If(this.persistenceKey,e));if(r){const i=Fu.Ji(e,r);i&&(t=i.state)}}return this.Ir.Xi(e),this._r(),t}removeLocalQueryTarget(e){this.Ir.Zi(e),this._r()}isLocalQueryTarget(e){return this.Ir.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(If(this.persistenceKey,e))}updateQueryState(e,t,r){this.Tr(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.pr(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Er(e)}notifyBundleLoaded(e){this.Ar(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.er),this.removeItem(this.rr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return M("SharedClientState","READ",e,t),t}setItem(e,t){M("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){M("SharedClientState","REMOVE",e),this.storage.removeItem(e)}nr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(M("SharedClientState","EVENT",r.key,r.newValue),r.key===this.rr)return void oe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.js.enqueueRetryable((0,x.Z)(function*(){if(t.started){if(null!==r.key)if(t.cr.test(r.key)){if(null==r.newValue){const i=t.Rr(r.key);return t.br(i,null)}{const i=t.Pr(r.key,r.newValue);if(i)return t.br(i.clientId,i)}}else if(t.ar.test(r.key)){if(null!==r.newValue){const i=t.vr(r.key,r.newValue);if(i)return t.Vr(i)}}else if(t.hr.test(r.key)){if(null!==r.newValue){const i=t.Sr(r.key,r.newValue);if(i)return t.Dr(i)}}else if(r.key===t.lr){if(null!==r.newValue){const i=t.wr(r.newValue);if(i)return t.mr(i)}}else if(r.key===t.ur){const i=function(s){let u=at.ot;if(null!=s)try{const d=JSON.parse(s);G("number"==typeof d),u=d}catch(d){oe("SharedClientState","Failed to read sequence number from WebStorage",d)}return u}(r.newValue);i!==at.ot&&t.sequenceNumberHandler(i)}else if(r.key===t.dr){const i=t.Cr(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Nr(s)))}}else t.ir.push(r)}))}}get Ir(){return this.sr.get(this.tr)}_r(){this.setItem(this.rr,this.Ir.Yi())}yr(e,t,r){const i=new sd(this.currentUser,e,t,r),s=T_(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Yi())}pr(e){const t=T_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Er(e){this.storage.setItem(this.lr,JSON.stringify({clientId:this.tr,onlineState:e}))}Tr(e,t,r){const i=If(this.persistenceKey,e),s=new Fu(e,t,r);this.setItem(i,s.Yi())}Ar(e){const t=JSON.stringify(Array.from(e));this.setItem(this.dr,t)}Rr(e){const t=this.cr.exec(e);return t?t[1]:null}Pr(e,t){const r=this.Rr(e);return od.Ji(r,t)}vr(e,t){const r=this.ar.exec(e),i=Number(r[1]);return sd.Ji(new Ce(void 0!==r[2]?r[2]:null),i,t)}Sr(e,t){const r=this.hr.exec(e),i=Number(r[1]);return Fu.Ji(i,t)}wr(e){return Ef.Ji(e)}Cr(e){return JSON.parse(e)}Vr(e){var t=this;return(0,x.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.kr(e.batchId,e.state,e.error);M("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Dr(e){return this.syncEngine.Mr(e.targetId,e.state,e.error)}br(e,t){const r=t?this.sr.insert(e,t):this.sr.remove(e),i=this.gr(this.sr),s=this.gr(r),u=[],d=[];return s.forEach(h=>{i.has(h)||u.push(h)}),i.forEach(h=>{s.has(h)||d.push(h)}),this.syncEngine.Or(u,d).then(()=>{this.sr=r})}mr(e){this.sr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}gr(e){let t=Kl();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class A_{constructor(){this.Fr=new wf,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Fr.Xi(e),this.$r[e]||"not-current"}updateQueryState(e,t,r){this.$r[e]=t}removeLocalQueryTarget(e){this.Fr.Zi(e)}isLocalQueryTarget(e){return this.Fr.activeTargetIds.has(e)}clearQueryState(e){delete this.$r[e]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(e){return this.Fr.activeTargetIds.has(e)}start(){return this.Fr=new wf,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class B0{Br(e){}shutdown(){}}class C_{constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(e){this.Gr.push(e)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){M("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Gr)e(0)}Kr(){M("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Gr)e(1)}static V(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const G0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class j0{constructor(e){this.jr=e.jr,this.Wr=e.Wr}zr(e){this.Hr=e}Jr(e){this.Yr=e}onMessage(e){this.Xr=e}close(){this.Wr()}send(e){this.jr(e)}Zr(){this.Hr()}eo(e){this.Yr(e)}no(e){this.Xr(e)}}class q0 extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.so=(e.ssl?"https":"http")+"://"+e.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(e,t,r,i,s){const u=this.oo(e,t);M("RestConnection","Sending: ",u,r);const d={};return this.uo(d,i,s),this.co(e,u,d,r).then(h=>(M("RestConnection","Received: ",h),h),h=>{throw An("RestConnection",`${e} failed with error: `,h,"url: ",u,"request:",r),h})}ao(e,t,r,i,s,u){return this.ro(e,t,r,i,s)}uo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Se,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}oo(e,t){return`${this.so}/v1/${t}:${G0[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}co(e,t,r,i){return new Promise((s,u)=>{const d=new Bh;d.listenOnce(Uh.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case nu.NO_ERROR:const p=d.getResponseJson();M("Connection","XHR received:",JSON.stringify(p)),s(p);break;case nu.TIMEOUT:M("Connection",'RPC "'+e+'" timed out'),u(new D(C.DEADLINE_EXCEEDED,"Request time out"));break;case nu.HTTP_ERROR:const _=d.getStatus();if(M("Connection",'RPC "'+e+'" failed with status:',_,"response text:",d.getResponseText()),_>0){const v=d.getResponseJson().error;if(v&&v.status&&v.message){const E=function(b){const S=b.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(S)>=0?S:C.UNKNOWN}(v.status);u(new D(E,v.message))}else u(new D(C.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new D(C.UNAVAILABLE,"Connection failed."));break;default:V()}}finally{M("Connection",'RPC "'+e+'" completed.')}});const h=JSON.stringify(i);d.send(t,"POST",h,r,15)})}ho(e,t,r){const i=[this.so,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Lh(),u=Vh(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(d.xmlHttpFactory=new ru({})),this.uo(d.initMessageHeaders,t,r),(0,W.uI)()||(0,W.b$)()||(0,W.d)()||(0,W.w1)()||(0,W.Mn)()||(0,W.ru)()||(d.httpHeadersOverwriteParam="$httpHeaders");const h=i.join("");M("Connection","Creating WebChannel: "+h,d);const p=s.createWebChannel(h,d);let _=!1,v=!1;const E=new j0({jr:S=>{v?M("Connection","Not sending because WebChannel is closed:",S):(_||(M("Connection","Opening WebChannel transport."),p.open(),_=!0),M("Connection","WebChannel sending:",S),p.send(S))},Wr:()=>p.close()}),b=(S,R,L)=>{S.listen(R,Y=>{try{L(Y)}catch(te){setTimeout(()=>{throw te},0)}})};return b(p,ci.EventType.OPEN,()=>{v||M("Connection","WebChannel transport opened.")}),b(p,ci.EventType.CLOSE,()=>{v||(v=!0,M("Connection","WebChannel transport closed"),E.eo())}),b(p,ci.EventType.ERROR,S=>{v||(v=!0,An("Connection","WebChannel transport errored:",S),E.eo(new D(C.UNAVAILABLE,"The operation could not be completed")))}),b(p,ci.EventType.MESSAGE,S=>{var R;if(!v){const L=S.data[0];G(!!L);const Y=L,te=Y.error||(null===(R=Y[0])||void 0===R?void 0:R.error);if(te){M("Connection","WebChannel received error:",te);const J=te.status;let $=function(X){const Re=xe[X];if(void 0!==Re)return yg(Re)}(J),z=te.message;void 0===$&&($=C.INTERNAL,z="Unknown error status: "+J+" with message "+te.message),v=!0,E.eo(new D($,z)),p.close()}else M("Connection","WebChannel received:",L),E.no(L)}}),b(u,Nl.STAT_EVENT,S=>{S.stat===Qs.PROXY?M("Connection","Detected buffering proxy"):S.stat===Qs.NOPROXY&&M("Connection","Detected no buffering proxy")}),setTimeout(()=>{E.Zr()},0),E}}function S_(){return"undefined"!=typeof window?window:null}function ad(){return"undefined"!=typeof document?document:null}function Lu(n){return new RI(n,!0)}class Tf{constructor(e,t,r=1e3,i=1.5,s=6e4){this.js=e,this.timerId=t,this.lo=r,this.fo=i,this._o=s,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(e){this.cancel();const t=Math.floor(this.wo+this.To()),r=Math.max(0,Date.now()-this.yo),i=Math.max(0,t-r);i>0&&M("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.wo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,i,()=>(this.yo=Date.now(),e())),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}cancel(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}class x_{constructor(e,t,r,i,s,u,d,h){this.js=e,this.Ao=r,this.Ro=i,this.bo=s,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new Tf(e,t)}Do(){return 1===this.state||5===this.state||this.Co()}Co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.xo()}stop(){var e=this;return(0,x.Z)(function*(){e.Do()&&(yield e.close(0))})()}No(){this.state=0,this.So.reset()}ko(){this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,()=>this.Mo()))}Oo(e){this.Fo(),this.stream.send(e)}Mo(){var e=this;return(0,x.Z)(function*(){if(e.Co())return e.close(0)})()}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}close(e,t){var r=this;return(0,x.Z)(function*(){r.Fo(),r.$o(),r.So.cancel(),r.Po++,4!==e?r.So.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(oe(t.toString()),oe("Using maximum backoff delay to prevent overloading the backend."),r.So.po()):t&&t.code===C.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Bo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Jr(t)})()}Bo(){}auth(){this.state=1;const e=this.Lo(this.Po),t=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Po===t&&this.Uo(r,i)},r=>{e(()=>{const i=new D(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.qo(i)})})}Uo(e,t){const r=this.Lo(this.Po);this.stream=this.Ko(e,t),this.stream.zr(()=>{r(()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,()=>(this.Co()&&(this.state=3),Promise.resolve())),this.listener.zr()))}),this.stream.Jr(i=>{r(()=>this.qo(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}xo(){var e=this;this.state=5,this.So.Io((0,x.Z)(function*(){e.state=0,e.start()}))}qo(e){return M("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Lo(e){return t=>{this.js.enqueueAndForget(()=>this.Po===e?t():(M("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class H0 extends x_{constructor(e,t,r,i,s,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,u),this.wt=s}Ko(e,t){return this.bo.ho("Listen",e,t)}onMessage(e){this.So.reset();const t=function FI(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:V(),i=e.targetChange.targetIds||[],s=function(h,p){return h.dt?(G(void 0===p||"string"==typeof p),Ne.fromBase64String(p||"")):(G(void 0===p||p instanceof Uint8Array),Ne.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,d=u&&function(h){const p=void 0===h.code?C.UNKNOWN:yg(h.code);return new D(p,h.message||"")}(u);t=new bg(r,i,s,d||null)}else if("documentChange"in e){const r=e.documentChange,i=en(n,r.document.name),s=Pe(r.document.updateTime),u=new $e({mapValue:{fields:r.document.fields}}),d=ie.newFoundDocument(i,s,u);t=new zl(r.targetIds||[],r.removedTargetIds||[],d.key,d)}else if("documentDelete"in e){const r=e.documentDelete,i=en(n,r.document),s=r.readTime?Pe(r.readTime):o.min(),u=ie.newNoDocument(i,s);t=new zl([],r.removedTargetIds||[],u.key,u)}else if("documentRemove"in e){const r=e.documentRemove,i=en(n,r.document);t=new zl([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return V();{const r=e.filter,s=new AI(r.count||0);t=new wg(r.targetId,s)}}var h;return t}(this.wt,e),r=function(i){if(!("targetChange"in i))return o.min();const s=i.targetChange;return s.targetIds&&s.targetIds.length?o.min():s.readTime?Pe(s.readTime):o.min()}(e);return this.listener.Go(t,r)}Qo(e){const t={};t.database=Su(this.wt),t.addTarget=function(i,s){let u;const d=s.target;return u=Bl(d)?{documents:Rg(i,d)}:{query:Og(i,d)},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?u.resumeToken=Sg(i,s.resumeToken):s.snapshotVersion.compareTo(o.min())>0&&(u.readTime=Au(i,s.snapshotVersion.toTimestamp())),u}(this.wt,e);const r=function VI(n,e){const t=function(r,i){switch(i){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return V()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Oo(t)}jo(e){const t={};t.database=Su(this.wt),t.removeTarget=e,this.Oo(t)}}class $0 extends x_{constructor(e,t,r,i,s,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,u),this.wt=s,this.Wo=!1}get zo(){return this.Wo}start(){this.Wo=!1,this.lastStreamToken=void 0,super.start()}Bo(){this.Wo&&this.Ho([])}Ko(e,t){return this.bo.ho("Write",e,t)}onMessage(e){if(G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Wo){this.So.reset();const t=function LI(n,e){return n&&n.length>0?(G(void 0!==e),n.map(t=>function(r,i){let s=Pe(r.updateTime?r.updateTime:i);return s.isEqual(o.min())&&(s=Pe(i)),new wI(s,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Pe(e.commitTime);return this.listener.Jo(r,t)}return G(!e.writeResults||0===e.writeResults.length),this.Wo=!0,this.listener.Yo()}Xo(){const e={};e.database=Su(this.wt),this.Oo(e)}Ho(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>xu(this.wt,r))};this.Oo(t)}}class K0 extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.bo=r,this.wt=i,this.Zo=!1}tu(){if(this.Zo)throw new D(C.FAILED_PRECONDITION,"The client has already been terminated.")}ro(e,t,r){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.bo.ro(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new D(C.UNKNOWN,i.toString())})}ao(e,t,r,i){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.bo.ao(e,t,r,s,u,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(C.UNKNOWN,s.toString())})}terminate(){this.Zo=!0}}class z0{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve())))}uu(e){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ru("Offline")))}set(e){this.cu(),this.eu=0,"Online"===e&&(this.su=!1),this.ru(e)}ru(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ou(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(oe(t),this.su=!1):M("OnlineStateTracker",t)}cu(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}class W0{constructor(e,t,r,i,s){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=s,this.du.Br(d=>{r.enqueueAndForget((0,x.Z)(function*(){var h;yr(u)&&(M("RemoteStore","Restarting streams for network reachability change."),yield(h=(0,x.Z)(function*(p){const _=O(p);_.lu.add(4),yield wo(_),_._u.set("Unknown"),_.lu.delete(4),yield Vu(_)}),function(p){return h.apply(this,arguments)})(u))}))}),this._u=new z0(r,i)}}function Vu(n){return Af.apply(this,arguments)}function Af(){return Af=(0,x.Z)(function*(n){if(yr(n))for(const e of n.fu)yield e(!0)}),Af.apply(this,arguments)}function wo(n){return Cf.apply(this,arguments)}function Cf(){return Cf=(0,x.Z)(function*(n){for(const e of n.fu)yield e(!1)}),Cf.apply(this,arguments)}function ud(n,e){const t=O(n);t.hu.has(e.targetId)||(t.hu.set(e.targetId,e),Df(t)?xf(t):To(t).Co()&&Sf(t,e))}function Uu(n,e){const t=O(n),r=To(t);t.hu.delete(e),r.Co()&&D_(t,e),0===t.hu.size&&(r.Co()?r.ko():yr(t)&&t._u.set("Unknown"))}function Sf(n,e){n.wu.Nt(e.targetId),To(n).Qo(e)}function D_(n,e){n.wu.Nt(e),To(n).jo(e)}function xf(n){n.wu=new MI({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),te:e=>n.hu.get(e)||null}),To(n).start(),n._u.iu()}function Df(n){return yr(n)&&!To(n).Do()&&n.hu.size>0}function yr(n){return 0===O(n).lu.size}function M_(n){n.wu=void 0}function Z0(n){return Mf.apply(this,arguments)}function Mf(){return Mf=(0,x.Z)(function*(n){n.hu.forEach((e,t)=>{Sf(n,e)})}),Mf.apply(this,arguments)}function Y0(n,e){return kf.apply(this,arguments)}function kf(){return kf=(0,x.Z)(function*(n,e){M_(n),Df(n)?(n._u.uu(e),xf(n)):n._u.set("Unknown")}),kf.apply(this,arguments)}function X0(n,e,t){return Nf.apply(this,arguments)}function Nf(){return Nf=(0,x.Z)(function*(n,e,t){if(n._u.set("Online"),e instanceof bg&&2===e.state&&e.cause)try{yield(r=(0,x.Z)(function*(i,s){const u=s.cause;for(const d of s.targetIds)i.hu.has(d)&&(yield i.remoteSyncer.rejectListen(d,u),i.hu.delete(d),i.wu.removeTarget(d))}),function(i,s){return r.apply(this,arguments)})(n,e)}catch(r){M("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield cd(n,r)}else if(e instanceof zl?n.wu.Ut(e):e instanceof wg?n.wu.zt(e):n.wu.Gt(e),!t.isEqual(o.min()))try{const r=yield y_(n.localStore);t.compareTo(r)>=0&&(yield function(i,s){const u=i.wu.Yt(s);return u.targetChanges.forEach((d,h)=>{if(d.resumeToken.approximateByteSize()>0){const p=i.hu.get(h);p&&i.hu.set(h,p.withResumeToken(d.resumeToken,s))}}),u.targetMismatches.forEach(d=>{const h=i.hu.get(d);if(!h)return;i.hu.set(d,h.withResumeToken(Ne.EMPTY_BYTE_STRING,h.snapshotVersion)),D_(i,d);const p=new mr(h.target,d,1,h.sequenceNumber);Sf(i,p)}),i.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){M("RemoteStore","Failed to raise snapshot:",r),yield cd(n,r)}var r}),Nf.apply(this,arguments)}function cd(n,e,t){return Rf.apply(this,arguments)}function Rf(){return Rf=(0,x.Z)(function*(n,e,t){if(!cr(e))throw e;n.lu.add(1),yield wo(n),n._u.set("Offline"),t||(t=()=>y_(n.localStore)),n.asyncQueue.enqueueRetryable((0,x.Z)(function*(){M("RemoteStore","Retrying IndexedDB access"),yield t(),n.lu.delete(1),yield Vu(n)}))}),Rf.apply(this,arguments)}function k_(n,e){return e().catch(t=>cd(n,t,e))}function bo(n){return Of.apply(this,arguments)}function Of(){return Of=(0,x.Z)(function*(n){const e=O(n),t=vr(e);let r=e.au.length>0?e.au[e.au.length-1].batchId:-1;for(;J0(e);)try{const i=yield L0(e.localStore,r);if(null===i){0===e.au.length&&t.ko();break}r=i.batchId,Q0(e,i)}catch(i){yield cd(e,i)}N_(e)&&R_(e)}),Of.apply(this,arguments)}function J0(n){return yr(n)&&n.au.length<10}function Q0(n,e){n.au.push(e);const t=vr(n);t.Co()&&t.zo&&t.Ho(e.mutations)}function N_(n){return yr(n)&&!vr(n).Do()&&n.au.length>0}function R_(n){vr(n).start()}function eE(n){return Pf.apply(this,arguments)}function Pf(){return Pf=(0,x.Z)(function*(n){vr(n).Xo()}),Pf.apply(this,arguments)}function tE(n){return Ff.apply(this,arguments)}function Ff(){return Ff=(0,x.Z)(function*(n){const e=vr(n);for(const t of n.au)e.Ho(t.mutations)}),Ff.apply(this,arguments)}function nE(n,e,t){return Lf.apply(this,arguments)}function Lf(){return Lf=(0,x.Z)(function*(n,e,t){const r=n.au.shift(),i=sf.from(r,e,t);yield k_(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield bo(n)}),Lf.apply(this,arguments)}function rE(n,e){return Vf.apply(this,arguments)}function Vf(){return Vf=(0,x.Z)(function*(n,e){var t;e&&vr(n).zo&&(yield(t=(0,x.Z)(function*(r,i){if(_g(s=i.code)&&s!==C.ABORTED){const u=r.au.shift();vr(r).No(),yield k_(r,()=>r.remoteSyncer.rejectFailedWrite(u.batchId,i)),yield bo(r)}var s}),function(r,i){return t.apply(this,arguments)})(n,e)),N_(n)&&R_(n)}),Vf.apply(this,arguments)}function O_(n,e){return Uf.apply(this,arguments)}function Uf(){return Uf=(0,x.Z)(function*(n,e){const t=O(n);t.asyncQueue.verifyOperationInProgress(),M("RemoteStore","RemoteStore received new credentials");const r=yr(t);t.lu.add(3),yield wo(t),r&&t._u.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.lu.delete(3),yield Vu(t)}),Uf.apply(this,arguments)}function Bf(n,e){return Gf.apply(this,arguments)}function Gf(){return Gf=(0,x.Z)(function*(n,e){const t=O(n);e?(t.lu.delete(2),yield Vu(t)):e||(t.lu.add(2),yield wo(t),t._u.set("Unknown"))}),Gf.apply(this,arguments)}function To(n){return n.mu||(n.mu=function(e,t,r){const i=O(e);return i.tu(),new H0(t,i.bo,i.authCredentials,i.appCheckCredentials,i.wt,r)}(n.datastore,n.asyncQueue,{zr:Z0.bind(null,n),Jr:Y0.bind(null,n),Go:X0.bind(null,n)}),n.fu.push(function(){var e=(0,x.Z)(function*(t){t?(n.mu.No(),Df(n)?xf(n):n._u.set("Unknown")):(yield n.mu.stop(),M_(n))});return function(t){return e.apply(this,arguments)}}())),n.mu}function vr(n){return n.gu||(n.gu=function(e,t,r){const i=O(e);return i.tu(),new $0(t,i.bo,i.authCredentials,i.appCheckCredentials,i.wt,r)}(n.datastore,n.asyncQueue,{zr:eE.bind(null,n),Jr:rE.bind(null,n),Yo:tE.bind(null,n),Jo:nE.bind(null,n)}),n.fu.push(function(){var e=(0,x.Z)(function*(t){t?(n.gu.No(),yield bo(n)):(yield n.gu.stop(),n.au.length>0&&(M("RemoteStore",`Stopping write stream with ${n.au.length} pending writes`),n.au=[]))});return function(t){return e.apply(this,arguments)}}())),n.gu}class jf{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ve,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,t,r,i,s){const u=Date.now()+r,d=new jf(e,t,u,i,s);return d.start(r),d}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new D(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ao(n,e){if(oe("AsyncQueue",`${e}: ${n}`),cr(n))return new D(C.UNAVAILABLE,`${e}: ${n}`);throw n}class Co{constructor(e){this.comparator=e?(t,r)=>e(t,r)||y.comparator(t.key,r.key):(t,r)=>y.comparator(t.key,r.key),this.keyedMap=Eu(),this.sortedSet=new fe(this.comparator)}static emptySet(e){return new Co(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Co)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Co;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class P_{constructor(){this.yu=new fe(y.comparator)}track(e){const t=e.doc.key,r=this.yu.get(t);r?0!==e.type&&3===r.type?this.yu=this.yu.insert(t,e):3===e.type&&1!==r.type?this.yu=this.yu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.yu=this.yu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.yu=this.yu.remove(t):1===e.type&&2===r.type?this.yu=this.yu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):V():this.yu=this.yu.insert(t,e)}pu(){const e=[];return this.yu.inorderTraversal((t,r)=>{e.push(r)}),e}}class So{constructor(e,t,r,i,s,u,d,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=u,this.syncStateChanged=d,this.excludesMetadataChanges=h}static fromInitialDocuments(e,t,r,i){const s=[];return t.forEach(u=>{s.push({type:0,doc:u})}),new So(e,t,Co.emptySet(t),s,r,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&yu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class iE{constructor(){this.Iu=void 0,this.listeners=[]}}class sE{constructor(){this.queries=new pr(e=>tg(e),yu),this.onlineState="Unknown",this.Tu=new Set}}function qf(n,e){return Hf.apply(this,arguments)}function Hf(){return Hf=(0,x.Z)(function*(n,e){const t=O(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new iE),i)try{s.Iu=yield t.onListen(r)}catch(u){const d=Ao(u,`Initialization of query '${Yh(e.query)}' failed`);return void e.onError(d)}t.queries.set(r,s),s.listeners.push(e),e.Eu(t.onlineState),s.Iu&&e.Au(s.Iu)&&zf(t)}),Hf.apply(this,arguments)}function $f(n,e){return Kf.apply(this,arguments)}function Kf(){return Kf=(0,x.Z)(function*(n,e){const t=O(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const u=s.listeners.indexOf(e);u>=0&&(s.listeners.splice(u,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),Kf.apply(this,arguments)}function oE(n,e){const t=O(n);let r=!1;for(const i of e){const u=t.queries.get(i.query);if(u){for(const d of u.listeners)d.Au(i)&&(r=!0);u.Iu=i}}r&&zf(t)}function aE(n,e,t){const r=O(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function zf(n){n.Tu.forEach(e=>{e.next()})}class Wf{constructor(e,t,r){this.query=e,this.Ru=t,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=r||{}}Au(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new So(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.bu?this.vu(e)&&(this.Ru.next(e),t=!0):this.Vu(e,this.onlineState)&&(this.Su(e),t=!0),this.Pu=e,t}onError(e){this.Ru.error(e)}Eu(e){this.onlineState=e;let t=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,e)&&(this.Su(this.Pu),t=!0),t}Vu(e,t){return!e.fromCache||!(this.options.Du&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}vu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Pu&&this.Pu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Su(e){e=So.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Ru.next(e)}}class uE{constructor(e,t){this.payload=e,this.byteLength=t}Cu(){return"metadata"in this.payload}}class F_{constructor(e){this.wt=e}Wi(e){return en(this.wt,e)}zi(e){return e.metadata.exists?Ng(this.wt,e.document,!1):ie.newNoDocument(this.Wi(e.metadata.name),this.Hi(e.metadata.readTime))}Hi(e){return Pe(e)}}class cE{constructor(e,t,r){this.xu=e,this.localStore=t,this.wt=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=L_(e)}Nu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;const r=l.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ku(e){const t=new Map,r=new F_(this.wt);for(const i of e)if(i.metadata.queries){const s=r.Wi(i.metadata.name);for(const u of i.metadata.queries){const d=(t.get(u)||K()).add(s);t.set(u,d)}}return t}complete(){var e=this;return(0,x.Z)(function*(){const t=yield function V0(n,e,t,r){return yf.apply(this,arguments)}(e.localStore,new F_(e.wt),e.documents,e.xu.id),r=e.ku(e.documents);for(const i of e.queries)yield U0(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Mu:e.collectionGroups,Ou:t}})()}}function L_(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class V_{constructor(e){this.key=e}}class U_{constructor(e){this.key=e}}class B_{constructor(e,t){this.query=e,this.Fu=t,this.$u=null,this.current=!1,this.Bu=K(),this.mutatedKeys=K(),this.Lu=rg(e),this.Uu=new Co(this.Lu)}get qu(){return this.Fu}Ku(e,t){const r=t?t.Gu:new P_,i=t?t.Uu:this.Uu;let s=t?t.mutatedKeys:this.mutatedKeys,u=i,d=!1;const h="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,p="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((_,v)=>{const E=i.get(_),b=Xh(this.query,v)?v:null,S=!!E&&this.mutatedKeys.has(E.key),R=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let L=!1;E&&b?E.data.isEqual(b.data)?S!==R&&(r.track({type:3,doc:b}),L=!0):this.Qu(E,b)||(r.track({type:2,doc:b}),L=!0,(h&&this.Lu(b,h)>0||p&&this.Lu(b,p)<0)&&(d=!0)):!E&&b?(r.track({type:0,doc:b}),L=!0):E&&!b&&(r.track({type:1,doc:E}),L=!0,(h||p)&&(d=!0)),L&&(b?(u=u.add(b),s=R?s.add(_):s.delete(_)):(u=u.delete(_),s=s.delete(_)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const _="F"===this.query.limitType?u.last():u.first();u=u.delete(_.key),s=s.delete(_.key),r.track({type:1,doc:_})}return{Uu:u,Gu:r,Mi:d,mutatedKeys:s}}Qu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.Uu;this.Uu=e.Uu,this.mutatedKeys=e.mutatedKeys;const s=e.Gu.pu();s.sort((p,_)=>function(v,E){const b=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return V()}};return b(v)-b(E)}(p.type,_.type)||this.Lu(p.doc,_.doc)),this.ju(r);const u=t?this.Wu():[],d=0===this.Bu.size&&this.current?1:0,h=d!==this.$u;return this.$u=d,0!==s.length||h?{snapshot:new So(this.query,e.Uu,i,s,e.mutatedKeys,0===d,h,!1),zu:u}:{zu:u}}Eu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new P_,mutatedKeys:this.mutatedKeys,Mi:!1},!1)):{zu:[]}}Hu(e){return!this.Fu.has(e)&&!!this.Uu.has(e)&&!this.Uu.get(e).hasLocalMutations}ju(e){e&&(e.addedDocuments.forEach(t=>this.Fu=this.Fu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Fu=this.Fu.delete(t)),this.current=e.current)}Wu(){if(!this.current)return[];const e=this.Bu;this.Bu=K(),this.Uu.forEach(r=>{this.Hu(r.key)&&(this.Bu=this.Bu.add(r.key))});const t=[];return e.forEach(r=>{this.Bu.has(r)||t.push(new U_(r))}),this.Bu.forEach(r=>{e.has(r)||t.push(new V_(r))}),t}Ju(e){this.Fu=e.ji,this.Bu=K();const t=this.Ku(e.documents);return this.applyChanges(t,!0)}Yu(){return So.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}class lE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class dE{constructor(e){this.key=e,this.Xu=!1}}class hE{constructor(e,t,r,i,s,u){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=u,this.Zu={},this.tc=new pr(d=>tg(d),yu),this.ec=new Map,this.nc=new Set,this.sc=new fe(y.comparator),this.ic=new Map,this.rc=new df,this.oc={},this.uc=new Map,this.cc=xi.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return!0===this.ac}}function fE(n,e){return Zf.apply(this,arguments)}function Zf(){return Zf=(0,x.Z)(function*(n,e){const t=yp(n);let r,i;const s=t.tc.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Yu();else{const u=yield Io(t.localStore,ut(e));t.isPrimaryClient&&ud(t.remoteStore,u);const d=t.sharedClientState.addLocalQueryTarget(u.targetId);r=u.targetId,i=yield Yf(t,e,r,"current"===d)}return i}),Zf.apply(this,arguments)}function Yf(n,e,t,r){return Xf.apply(this,arguments)}function Xf(){return Xf=(0,x.Z)(function*(n,e,t,r){n.hc=(_,v,E)=>{return(b=(0,x.Z)(function*(S,R,L,Y){let te=R.view.Ku(L);te.Mi&&(te=yield id(S.localStore,R.query,!1).then(({documents:z})=>R.view.Ku(z,te)));const J=Y&&Y.targetChanges.get(R.targetId),$=R.view.applyChanges(te,S.isPrimaryClient,J);return ap(S,R.targetId,$.zu),$.snapshot}),function(S,R,L,Y){return b.apply(this,arguments)})(n,_,v,E);var b};const i=yield id(n.localStore,e,!0),s=new B_(e,i.ji),u=s.Ku(i.documents),d=Tu.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),h=s.applyChanges(u,n.isPrimaryClient,d);ap(n,t,h.zu);const p=new lE(e,t,s);return n.tc.set(e,p),n.ec.has(t)?n.ec.get(t).push(e):n.ec.set(t,[e]),h.snapshot}),Xf.apply(this,arguments)}function pE(n,e){return Jf.apply(this,arguments)}function Jf(){return Jf=(0,x.Z)(function*(n,e){const t=O(n),r=t.tc.get(e),i=t.ec.get(r.targetId);if(i.length>1)return t.ec.set(r.targetId,i.filter(s=>!yu(s,e))),void t.tc.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Eo(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Uu(t.remoteStore,r.targetId),xo(t,r.targetId)}).catch(Ut))):(xo(t,r.targetId),yield Eo(t.localStore,r.targetId,!0))}),Jf.apply(this,arguments)}function Qf(){return Qf=(0,x.Z)(function*(n,e,t){const r=vp(n);try{const i=yield function(s,u){const d=O(s),h=c.now(),p=u.reduce((E,b)=>E.add(b.key),K());let _,v;return d.persistence.runTransaction("Locally write mutations","readwrite",E=>{let b=ct(),S=K();return d.Ui.getEntries(E,p).next(R=>{b=R,b.forEach((L,Y)=>{Y.isValidDocument()||(S=S.add(L))})}).next(()=>d.localDocuments.getOverlayedDocuments(E,b)).next(R=>{_=R;const L=[];for(const Y of u){const te=TI(Y,_.get(Y.key).overlayedDocument);null!=te&&L.push(new xn(Y.key,te,Km(te.value.mapValue),de.exists(!0)))}return d.mutationQueue.addMutationBatch(E,h,L,u)}).next(R=>{v=R;const L=R.applyToLocalDocumentSet(_,S);return d.documentOverlayCache.saveOverlays(E,R.batchId,L)})}).then(()=>({batchId:v.batchId,changes:Ig(_)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,u,d){let h=s.oc[s.currentUser.toKey()];h||(h=new fe(H)),h=h.insert(u,d),s.oc[s.currentUser.toKey()]=h}(r,i.batchId,t),yield Dn(r,i.changes),yield bo(r.remoteStore)}catch(i){const s=Ao(i,"Failed to persist write");t.reject(s)}}),Qf.apply(this,arguments)}function G_(n,e){return ep.apply(this,arguments)}function ep(){return ep=(0,x.Z)(function*(n,e){const t=O(n);try{const r=yield F0(t.localStore,e);e.targetChanges.forEach((i,s)=>{const u=t.ic.get(s);u&&(G(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?u.Xu=!0:i.modifiedDocuments.size>0?G(u.Xu):i.removedDocuments.size>0&&(G(u.Xu),u.Xu=!1))}),yield Dn(t,r,e)}catch(r){yield Ut(r)}}),ep.apply(this,arguments)}function j_(n,e,t){const r=O(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.tc.forEach((s,u)=>{const d=u.view.Eu(e);d.snapshot&&i.push(d.snapshot)}),function(s,u){const d=O(s);d.onlineState=u;let h=!1;d.queries.forEach((p,_)=>{for(const v of _.listeners)v.Eu(u)&&(h=!0)}),h&&zf(d)}(r.eventManager,e),i.length&&r.Zu.Go(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function gE(n,e,t){return tp.apply(this,arguments)}function tp(){return tp=(0,x.Z)(function*(n,e,t){const r=O(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.ic.get(e),s=i&&i.key;if(s){let u=new fe(y.comparator);u=u.insert(s,ie.newNoDocument(s,o.min()));const d=K().add(s),h=new bu(o.min(),new Map,new ne(H),u,d);yield G_(r,h),r.sc=r.sc.remove(s),r.ic.delete(e),up(r)}else yield Eo(r.localStore,e,!1).then(()=>xo(r,e,t)).catch(Ut)}),tp.apply(this,arguments)}function _E(n,e){return np.apply(this,arguments)}function np(){return np=(0,x.Z)(function*(n,e){const t=O(n),r=e.batch.batchId;try{const i=yield P0(t.localStore,e);op(t,r,null),sp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Dn(t,i)}catch(i){yield Ut(i)}}),np.apply(this,arguments)}function yE(n,e,t){return rp.apply(this,arguments)}function rp(){return rp=(0,x.Z)(function*(n,e,t){const r=O(n);try{const i=yield function(s,u){const d=O(s);return d.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let p;return d.mutationQueue.lookupMutationBatch(h,u).next(_=>(G(null!==_),p=_.keys(),d.mutationQueue.removeMutationBatch(h,_))).next(()=>d.mutationQueue.performConsistencyCheck(h)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(h,p,u)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,p)).next(()=>d.localDocuments.getDocuments(h,p))})}(r.localStore,e);op(r,e,t),sp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Dn(r,i)}catch(i){yield Ut(i)}}),rp.apply(this,arguments)}function ip(){return ip=(0,x.Z)(function*(n,e){const t=O(n);yr(t.remoteStore)||M("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(s){const u=O(s);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",d=>u.mutationQueue.getHighestUnacknowledgedBatchId(d))}(t.localStore);if(-1===r)return void e.resolve();const i=t.uc.get(r)||[];i.push(e),t.uc.set(r,i)}catch(r){const i=Ao(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),ip.apply(this,arguments)}function sp(n,e){(n.uc.get(e)||[]).forEach(t=>{t.resolve()}),n.uc.delete(e)}function op(n,e,t){const r=O(n);let i=r.oc[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.oc[r.currentUser.toKey()]=i}}function xo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.ec.get(e))n.tc.delete(r),t&&n.Zu.lc(r,t);n.ec.delete(e),n.isPrimaryClient&&n.rc.us(e).forEach(r=>{n.rc.containsKey(r)||q_(n,r)})}function q_(n,e){n.nc.delete(e.path.canonicalString());const t=n.sc.get(e);null!==t&&(Uu(n.remoteStore,t),n.sc=n.sc.remove(e),n.ic.delete(t),up(n))}function ap(n,e,t){for(const r of t)r instanceof V_?(n.rc.addReference(r.key,e),IE(n,r)):r instanceof U_?(M("SyncEngine","Document no longer in limbo: "+r.key),n.rc.removeReference(r.key,e),n.rc.containsKey(r.key)||q_(n,r.key)):V()}function IE(n,e){const t=e.key,r=t.path.canonicalString();n.sc.get(t)||n.nc.has(r)||(M("SyncEngine","New document in limbo: "+t),n.nc.add(r),up(n))}function up(n){for(;n.nc.size>0&&n.sc.size<n.maxConcurrentLimboResolutions;){const e=n.nc.values().next().value;n.nc.delete(e);const t=new y(l.fromString(e)),r=n.cc.next();n.ic.set(r,new dE(t)),n.sc=n.sc.insert(t,r),ud(n.remoteStore,new mr(ut(co(t.path)),r,2,at.ot))}}function Dn(n,e,t){return cp.apply(this,arguments)}function cp(){return cp=(0,x.Z)(function*(n,e,t){const r=O(n),i=[],s=[],u=[];var d;r.tc.isEmpty()||(r.tc.forEach((d,h)=>{u.push(r.hc(h,e,t).then(p=>{if(p){r.isPrimaryClient&&r.sharedClientState.updateQueryState(h.targetId,p.fromCache?"not-current":"current"),i.push(p);const _=mf.Vi(h.targetId,p);s.push(_)}}))}),yield Promise.all(u),r.Zu.Go(i),yield(d=(0,x.Z)(function*(h,p){const _=O(h);try{yield _.persistence.runTransaction("notifyLocalViewChanges","readwrite",v=>w.forEach(p,E=>w.forEach(E.Pi,b=>_.persistence.referenceDelegate.addReference(v,E.targetId,b)).next(()=>w.forEach(E.vi,b=>_.persistence.referenceDelegate.removeReference(v,E.targetId,b)))))}catch(v){if(!cr(v))throw v;M("LocalStore","Failed to update sequence numbers: "+v)}for(const v of p){const E=v.targetId;if(!v.fromCache){const b=_.$i.get(E),R=b.withLastLimboFreeSnapshotVersion(b.snapshotVersion);_.$i=_.$i.insert(E,R)}}}),function(h,p){return d.apply(this,arguments)})(r.localStore,s))}),cp.apply(this,arguments)}function EE(n,e){return lp.apply(this,arguments)}function lp(){return lp=(0,x.Z)(function*(n,e){const t=O(n);if(!t.currentUser.isEqual(e)){M("SyncEngine","User change. New user:",e.toKey());const r=yield __(t.localStore,e);t.currentUser=e,(i=t).uc.forEach(u=>{u.forEach(d=>{d.reject(new D(C.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.uc.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Dn(t,r.Ki)}var i}),lp.apply(this,arguments)}function wE(n,e){const t=O(n),r=t.ic.get(e);if(r&&r.Xu)return K().add(r.key);{let i=K();const s=t.ec.get(e);if(!s)return i;for(const u of s){const d=t.tc.get(u);i=i.unionWith(d.view.qu)}return i}}function bE(n,e){return dp.apply(this,arguments)}function dp(){return dp=(0,x.Z)(function*(n,e){const t=O(n),r=yield id(t.localStore,e.query,!0),i=e.view.Ju(r);return t.isPrimaryClient&&ap(t,e.targetId,i.zu),i}),dp.apply(this,arguments)}function TE(n,e){return hp.apply(this,arguments)}function hp(){return hp=(0,x.Z)(function*(n,e){const t=O(n);return E_(t.localStore,e).then(r=>Dn(t,r))}),hp.apply(this,arguments)}function AE(n,e,t,r){return fp.apply(this,arguments)}function fp(){return fp=(0,x.Z)(function*(n,e,t,r){const i=O(n),s=yield function(u,d){const h=O(u),p=O(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",_=>p.yn(_,d).next(v=>v?h.localDocuments.getDocuments(_,v):w.resolve(null)))}(i.localStore,e);var d;null!==s?("pending"===t?yield bo(i.remoteStore):"acknowledged"===t||"rejected"===t?(op(i,e,r||null),sp(i,e),d=e,O(O(i.localStore).mutationQueue).In(d)):V(),yield Dn(i,s)):M("SyncEngine","Cannot apply mutation batch with id: "+e)}),fp.apply(this,arguments)}function pp(){return pp=(0,x.Z)(function*(n,e){const t=O(n);if(yp(t),vp(t),!0===e&&!0!==t.ac){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield H_(t,r.toArray());t.ac=!0,yield Bf(t.remoteStore,!0);for(const s of i)ud(t.remoteStore,s)}else if(!1===e&&!1!==t.ac){const r=[];let i=Promise.resolve();t.ec.forEach((s,u)=>{t.sharedClientState.isLocalQueryTarget(u)?r.push(u):i=i.then(()=>(xo(t,u),Eo(t.localStore,u,!0))),Uu(t.remoteStore,u)}),yield i,yield H_(t,r),function(s){const u=O(s);u.ic.forEach((d,h)=>{Uu(u.remoteStore,h)}),u.rc.cs(),u.ic=new Map,u.sc=new fe(y.comparator)}(t),t.ac=!1,yield Bf(t.remoteStore,!1)}}),pp.apply(this,arguments)}function H_(n,e,t){return mp.apply(this,arguments)}function mp(){return mp=(0,x.Z)(function*(n,e,t){const r=O(n),i=[],s=[];for(const u of e){let d;const h=r.ec.get(u);if(h&&0!==h.length){d=yield Io(r.localStore,ut(h[0]));for(const p of h){const _=r.tc.get(p),v=yield bE(r,_);v.snapshot&&s.push(v.snapshot)}}else{const p=yield I_(r.localStore,u);d=yield Io(r.localStore,p),yield Yf(r,$_(p),u,!1)}i.push(d)}return r.Zu.Go(s),i}),mp.apply(this,arguments)}function $_(n){return Qm(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function SE(n){const e=O(n);return O(O(e.localStore).persistence).Ri()}function xE(n,e,t,r){return gp.apply(this,arguments)}function gp(){return gp=(0,x.Z)(function*(n,e,t,r){const i=O(n);if(i.ac)return void M("SyncEngine","Ignoring unexpected query state notification.");const s=i.ec.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const u=yield E_(i.localStore,ng(s[0])),d=bu.createSynthesizedRemoteEventForCurrentChange(e,"current"===t);yield Dn(i,u,d);break}case"rejected":yield Eo(i.localStore,e,!0),xo(i,e,r);break;default:V()}}),gp.apply(this,arguments)}function DE(n,e,t){return _p.apply(this,arguments)}function _p(){return _p=(0,x.Z)(function*(n,e,t){const r=yp(n);if(r.ac){for(const i of e){if(r.ec.has(i)){M("SyncEngine","Adding an already active target "+i);continue}const s=yield I_(r.localStore,i),u=yield Io(r.localStore,s);yield Yf(r,$_(s),u.targetId,!1),ud(r.remoteStore,u)}for(const i of t)r.ec.has(i)&&(yield Eo(r.localStore,i,!1).then(()=>{Uu(r.remoteStore,i),xo(r,i)}).catch(Ut))}}),_p.apply(this,arguments)}function yp(n){const e=O(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=G_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=wE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gE.bind(null,e),e.Zu.Go=oE.bind(null,e.eventManager),e.Zu.lc=aE.bind(null,e.eventManager),e}function vp(n){const e=O(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=_E.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=yE.bind(null,e),e}class K_{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,x.Z)(function*(){t.wt=Lu(e.databaseInfo.databaseId),t.sharedClientState=t.dc(e),t.persistence=t._c(e),yield t.persistence.start(),t.localStore=t.wc(e),t.gcScheduler=t.mc(e,t.localStore),t.indexBackfillerScheduler=t.gc(e,t.localStore)})()}mc(e,t){return null}gc(e,t){return null}wc(e){return g_(this.persistence,new m_,e.initialUser,this.wt)}_c(e){return new f_(nd.Os,this.wt)}dc(e){return new A_}terminate(){var e=this;return(0,x.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class z_ extends K_{constructor(e,t,r){super(),this.yc=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,x.Z)(function*(){yield t().call(r,e),yield r.yc.initialize(r,e),yield vp(r.yc.syncEngine),yield bo(r.yc.remoteStore),yield r.persistence.ci(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}wc(e){return g_(this.persistence,new m_,e.initialUser,this.wt)}mc(e,t){return new I0(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}gc(e,t){const r=new nI(t,this.persistence);return new tI(e.asyncQueue,r)}_c(e){const t=pf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?lt.withCacheSize(this.cacheSizeBytes):lt.DEFAULT;return new ff(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,S_(),ad(),this.wt,this.sharedClientState,!!this.forceOwnership)}dc(e){return new A_}}class kE extends z_{constructor(e,t){super(e,t,!1),this.yc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,x.Z)(function*(){yield t().call(r,e);const i=r.yc.syncEngine;r.sharedClientState instanceof bf&&(r.sharedClientState.syncEngine={kr:AE.bind(null,i),Mr:xE.bind(null,i),Or:DE.bind(null,i),Ri:SE.bind(null,i),Nr:TE.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.ci(function(){var s=(0,x.Z)(function*(u){yield function CE(n,e){return pp.apply(this,arguments)}(r.yc.syncEngine,u),r.gcScheduler&&(u&&!r.gcScheduler.started?r.gcScheduler.start():u||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(u&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():u||r.indexBackfillerScheduler.stop())});return function(u){return s.apply(this,arguments)}}())})()}dc(e){const t=S_();if(!bf.V(t))throw new D(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=pf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new bf(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Ip{initialize(e,t){var r=this;return(0,x.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>j_(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=EE.bind(null,r.syncEngine),yield Bf(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new sE}createDatastore(e){const t=Lu(e.databaseInfo.databaseId),r=new q0(e.databaseInfo);return new K0(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,i=e.asyncQueue,s=d=>j_(this.syncEngine,d,0),u=C_.V()?new C_:new B0,new W0(t,r,i,s,u);var t,r,i,s,u}createSyncEngine(e,t){return function(r,i,s,u,d,h,p){const _=new hE(r,i,s,u,d,h);return p&&(_.ac=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,x.Z)(function*(t){const r=O(t);M("RemoteStore","RemoteStore shutting down."),r.lu.add(5),yield wo(r),r.du.shutdown(),r._u.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function W_(n,e=10240){let t=0;return{read:()=>(0,x.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,x.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class ld{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ic(this.observer.next,e)}error(e){this.observer.error?this.Ic(this.observer.error,e):oe("Uncaught Error in snapshot listener:",e)}Tc(){this.muted=!0}Ic(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class NE{constructor(e,t){this.Ec=e,this.wt=t,this.metadata=new ve,this.buffer=new Uint8Array,this.Ac=new TextDecoder("utf-8"),this.Rc().then(r=>{r&&r.Cu()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.payload)}`))},r=>this.metadata.reject(r))}close(){return this.Ec.cancel()}getMetadata(){var e=this;return(0,x.Z)(function*(){return e.metadata.promise})()}fc(){var e=this;return(0,x.Z)(function*(){return yield e.getMetadata(),e.Rc()})()}Rc(){var e=this;return(0,x.Z)(function*(){const t=yield e.bc();if(null===t)return null;const r=e.Ac.decode(t),i=Number(r);isNaN(i)&&e.Pc(`length string (${r}) is not valid number`);const s=yield e.vc(i);return new uE(JSON.parse(s),t.length+i)})()}Vc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}bc(){var e=this;return(0,x.Z)(function*(){for(;e.Vc()<0&&!(yield e.Sc()););if(0===e.buffer.length)return null;const t=e.Vc();t<0&&e.Pc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}vc(e){var t=this;return(0,x.Z)(function*(){for(;t.buffer.length<e;)(yield t.Sc())&&t.Pc("Reached the end of bundle when more is expected.");const r=t.Ac.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Pc(e){throw this.Ec.cancel(),new Error(`Invalid bundle format: ${e}`)}Sc(){var e=this;return(0,x.Z)(function*(){const t=yield e.Ec.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class RE{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,x.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new D(C.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,x.Z)(function*(s,u){const d=O(s),h=Su(d.wt)+"/documents",p={documents:u.map(b=>Cu(d.wt,b))},_=yield d.ao("BatchGetDocuments",h,p,u.length),v=new Map;_.forEach(b=>{const S=function PI(n,e){return"found"in e?function(t,r){G(!!r.found);const i=en(t,r.found.name),s=Pe(r.found.updateTime),u=new $e({mapValue:{fields:r.found.fields}});return ie.newFoundDocument(i,s,u)}(n,e):"missing"in e?function(t,r){G(!!r.missing),G(!!r.readTime);const i=en(t,r.missing),s=Pe(r.readTime);return ie.newNoDocument(i,s)}(n,e):V()}(d.wt,b);v.set(S.key.toString(),S)});const E=[];return u.forEach(b=>{const S=v.get(b.toString());G(!!S),E.push(S)}),E}),function(s,u){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new mo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,x.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=y.fromPath(i);e.mutations.push(new Jh(s,e.precondition(s)))}),yield(r=(0,x.Z)(function*(i,s){const u=O(i),d=Su(u.wt)+"/documents",h={writes:s.map(p=>xu(u.wt,p))};yield u.ro("Commit",d,h)}),function(i,s){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw V();t=o.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new D(C.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?de.updateTime(t):de.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(o.min()))throw new D(C.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return de.updateTime(t)}return de.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class OE{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Dc=r.maxAttempts,this.So=new Tf(this.asyncQueue,"transaction_retry")}run(){this.Dc-=1,this.Cc()}Cc(){var e=this;this.So.Io((0,x.Z)(function*(){const t=new RE(e.datastore),r=e.xc(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.Nc(s)}))}).catch(i=>{e.Nc(i)})}))}xc(e){try{const t=this.updateFunction(e);return!hu(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Nc(e){this.Dc>0&&this.kc(e)?(this.Dc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Cc(),Promise.resolve()))):this.deferred.reject(e)}kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!_g(t)}return!1}}class PE{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ce.UNAUTHENTICATED,this.clientId=Pl.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var u=(0,x.Z)(function*(d){M("FirestoreClient","Received user=",d.uid),yield s.authCredentialListener(d),s.user=d});return function(d){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(r,u=>(M("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}getConfiguration(){var e=this;return(0,x.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new D(C.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ve;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,x.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Ao(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Z_(n,e){return Ep.apply(this,arguments)}function Ep(){return Ep=(0,x.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),M("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,x.Z)(function*(s){r.isEqual(s)||(yield __(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Ep.apply(this,arguments)}function Y_(n,e){return wp.apply(this,arguments)}function wp(){return wp=(0,x.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield bp(n);M("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>O_(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>O_(e.remoteStore,s)),n.onlineComponents=e}),wp.apply(this,arguments)}function bp(n){return Tp.apply(this,arguments)}function Tp(){return Tp=(0,x.Z)(function*(n){return n.offlineComponents||(M("FirestoreClient","Using default OfflineComponentProvider"),yield Z_(n,new K_)),n.offlineComponents}),Tp.apply(this,arguments)}function dd(n){return Ap.apply(this,arguments)}function Ap(){return Ap=(0,x.Z)(function*(n){return n.onlineComponents||(M("FirestoreClient","Using default OnlineComponentProvider"),yield Y_(n,new Ip)),n.onlineComponents}),Ap.apply(this,arguments)}function X_(n){return bp(n).then(e=>e.persistence)}function hd(n){return bp(n).then(e=>e.localStore)}function J_(n){return dd(n).then(e=>e.remoteStore)}function Cp(n){return dd(n).then(e=>e.syncEngine)}function Do(n){return Sp.apply(this,arguments)}function Sp(){return Sp=(0,x.Z)(function*(n){const e=yield dd(n),t=e.eventManager;return t.onListen=fE.bind(null,e.syncEngine),t.onUnlisten=pE.bind(null,e.syncEngine),t}),Sp.apply(this,arguments)}function Q_(n,e,t={}){const r=new ve;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function(i,s,u,d,h){const p=new ld({next:v=>{s.enqueueAndForget(()=>$f(i,_));const E=v.docs.has(u);!E&&v.fromCache?h.reject(new D(C.UNAVAILABLE,"Failed to get document because the client is offline.")):E&&v.fromCache&&d&&"server"===d.source?h.reject(new D(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(v)},error:v=>h.reject(v)}),_=new Wf(co(u.path),p,{includeMetadataChanges:!0,Du:!0});return qf(i,_)}(yield Do(n),n.asyncQueue,e,t,r)})),r.promise}function ey(n,e,t={}){const r=new ve;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function(i,s,u,d,h){const p=new ld({next:v=>{s.enqueueAndForget(()=>$f(i,_)),v.fromCache&&"server"===d.source?h.reject(new D(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(v)},error:v=>h.reject(v)}),_=new Wf(u,p,{includeMetadataChanges:!0,Du:!0});return qf(i,_)}(yield Do(n),n.asyncQueue,e,t,r)})),r.promise}const ty=new Map;function xp(n,e,t){if(!t)throw new D(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ny(n,e,t,r){if(!0===e&&!0===r)throw new D(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ry(n){if(!y.isDocumentKey(n))throw new D(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function iy(n){if(y.isDocumentKey(n))throw new D(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function fd(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":V()}function Q(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=fd(n);throw new D(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function sy(n,e){if(e<=0)throw new D(C.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class oy{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new D(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new D(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,ny("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Bu{constructor(e,t,r){this._authCredentials=t,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new oy({}),this._settingsFrozen=!1,e instanceof Cn?this._databaseId=e:(this._app=e,this._databaseId=function(i){if(!Object.prototype.hasOwnProperty.apply(i.options,["projectId"]))throw new D(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cn(i.options.projectId)}(e))}get app(){if(!this._app)throw new D(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new D(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new oy(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new iu;switch(t.type){case"gapi":const r=t.client;return G(!("object"!=typeof r||null===r||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new li(r,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new D(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ty.get(e);t&&(M("ComponentProvider","Removing Datastore"),ty.delete(e),t.terminate())}(this),Promise.resolve()}}class ae{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ae(this.firestore,e,this._key)}}class Qe{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Qe(this.firestore,e,this._query)}}class nn extends Qe{constructor(e,t,r){super(e,t,co(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ae(this.firestore,null,new y(e))}withConverter(e){return new nn(this.firestore,e,this._path)}}function ay(n,e,...t){if(n=(0,W.m9)(n),xp("collection","path",e),n instanceof Bu){const r=l.fromString(e,...t);return iy(r),new nn(n,null,r)}{if(!(n instanceof ae||n instanceof nn))throw new D(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(l.fromString(e,...t));return iy(r),new nn(n.firestore,null,r)}}function pd(n,e,...t){if(n=(0,W.m9)(n),1===arguments.length&&(e=Pl.I()),xp("doc","path",e),n instanceof Bu){const r=l.fromString(e,...t);return ry(r),new ae(n,null,new y(r))}{if(!(n instanceof ae||n instanceof nn))throw new D(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(l.fromString(e,...t));return ry(r),new ae(n.firestore,n instanceof nn?n.converter:null,new y(r))}}function uy(n,e){return n=(0,W.m9)(n),e=(0,W.m9)(e),(n instanceof ae||n instanceof nn)&&(e instanceof ae||e instanceof nn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function cy(n,e){return n=(0,W.m9)(n),e=(0,W.m9)(e),n instanceof Qe&&e instanceof Qe&&n.firestore===e.firestore&&yu(n._query,e._query)&&n.converter===e.converter}class KE{constructor(){this.Mc=Promise.resolve(),this.Oc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new Tf(this,"async_queue_retry"),this.Kc=()=>{const t=ad();t&&M("AsyncQueue","Visibility state changed to "+t.visibilityState),this.So.Eo()};const e=ad();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Gc(),this.Qc(e)}enterRestrictedMode(e){if(!this.Fc){this.Fc=!0,this.Uc=e||!1;const t=ad();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Kc)}}enqueue(e){if(this.Gc(),this.Fc)return new Promise(()=>{});const t=new ve;return this.Qc(()=>this.Fc&&this.Uc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Oc.push(e),this.jc()))}jc(){var e=this;return(0,x.Z)(function*(){if(0!==e.Oc.length){try{yield e.Oc[0](),e.Oc.shift(),e.So.reset()}catch(t){if(!cr(t))throw t;M("AsyncQueue","Operation failed with retryable error: "+t)}e.Oc.length>0&&e.So.Io(()=>e.jc())}})()}Qc(e){const t=this.Mc.then(()=>(this.Lc=!0,e().catch(r=>{throw this.Bc=r,this.Lc=!1,oe("INTERNAL UNHANDLED ERROR: ",function(s){let u=s.message||"";return s.stack&&(u=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),u}(r)),r}).then(r=>(this.Lc=!1,r))));return this.Mc=t,t}enqueueAfterDelay(e,t,r){this.Gc(),this.qc.indexOf(e)>-1&&(t=0);const i=jf.createAndSchedule(this,e,t,r,s=>this.Wc(s));return this.$c.push(i),i}Gc(){this.Bc&&V()}verifyOperationInProgress(){}zc(){var e=this;return(0,x.Z)(function*(){let t;do{t=e.Mc,yield t}while(t!==e.Mc)})()}Hc(e){for(const t of this.$c)if(t.timerId===e)return!0;return!1}Jc(e){return this.zc().then(()=>{this.$c.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.$c)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.zc()})}Yc(e){this.qc.push(e)}Wc(e){const t=this.$c.indexOf(e);this.$c.splice(t,1)}}function Dp(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const i of["next","error","complete"])if(i in r&&"function"==typeof r[i])return!0;return!1}(n)}class zE{constructor(){this._progressObserver={},this._taskCompletionResolver=new ve,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ce extends Bu{constructor(e,t,r){super(e,t,r),this.type="firestore",this._queue=new KE,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||ly(this),this._firestoreClient.terminate()}}function De(n){return n._firestoreClient||ly(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function ly(n){var e;const t=n._freezeSettings(),r=(s=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new sI(n._databaseId,s,n._persistenceKey,(d=t).host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,d.useFetchStreams));var s,d;n._firestoreClient=new PE(n._authCredentials,n._appCheckCredentials,n._queue,r)}function dy(n,e,t){const r=new ve;return n.asyncQueue.enqueue((0,x.Z)(function*(){try{yield Z_(n,t),yield Y_(n,e),r.resolve()}catch(i){const s=i;if(!("FirebaseError"===(u=s).name?u.code===C.FAILED_PRECONDITION||u.code===C.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&u instanceof DOMException)||22===u.code||20===u.code||11===u.code))throw s;An("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}var u})).then(()=>r.promise)}function hy(n){if(n._initialized||n._terminated)throw new D(C.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Mn{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new D(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new g(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class rn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new rn(Ne.fromBase64String(e))}catch(t){throw new D(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new rn(Ne.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Mi{constructor(e){this._methodName=e}}class md{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return H(this._lat,e._lat)||H(this._long,e._long)}}const rw=/^__.*__$/;class iw{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new xn(e,this.data,this.fieldMask,t,this.fieldTransforms):new po(e,this.data,t,this.fieldTransforms)}}class fy{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new xn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function py(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw V()}}class gd{constructor(e,t,r,i,s,u){this.settings=e,this.databaseId=t,this.wt=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Xc(),this.fieldTransforms=s||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Zc(){return this.settings.Zc}ta(e){return new gd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ea(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ta({path:r,na:!1});return i.sa(e),i}ia(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ta({path:r,na:!1});return i.Xc(),i}ra(e){return this.ta({path:void 0,na:!0})}oa(e){return vd(e,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.sa(this.path.get(e))}sa(e){if(0===e.length)throw this.oa("Document fields must not be empty");if(py(this.Zc)&&rw.test(e))throw this.oa('Document fields cannot begin and end with "__"')}}class sw{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.wt=r||Lu(e)}aa(e,t,r,i=!1){return new gd({Zc:e,methodName:t,ca:r,path:g.emptyPath(),na:!1,ua:i},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}function ki(n){const e=n._freezeSettings(),t=Lu(n._databaseId);return new sw(n._databaseId,!!e.ignoreUndefinedProperties,t)}function _d(n,e,t,r,i,s={}){const u=n.aa(s.merge||s.mergeFields?2:0,e,t,i);Rp("Data must be an object, but it was:",u,r);const d=_y(r,u);let h,p;if(s.merge)h=new gt(u.fieldMask),p=u.fieldTransforms;else if(s.mergeFields){const _=[];for(const v of s.mergeFields){const E=Op(e,v,t);if(!u.contains(E))throw new D(C.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);vy(_,E)||_.push(E)}h=new gt(_),p=u.fieldTransforms.filter(v=>h.covers(v.field))}else h=null,p=u.fieldTransforms;return new iw(new $e(d),h,p)}class Gu extends Mi{_toFieldTransform(e){if(2!==e.Zc)throw e.oa(1===e.Zc?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Gu}}function my(n,e,t){return new gd({Zc:3,ca:e.settings.ca,methodName:n._methodName,na:t},e.databaseId,e.wt,e.ignoreUndefinedProperties)}class Mp extends Mi{_toFieldTransform(e){return new vu(e.path,new ho)}isEqual(e){return e instanceof Mp}}class ow extends Mi{constructor(e,t){super(e),this.ha=t}_toFieldTransform(e){const t=my(this,e,!0),r=this.ha.map(s=>Ni(s,t)),i=new Ii(r);return new vu(e.path,i)}isEqual(e){return this===e}}class aw extends Mi{constructor(e,t){super(e),this.ha=t}_toFieldTransform(e){const t=my(this,e,!0),r=this.ha.map(s=>Ni(s,t)),i=new Ei(r);return new vu(e.path,i)}isEqual(e){return this===e}}class uw extends Mi{constructor(e,t){super(e),this.la=t}_toFieldTransform(e){const t=new fo(e.wt,og(e.wt,this.la));return new vu(e.path,t)}isEqual(e){return this===e}}function kp(n,e,t,r){const i=n.aa(1,e,t);Rp("Data must be an object, but it was:",i,r);const s=[],u=$e.empty();mi(r,(h,p)=>{const _=yd(e,h,t);p=(0,W.m9)(p);const v=i.ia(_);if(p instanceof Gu)s.push(_);else{const E=Ni(p,v);null!=E&&(s.push(_),u.set(_,E))}});const d=new gt(s);return new fy(u,d,i.fieldTransforms)}function Np(n,e,t,r,i,s){const u=n.aa(1,e,t),d=[Op(e,r,t)],h=[i];if(s.length%2!=0)throw new D(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<s.length;E+=2)d.push(Op(e,s[E])),h.push(s[E+1]);const p=[],_=$e.empty();for(let E=d.length-1;E>=0;--E)if(!vy(p,d[E])){const b=d[E];let S=h[E];S=(0,W.m9)(S);const R=u.ia(b);if(S instanceof Gu)p.push(b);else{const L=Ni(S,R);null!=L&&(p.push(b),_.set(b,L))}}const v=new gt(p);return new fy(_,v,u.fieldTransforms)}function gy(n,e,t,r=!1){return Ni(t,n.aa(r?4:3,e))}function Ni(n,e){if(yy(n=(0,W.m9)(n)))return Rp("Unsupported field value:",e,n),_y(n,e);if(n instanceof Mi)return function(t,r){if(!py(r.Zc))throw r.oa(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.oa(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.na&&4!==e.Zc)throw e.oa("Nested arrays are not supported");return function(t,r){const i=[];let s=0;for(const u of t){let d=Ni(u,r.ra(s));null==d&&(d={nullValue:"NULL_VALUE"}),i.push(d),s++}return{arrayValue:{values:i}}}(n,e)}return function(t,r){if(null===(t=(0,W.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return og(r.wt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=c.fromDate(t);return{timestampValue:Au(r.wt,i)}}if(t instanceof c){const i=new c(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Au(r.wt,i)}}if(t instanceof md)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof rn)return{bytesValue:Sg(r.wt,t._byteString)};if(t instanceof ae){const i=r.databaseId,s=t.firestore._databaseId;if(!s.isEqual(i))throw r.oa(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Qh(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.oa(`Unsupported field value: ${fd(t)}`)}(n,e)}function _y(n,e){const t={};return Fm(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):mi(n,(r,i)=>{const s=Ni(i,e.ea(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function yy(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof c||n instanceof md||n instanceof rn||n instanceof ae||n instanceof Mi)}function Rp(n,e,t){if(!yy(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=fd(t);throw e.oa("an object"===r?n+" a custom object":n+" "+r)}var r}function Op(n,e,t){if((e=(0,W.m9)(e))instanceof Mn)return e._internalPath;if("string"==typeof e)return yd(n,e);throw vd("Field path arguments must be of type string or ",n,!1,void 0,t)}const cw=new RegExp("[~\\*/\\[\\]]");function yd(n,e,t){if(e.search(cw)>=0)throw vd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Mn(...e.split("."))._internalPath}catch(r){throw vd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function vd(n,e,t,r,i){const s=r&&!r.isEmpty(),u=void 0!==i;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(s||u)&&(h+=" (found",s&&(h+=` in field ${r}`),u&&(h+=` in document ${i}`),h+=")"),new D(C.INVALID_ARGUMENT,d+n+h)}function vy(n,e){return n.some(t=>t.isEqual(e))}class ju{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ae(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new lw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Id("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class lw extends ju{data(){return super.data()}}function Id(n,e){return"string"==typeof e?yd(n,e):e instanceof Mn?e._internalPath:e._delegate._internalPath}class Ri{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class kn extends ju{constructor(e,t,r,i,s,u){super(e,t,r,i,u),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new qu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Id("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class qu extends kn{data(e={}){return super.data(e)}}class Ir{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ri(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new qu(this._firestore,this._userDataWriter,r.key,r,new Ri(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let s=0;return r._snapshot.docChanges.map(u=>({type:"added",doc:new qu(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Ri(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:s++}))}{let s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const d=new qu(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Ri(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let h=-1,p=-1;return 0!==u.type&&(h=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),1!==u.type&&(s=s.add(u.doc),p=s.indexOf(u.doc.key)),{type:dw(u.type),doc:d,oldIndex:h,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function dw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return V()}}function Iy(n,e){return n instanceof kn&&e instanceof kn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ir&&e instanceof Ir&&n._firestore===e._firestore&&cy(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function Ey(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new D(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Hu{}function Er(n,...e){for(const t of e)n=t._apply(n);return n}class hw extends Hu{constructor(e,t,r){super(),this.fa=e,this.da=t,this._a=r,this.type="where"}_apply(e){const t=ki(e.firestore),r=function(i,s,u,d,h,p,_){let v;if(h.isKeyField()){if("array-contains"===p||"array-contains-any"===p)throw new D(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if("in"===p||"not-in"===p){Sy(_,p);const b=[];for(const S of _)b.push(Cy(d,i,S));v={arrayValue:{values:b}}}else v=Cy(d,i,_)}else"in"!==p&&"not-in"!==p&&"array-contains-any"!==p||Sy(_,p),v=gy(u,"where",_,"in"===p||"not-in"===p);const E=Ke.create(h,p,v);return function(b,S){if(S.ht()){const L=Wh(b);if(null!==L&&!L.isEqual(S.field))throw new D(C.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${L.toString()}' and '${S.field.toString()}'`);const Y=zh(b);null!==Y&&xy(0,S.field,Y)}const R=function(L,Y){for(const te of L.filters)if(Y.indexOf(te.op)>=0)return te.op;return null}(b,function(L){switch(L){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(S.op));if(null!==R)throw new D(C.INVALID_ARGUMENT,R===S.op?`Invalid query. You cannot use more than one '${S.op.toString()}' filter.`:`Invalid query. You cannot use '${S.op.toString()}' filters with '${R.toString()}' filters.`)}(i,E),E}(e._query,0,t,e.firestore._databaseId,this.fa,this.da,this._a);return new Qe(e.firestore,e.converter,function(i,s){const u=i.filters.concat([s]);return new Sn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),u,i.limit,i.limitType,i.startAt,i.endAt)}(e._query,r))}}class pw extends Hu{constructor(e,t){super(),this.fa=e,this.wa=t,this.type="orderBy"}_apply(e){const t=function(r,i,s){if(null!==r.startAt)throw new D(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new D(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new uo(i,s);return function(d,h){if(null===zh(d)){const p=Wh(d);null!==p&&xy(0,p,h.field)}}(r,u),u}(e._query,this.fa,this.wa);return new Qe(e.firestore,e.converter,function(r,i){const s=r.explicitOrderBy.concat([i]);return new Sn(r.path,r.collectionGroup,s,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class wy extends Hu{constructor(e,t,r){super(),this.type=e,this.ma=t,this.ga=r}_apply(e){return new Qe(e.firestore,e.converter,jl(e._query,this.ma,this.ga))}}class by extends Hu{constructor(e,t,r){super(),this.type=e,this.ya=t,this.pa=r}_apply(e){const t=Ay(e,this.type,this.ya,this.pa);return new Qe(e.firestore,e.converter,(i=t,new Sn((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)));var r,i}}class Ty extends Hu{constructor(e,t,r){super(),this.type=e,this.ya=t,this.pa=r}_apply(e){const t=Ay(e,this.type,this.ya,this.pa);return new Qe(e.firestore,e.converter,(i=t,new Sn((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)));var r,i}}function Ay(n,e,t,r){if(t[0]=(0,W.m9)(t[0]),t[0]instanceof ju)return function(i,s,u,d,h){if(!d)throw new D(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const p=[];for(const _ of lo(i))if(_.field.isKeyField())p.push(yi(s,d.key));else{const v=d.data.field(_.field);if(Hh(v))throw new D(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+_.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===v){const E=_.field.canonicalString();throw new D(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${E}' (used as the orderBy) does not exist.`)}p.push(v)}return new fr(p,h)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=ki(n.firestore);return function(s,u,d,h,p,_){const v=s.explicitOrderBy;if(p.length>v.length)throw new D(C.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const E=[];for(let b=0;b<p.length;b++){const S=p[b];if(v[b].field.isKeyField()){if("string"!=typeof S)throw new D(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof S}`);if(!Zh(s)&&-1!==S.indexOf("/"))throw new D(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${S}' contains a slash.`);const R=s.path.child(l.fromString(S));if(!y.isDocumentKey(R))throw new D(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const L=new y(R);E.push(yi(u,L))}else{const R=gy(d,h,S);E.push(R)}}return new fr(E,_)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Cy(n,e,t){if("string"==typeof(t=(0,W.m9)(t))){if(""===t)throw new D(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Zh(e)&&-1!==t.indexOf("/"))throw new D(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(l.fromString(t));if(!y.isDocumentKey(r))throw new D(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return yi(n,new y(r))}if(t instanceof ae)return yi(n,t._key);throw new D(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fd(t)}.`)}function Sy(n,e){if(!Array.isArray(n)||0===n.length)throw new D(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new D(C.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function xy(n,e,t){if(!t.isEqual(e))throw new D(C.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}const ww={maxAttempts:5};class Pp{convertValue(e,t="none"){switch(_i(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(gi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw V()}}convertObject(e,t){const r={};return mi(e.fields,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new md(pe(e.latitude),pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Vm(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(du(e));default:return null}}convertTimestamp(e){const t=lr(e);return new c(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=l.fromString(e);G(Lg(r));const i=new Cn(r.get(1),r.get(3)),s=new y(r.popFirst(5));return i.isEqual(t)||oe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Ed(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class bw extends Pp{constructor(e){super(),this.firestore=e}convertBytes(e){return new rn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ae(this.firestore,null,t)}}class Dy{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ki(e)}set(e,t,r){this._verifyNotCommitted();const i=wr(e,this._firestore),s=Ed(i.converter,t,r),u=_d(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(u.toMutation(i._key,de.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=wr(e,this._firestore);let u;return u="string"==typeof(t=(0,W.m9)(t))||t instanceof Mn?Np(this._dataReader,"WriteBatch.update",s._key,t,r,i):kp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(u.toMutation(s._key,de.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=wr(e,this._firestore);return this._mutations=this._mutations.concat(new mo(t._key,de.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function wr(n,e){if((n=(0,W.m9)(n)).firestore!==e)throw new D(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Oi extends Pp{constructor(e){super(),this.firestore=e}convertBytes(e){return new rn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ae(this.firestore,null,t)}}function My(n,e,t){n=Q(n,ae);const r=Q(n.firestore,ce),i=Ed(n.converter,e,t);return Mo(r,[_d(ki(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,de.none())])}function ky(n,e,t,...r){n=Q(n,ae);const i=Q(n.firestore,ce),s=ki(i);let u;return u="string"==typeof(e=(0,W.m9)(e))||e instanceof Mn?Np(s,"updateDoc",n._key,e,t,r):kp(s,"updateDoc",n._key,e),Mo(i,[u.toMutation(n._key,de.exists(!0))])}function Ny(n,...e){var t,r,i;n=(0,W.m9)(n);let s={includeMetadataChanges:!1},u=0;"object"!=typeof e[u]||Dp(e[u])||(s=e[u],u++);const d={includeMetadataChanges:s.includeMetadataChanges};if(Dp(e[u])){const v=e[u];e[u]=null===(t=v.next)||void 0===t?void 0:t.bind(v),e[u+1]=null===(r=v.error)||void 0===r?void 0:r.bind(v),e[u+2]=null===(i=v.complete)||void 0===i?void 0:i.bind(v)}let h,p,_;if(n instanceof ae)p=Q(n.firestore,ce),_=co(n._key.path),h={next:v=>{e[u]&&e[u](Fp(p,n,v))},error:e[u+1],complete:e[u+2]};else{const v=Q(n,Qe);p=Q(v.firestore,ce),_=v._query;const E=new Oi(p);h={next:b=>{e[u]&&e[u](new Ir(p,E,v,b))},error:e[u+1],complete:e[u+2]},Ey(n._query)}return function(v,E,b,S){const R=new ld(S),L=new Wf(E,R,b);return v.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return qf(yield Do(v),L)})),()=>{R.Tc(),v.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return $f(yield Do(v),L)}))}}(De(p),_,d,h)}function Mo(n,e){return function(t,r){const i=new ve;return t.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function mE(n,e,t){return Qf.apply(this,arguments)}(yield Cp(t),r,i)})),i.promise}(De(n),e)}function Fp(n,e,t){const r=t.docs.get(e._key),i=new Oi(n);return new kn(n,i,e._key,r,new Ri(t.hasPendingWrites,t.fromCache),e.converter)}class Rw extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ki(e)}get(e){const t=wr(e,this._firestore),r=new bw(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||1!==i.length)return V();const s=i[0];if(s.isFoundDocument())return new ju(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new ju(this._firestore,r,t._key,null,t.converter);throw V()})}set(e,t,r){const i=wr(e,this._firestore),s=Ed(i.converter,t,r),u=_d(this._dataReader,"Transaction.set",i._key,s,null!==i.converter,r);return this._transaction.set(i._key,u),this}update(e,t,r,...i){const s=wr(e,this._firestore);let u;return u="string"==typeof(t=(0,W.m9)(t))||t instanceof Mn?Np(this._dataReader,"Transaction.update",s._key,t,r,i):kp(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,u),this}delete(e){const t=wr(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=wr(e,this._firestore),r=new Oi(this._firestore);return super.get(e).then(i=>new kn(this._firestore,r,t._key,i._document,new Ri(!1,!1),t.converter))}}function Lp(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new D("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Oy(){if("undefined"==typeof Uint8Array)throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function Py(){if(!function rI(){return"undefined"!=typeof atob}())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Se=Rt.SDK_VERSION,(0,Rt._registerComponent)(new Cs.wA("firestore",(t,{options:r})=>{const i=t.getProvider("app").getImmediate(),s=new ce(i,new jh(t.getProvider("auth-internal")),new Ol(t.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s},"PUBLIC")),(0,Rt.registerVersion)(eo,"3.4.14",n),(0,Rt.registerVersion)(eo,"3.4.14","esm2017")}();class $u{constructor(e){this._delegate=e}static fromBase64String(e){return Py(),new $u(rn.fromBase64String(e))}static fromUint8Array(e){return Oy(),new $u(rn.fromUint8Array(e))}toBase64(){return Py(),this._delegate.toBase64()}toUint8Array(){return Oy(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Vp(n){return function jw(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class qw{enableIndexedDbPersistence(e,t){return function ZE(n,e){hy(n=Q(n,ce));const t=De(n),r=n._freezeSettings(),i=new Ip;return dy(t,i,new z_(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function YE(n){hy(n=Q(n,ce));const e=De(n),t=n._freezeSettings(),r=new Ip;return dy(e,r,new kE(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function XE(n){if(n._initialized&&!n._terminated)throw new D(C.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ve;return n._queue.enqueueAndForgetEvenWhileRestricted((0,x.Z)(function*(){try{yield(t=(0,x.Z)(function*(r){if(!mt.V())return Promise.resolve();const i=r+"main";yield mt.delete(i)}),function(r){return t.apply(this,arguments)})(pf(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Fy{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Cn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&An("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function HE(n,e,t,r={}){var i;const s=(n=Q(n,Bu))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&An("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let u,d;if("string"==typeof r.mockUserToken)u=r.mockUserToken,d=Ce.MOCK_USER;else{u=(0,W.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new D(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Ce(h)}n._authCredentials=new su(new Ge(u,d))}}(this._delegate,e,t,r)}enableNetwork(){return function QE(n){return function FE(n){return n.asyncQueue.enqueue((0,x.Z)(function*(){const e=yield X_(n),t=yield J_(n);return e.setNetworkEnabled(!0),function(r){const i=O(r);return i.lu.delete(0),Vu(i)}(t)}))}(De(n=Q(n,ce)))}(this._delegate)}disableNetwork(){return function ew(n){return function LE(n){return n.asyncQueue.enqueue((0,x.Z)(function*(){const e=yield X_(n),t=yield J_(n);return e.setNetworkEnabled(!1),(r=(0,x.Z)(function*(i){const s=O(i);s.lu.add(0),yield wo(s),s._u.set("Offline")}),function(i){return r.apply(this,arguments)})(t);var r}))}(De(n=Q(n,ce)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,ny("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function JE(n){return function(e){const t=new ve;return e.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function vE(n,e){return ip.apply(this,arguments)}(yield Cp(e),t)})),t.promise}(De(n=Q(n,ce)))}(this._delegate)}onSnapshotsInSync(e){return function Nw(n,e){return function BE(n,e){const t=new ld(e);return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return r=yield Do(n),i=t,O(r).Tu.add(i),void i.next();var r,i})),()=>{t.Tc(),n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return r=yield Do(n),i=t,void O(r).Tu.delete(i);var r,i}))}}(De(n=Q(n,ce)),Dp(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ko(this,ay(this._delegate,e))}catch(t){throw nt(t,"collection()","Firestore.collection()")}}doc(e){try{return new xt(this,pd(this._delegate,e))}catch(t){throw nt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new rt(this,function $E(n,e){if(n=Q(n,Bu),xp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(C.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Qe(n,null,(t=e,new Sn(l.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw nt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function Ow(n,e,t){n=Q(n,ce);const r=Object.assign(Object.assign({},ww),t);return function(i){if(i.maxAttempts<1)throw new D(C.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function GE(n,e,t){const r=new ve;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){const i=yield(s=n,dd(s).then(u=>u.datastore));var s;new OE(n.asyncQueue,i,t,e,r).run()})),r.promise}(De(n),i=>e(new Rw(n,i)),r)}(this._delegate,t=>e(new Ly(this,t)))}batch(){return De(this._delegate),new Vy(new Dy(this._delegate,e=>Mo(this._delegate,e)))}loadBundle(e){return function tw(n,e){const t=De(n=Q(n,ce)),r=new zE;return function jE(n,e,t,r){const i=function(s,u){let d;return d="string"==typeof s?(new TextEncoder).encode(s):s,h=function(h,p){if(h instanceof Uint8Array)return W_(h,p);if(h instanceof ArrayBuffer)return W_(new Uint8Array(h),p);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(d),new NE(h,u);var h}(t,Lu(e));n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){!function ME(n,e,t){const r=O(n);var i;(i=(0,x.Z)(function*(s,u,d){try{const h=yield u.getMetadata();if(yield function(E,b){const S=O(E),R=Pe(b.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",L=>S.Ds.getBundleMetadata(L,b.id)).then(L=>!!L&&L.createTime.compareTo(R)>=0)}(s.localStore,h))return yield u.close(),d._completeWith({taskState:"Success",documentsLoaded:(E=h).totalDocuments,bytesLoaded:E.totalBytes,totalDocuments:E.totalDocuments,totalBytes:E.totalBytes}),Promise.resolve(new Set);d._updateProgress(L_(h));const p=new cE(h,s.localStore,u.wt);let _=yield u.fc();for(;_;){const E=yield p.Nu(_);E&&d._updateProgress(E),_=yield u.fc()}const v=yield p.complete();return yield Dn(s,v.Ou,void 0),yield function(E,b){const S=O(E);return S.persistence.runTransaction("Save bundle","readwrite",R=>S.Ds.saveBundleMetadata(R,b))}(s.localStore,h),d._completeWith(v.progress),Promise.resolve(v.Mu)}catch(h){return An("SyncEngine",`Loading bundle failed with ${h}`),d._failWith(h),Promise.resolve(new Set)}var E}),function(s,u,d){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Cp(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function nw(n,e){return function qE(n,e){return n.asyncQueue.enqueue((0,x.Z)(function*(){return function(t,r){const i=O(t);return i.persistence.runTransaction("Get named query","readonly",s=>i.Ds.getNamedQuery(s,r))}(yield hd(n),e)}))}(De(n=Q(n,ce)),e).then(t=>t?new Qe(n,null,t.query):null)}(this._delegate,e).then(t=>t?new rt(this,t):null)}}class wd extends Pp{constructor(e){super(),this.firestore=e}convertBytes(e){return new $u(new rn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return xt.forKey(t,this.firestore,null)}}class Ly{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new wd(e)}get(e){const t=Fi(e);return this._delegate.get(t).then(r=>new Ku(this._firestore,new kn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=Fi(e);return r?(Lp("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Fi(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Fi(e);return this._delegate.delete(t),this}}class Vy{constructor(e){this._delegate=e}set(e,t,r){const i=Fi(e);return r?(Lp("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Fi(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Fi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Pi{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new qu(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new zu(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Pi.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new Pi(e,new wd(e),t),i.set(t,s)),s}}Pi.INSTANCES=new WeakMap;class xt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new wd(e)}static forPath(e,t,r){if(e.length%2!=0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new xt(t,new ae(t._delegate,r,new y(e)))}static forKey(e,t,r){return new xt(t,new ae(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new ko(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ko(this.firestore,ay(this._delegate,e))}catch(t){throw nt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,W.m9)(e))instanceof ae&&uy(this._delegate,e)}set(e,t){t=Lp("DocumentReference.set",t);try{return t?My(this._delegate,e,t):My(this._delegate,e)}catch(r){throw nt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?ky(this._delegate,e):ky(this._delegate,e,t,...r)}catch(i){throw nt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function Mw(n){return Mo(Q(n.firestore,ce),[new mo(n._key,de.none())])}(this._delegate)}onSnapshot(...e){const t=Uy(e),r=By(e,i=>new Ku(this.firestore,new kn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Ny(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function Aw(n){n=Q(n,ae);const e=Q(n.firestore,ce),t=De(e),r=new Oi(e);return function VE(n,e){const t=new ve;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return(r=(0,x.Z)(function*(i,s,u){try{const d=yield function(h,p){const _=O(h);return _.persistence.runTransaction("read document","readonly",v=>_.localDocuments.getDocument(v,p))}(i,s);d.isFoundDocument()?u.resolve(d):d.isNoDocument()?u.resolve(null):u.reject(new D(C.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){const h=Ao(d,`Failed to get document '${s} from cache`);u.reject(h)}}),function(i,s,u){return r.apply(this,arguments)})(yield hd(n),e,t);var r})),t.promise}(t,n._key).then(i=>new kn(e,r,n._key,i,new Ri(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function Cw(n){n=Q(n,ae);const e=Q(n.firestore,ce);return Q_(De(e),n._key,{source:"server"}).then(t=>Fp(e,n,t))}(this._delegate):function Tw(n){n=Q(n,ae);const e=Q(n.firestore,ce);return Q_(De(e),n._key).then(t=>Fp(e,n,t))}(this._delegate),t.then(r=>new Ku(this.firestore,new kn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new xt(this.firestore,this._delegate.withConverter(e?Pi.getInstance(this.firestore,e):null))}}function nt(n,e,t){return n.message=n.message.replace(e,t),n}function Uy(n){for(const e of n)if("object"==typeof e&&!Vp(e))return e;return{}}function By(n,e){var t,r;let i;return i=Vp(n[0])?n[0]:Vp(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Ku{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new xt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Iy(this._delegate,e._delegate)}}class zu extends Ku{data(e){const t=this._delegate.data(e);return function Rl(n,e){n||V()}(void 0!==t),t}}class rt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new wd(e)}where(e,t,r){try{return new rt(this.firestore,Er(this._delegate,function fw(n,e,t){const r=e,i=Id("where",n);return new hw(i,r,t)}(e,t,r)))}catch(i){throw nt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new rt(this.firestore,Er(this._delegate,function mw(n,e="asc"){const t=e,r=Id("orderBy",n);return new pw(r,t)}(e,t)))}catch(r){throw nt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new rt(this.firestore,Er(this._delegate,function gw(n){return sy("limit",n),new wy("limit",n,"F")}(e)))}catch(t){throw nt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new rt(this.firestore,Er(this._delegate,function _w(n){return sy("limitToLast",n),new wy("limitToLast",n,"L")}(e)))}catch(t){throw nt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new rt(this.firestore,Er(this._delegate,function yw(...n){return new by("startAt",n,!0)}(...e)))}catch(t){throw nt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new rt(this.firestore,Er(this._delegate,function vw(...n){return new by("startAfter",n,!1)}(...e)))}catch(t){throw nt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new rt(this.firestore,Er(this._delegate,function Iw(...n){return new Ty("endBefore",n,!1)}(...e)))}catch(t){throw nt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new rt(this.firestore,Er(this._delegate,function Ew(...n){return new Ty("endAt",n,!0)}(...e)))}catch(t){throw nt(t,"endAt()","Query.endAt()")}}isEqual(e){return cy(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function xw(n){n=Q(n,Qe);const e=Q(n.firestore,ce),t=De(e),r=new Oi(e);return function UE(n,e){const t=new ve;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return(r=(0,x.Z)(function*(i,s,u){try{const d=yield id(i,s,!0),h=new B_(s,d.ji),p=h.Ku(d.documents),_=h.applyChanges(p,!1);u.resolve(_.snapshot)}catch(d){const h=Ao(d,`Failed to execute query '${s} against cache`);u.reject(h)}}),function(i,s,u){return r.apply(this,arguments)})(yield hd(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Ir(e,r,n,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function Dw(n){n=Q(n,Qe);const e=Q(n.firestore,ce),t=De(e),r=new Oi(e);return ey(t,n._query,{source:"server"}).then(i=>new Ir(e,r,n,i))}(this._delegate):function Sw(n){n=Q(n,Qe);const e=Q(n.firestore,ce),t=De(e),r=new Oi(e);return Ey(n._query),ey(t,n._query).then(i=>new Ir(e,r,n,i))}(this._delegate),t.then(r=>new Up(this.firestore,new Ir(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Uy(e),r=By(e,i=>new Up(this.firestore,new Ir(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Ny(this._delegate,t,r)}withConverter(e){return new rt(this.firestore,this._delegate.withConverter(e?Pi.getInstance(this.firestore,e):null))}}class $w{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new zu(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Up{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new rt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new zu(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new $w(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new zu(this._firestore,r))})}isEqual(e){return Iy(this._delegate,e._delegate)}}class ko extends rt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new xt(this.firestore,e):null}doc(e){try{return new xt(this.firestore,void 0===e?pd(this._delegate):pd(this._delegate,e))}catch(t){throw nt(t,"doc()","CollectionReference.doc()")}}add(e){return function kw(n,e){const t=Q(n.firestore,ce),r=pd(n),i=Ed(n.converter,e);return Mo(t,[_d(ki(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,de.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new xt(this.firestore,t))}isEqual(e){return uy(this._delegate,e._delegate)}withConverter(e){return new ko(this.firestore,this._delegate.withConverter(e?Pi.getInstance(this.firestore,e):null))}}function Fi(n){return Q(n,ae)}class Bp{constructor(...e){this._delegate=new Mn(...e)}static documentId(){return new Bp(g.keyField().canonicalString())}isEqual(e){return(e=(0,W.m9)(e))instanceof Mn&&this._delegate._internalPath.isEqual(e._internalPath)}}class Li{constructor(e){this._delegate=e}static serverTimestamp(){const e=function Fw(){return new Mp("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new Li(e)}static delete(){const e=function Pw(){return new Gu("deleteField")}();return e._methodName="FieldValue.delete",new Li(e)}static arrayUnion(...e){const t=function Lw(...n){return new ow("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Li(t)}static arrayRemove(...e){const t=function Vw(...n){return new aw("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Li(t)}static increment(e){const t=function Uw(n){return new uw("increment",n)}(e);return t._methodName="FieldValue.increment",new Li(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Kw={Firestore:Fy,GeoPoint:md,Timestamp:c,Blob:$u,Transaction:Ly,WriteBatch:Vy,DocumentReference:xt,DocumentSnapshot:Ku,Query:rt,QueryDocumentSnapshot:zu,QuerySnapshot:Up,CollectionReference:ko,FieldPath:Bp,FieldValue:Li,setLogLevel:function Hw(n){!function Gh(n){ot.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function Ww(n){(function zw(n,e){n.INTERNAL.registerComponent(new Cs.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},Kw)))})(n,(e,t)=>new Fy(e,t,new qw)),n.registerVersion("@firebase/firestore-compat","0.1.23")}(ih.Z);var Gy=B(7579),Zw=B(6451),bd=B(5363),br=B(3900),Yw=B(6063);class Xw extends Gy.x{constructor(e=1/0,t=1/0,r=Yw.l){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:u}=this;t||(r.push(e),!i&&r.push(s.now()+u)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,s=i.slice();for(let u=0;u<s.length&&!e.closed;u+=r?1:2)e.next(s[u]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){const u=t.now();let d=0;for(let h=1;h<r.length&&r[h]<=u;h+=2)d=h;d&&r.splice(0,d+1)}}}var jy=B(3099);function qy(n,e,t){let r,i=!1;return n&&"object"==typeof n?({bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=n):r=null!=n?n:1/0,(0,jy.B)({connector:()=>new Xw(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}var Jw=B(590),Qw=B(576);function Hy(n,e){return(0,Qw.m)(e)?(0,br.w)(()=>n,e):(0,br.w)(()=>n)}var Gp=B(9468);B(5867);const Ky=new Map,ib={activated:!1,tokenObservers:[]},sb={initialized:!1,enabled:!1};function Ve(n){return Ky.get(n)||ib}function Bt(n,e){Ky.set(n,e)}function Ad(){return sb}class lb{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return(0,x.Z)(function*(){t.stop();try{t.pending=new W.BH,yield function db(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new W.BH,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(r){t.retryPolicy(r)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const it=new W.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function Wy(n){if(!Ve(n).activated)throw it.create("use-before-activation",{appName:n.name})}function $p(n,e){return Kp.apply(this,arguments)}function Kp(){return Kp=(0,x.Z)(function*({url:n,body:e},t){var r,i;const s={"Content-Type":"application/json"},u=t.getImmediate({optional:!0});if(u){const b=yield u.getHeartbeatsHeader();b&&(s["X-Firebase-Client"]=b)}const d={method:"POST",body:JSON.stringify(e),headers:s};let h,p;try{h=yield fetch(n,d)}catch(b){throw it.create("fetch-network-error",{originalErrorMessage:null===(r=b)||void 0===r?void 0:r.message})}if(200!==h.status)throw it.create("fetch-status-error",{httpStatus:h.status});try{p=yield h.json()}catch(b){throw it.create("fetch-parse-error",{originalErrorMessage:null===(i=b)||void 0===i?void 0:i.message})}const _=p.ttl.match(/^([\d.]+)(s)$/);if(!_||!_[2]||isNaN(Number(_[1])))throw it.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${p.ttl}`});const v=1e3*Number(_[1]),E=Date.now();return{token:p.token,expireTimeMillis:E+v,issuedAtTimeMillis:E}}),Kp.apply(this,arguments)}function mb(n,e){const{projectId:t,appId:r,apiKey:i}=n.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1/projects/${t}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:e}}}const Wu="firebase-app-check-store";let xd=null;function Yy(){return xd||(xd=new Promise((n,e)=>{var t;try{const r=indexedDB.open("firebase-app-check-database",1);r.onsuccess=i=>{n(i.target.result)},r.onerror=i=>{var s;e(it.create("storage-open",{originalErrorMessage:null===(s=i.target.error)||void 0===s?void 0:s.message}))},r.onupgradeneeded=i=>{0===i.oldVersion&&i.target.result.createObjectStore(Wu,{keyPath:"compositeKey"})}}catch(r){e(it.create("storage-open",{originalErrorMessage:null===(t=r)||void 0===t?void 0:t.message}))}}),xd)}function zp(){return zp=(0,x.Z)(function*(n,e){const r=(yield Yy()).transaction(Wu,"readwrite"),s=r.objectStore(Wu).put({compositeKey:n,value:e});return new Promise((u,d)=>{s.onsuccess=h=>{u()},r.onerror=h=>{var p;d(it.create("storage-set",{originalErrorMessage:null===(p=h.target.error)||void 0===p?void 0:p.message}))}})}),zp.apply(this,arguments)}const Zu=new At.Yd("@firebase/app-check");function ev(n,e){return(0,W.hl)()?function vb(n,e){return function Xy(n,e){return zp.apply(this,arguments)}(function Qy(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{Zu.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function tv(){return Ad().enabled}function nv(){return Xp.apply(this,arguments)}function Xp(){return Xp=(0,x.Z)(function*(){const n=Ad();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}),Xp.apply(this,arguments)}const Ab={error:"UNKNOWN_ERROR"};function Cb(n){return W.US.encodeString(JSON.stringify(n),!1)}function Dd(n){return Jp.apply(this,arguments)}function Jp(){return Jp=(0,x.Z)(function*(n,e=!1){const t=n.app;Wy(t);const r=Ve(t);let s,i=r.token;if(!i){const h=yield r.cachedTokenPromise;h&&Md(h)&&(i=h)}if(!e&&i&&Md(i))return{token:i.token};let d,u=!1;if(tv()){r.exchangeTokenPromise||(r.exchangeTokenPromise=$p(mb(t,yield nv()),n.heartbeatServiceProvider).then(p=>(r.exchangeTokenPromise=void 0,p)),u=!0);const h=yield r.exchangeTokenPromise;return yield ev(t,h),Bt(t,Object.assign(Object.assign({},r),{token:h})),{token:h.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(h=>(r.exchangeTokenPromise=void 0,h)),u=!0),i=yield r.exchangeTokenPromise}catch(h){"appCheck/throttled"===h.code?Zu.warn(h.message):Zu.error(h),s=h}return i?(d={token:i.token},Bt(t,Object.assign(Object.assign({},r),{token:i})),yield ev(t,i)):d=xb(s),u&&iv(t,d),d}),Jp.apply(this,arguments)}function em(n,e){const t=Ve(n),r=t.tokenObservers.filter(i=>i.next!==e);0===r.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),Bt(n,Object.assign(Object.assign({},t),{tokenObservers:r}))}function rv(n){const{app:e}=n,t=Ve(e);let r=t.tokenRefresher;r||(r=function Sb(n){const{app:e}=n;return new lb((0,x.Z)(function*(){let r;if(r=Ve(e).token?yield Dd(n,!0):yield Dd(n),r.error)throw r.error}),()=>!0,()=>{const t=Ve(e);if(t.token){let r=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return r=Math.min(r,t.token.expireTimeMillis-3e5),Math.max(0,r-Date.now())}return 0},3e4,96e4)}(n),Bt(e,Object.assign(Object.assign({},t),{tokenRefresher:r}))),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function iv(n,e){const t=Ve(n).tokenObservers;for(const r of t)try{"EXTERNAL"===r.type&&null!=e.error?r.error(e.error):r.next(e)}catch(i){}}function Md(n){return n.expireTimeMillis-Date.now()>0}function xb(n){return{token:Cb(Ab),error:n}}class Db{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=Ve(this.app);for(const t of e)em(this.app,t.next);return Promise.resolve()}}const hv="app-check-internal";!function qb(){(0,Rt._registerComponent)(new Cs.wA("app-check",n=>function Mb(n,e){return new Db(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(hv).initialize()})),(0,Rt._registerComponent)(new Cs.wA(hv,n=>function kb(n){return{getToken:e=>Dd(n,e),addTokenListener:e=>function Qp(n,e,t,r){const{app:i}=n,s=Ve(i),u={next:t,error:r,type:e};if(Bt(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,u]})),s.token&&Md(s.token)){const d=s.token;Promise.resolve().then(()=>{t({token:d.token}),rv(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>rv(n))}(n,"INTERNAL",e),removeTokenListener:e=>em(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,Rt.registerVersion)("@firebase/app-check","0.5.12")}();class im{constructor(){return(0,Oe.vb)("app-check")}}"undefined"!=typeof window&&window,B(127);const pv=new f.OlP("angularfire2.auth.use-emulator"),mv=new f.OlP("angularfire2.auth.settings"),gv=new f.OlP("angularfire2.auth.tenant-id"),_v=new f.OlP("angularfire2.auth.langugage-code"),yv=new f.OlP("angularfire2.auth.use-device-language"),vv=new f.OlP("angularfire.auth.persistence"),Iv=(n,e,t,r,i,s,u,d)=>(0,Tt.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const h=e.runOutsideAngular(()=>n.auth());if(t&&h.useEmulator(...t),r&&(h.tenantId=r),h.languageCode=i,s&&h.useDeviceLanguage(),u)for(const[p,_]of Object.entries(u))h.settings[p]=_;return d&&h.setPersistence(d),h},[t,r,i,s,u,d]);let Ev=(()=>{class n{constructor(t,r,i,s,u,d,h,p,_,v,E,b){const S=new Gy.x,R=(0,Ye.of)(void 0).pipe((0,bd.Q)(u.outsideAngular),(0,br.w)(()=>s.runOutsideAngular(()=>Promise.resolve().then(B.bind(B,1451)))),(0,se.U)(()=>(0,Tt.on)(t,s,r)),(0,se.U)(L=>Iv(L,s,d,p,_,v,h,E)),qy({bufferSize:1,refCount:!1}));if((0,I.PM)(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Ye.of)(null);else{R.pipe((0,Jw.P)()).subscribe();const Y=R.pipe((0,br.w)($=>$.getRedirectResult().then(z=>z,()=>null)),Oe.iC,qy({bufferSize:1,refCount:!1})),te=R.pipe((0,br.w)($=>new Nn.y(z=>({unsubscribe:s.runOutsideAngular(()=>$.onAuthStateChanged(X=>z.next(X),X=>z.error(X),()=>z.complete()))})))),J=R.pipe((0,br.w)($=>new Nn.y(z=>({unsubscribe:s.runOutsideAngular(()=>$.onIdTokenChanged(X=>z.next(X),X=>z.error(X),()=>z.complete()))}))));this.authState=Y.pipe(Hy(te),(0,Gp.R)(u.outsideAngular),(0,bd.Q)(u.insideAngular)),this.user=Y.pipe(Hy(J),(0,Gp.R)(u.outsideAngular),(0,bd.Q)(u.insideAngular)),this.idToken=this.user.pipe((0,br.w)($=>$?(0,We.D)($.getIdToken()):(0,Ye.of)(null))),this.idTokenResult=this.user.pipe((0,br.w)($=>$?(0,We.D)($.getIdTokenResult()):(0,Ye.of)(null))),this.credential=(0,Zw.T)(Y,S,this.authState.pipe((0,As.h)($=>!$))).pipe((0,se.U)($=>(null==$?void 0:$.user)?$:null),(0,Gp.R)(u.outsideAngular),(0,bd.Q)(u.insideAngular))}return(0,Tt.pX)(this,R,s,{spy:{apply:(L,Y,te)=>{(L.startsWith("signIn")||L.startsWith("createUser"))&&te.then(J=>S.next(J))}}})}}return n.\u0275fac=function(t){return new(t||n)(f.LFG(Tt.Dh),f.LFG(Tt.xv,8),f.LFG(f.Lbi),f.LFG(f.R0b),f.LFG(Oe.HU),f.LFG(pv,8),f.LFG(mv,8),f.LFG(gv,8),f.LFG(_v,8),f.LFG(yv,8),f.LFG(vv,8),f.LFG(im,8))},n.\u0275prov=f.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();function wv(n,e){return function Zb(n,e=nh.z){return new Nn.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function om(n,e){return wv(n,e).pipe((0,se.U)(t=>({payload:t,type:"query"})))}function Nd(n,e){return om(n,e).pipe((0,Pr.O)(void 0),Fr(),(0,se.U)(([t,r])=>{const i=r.payload.docChanges(),s=i.map(u=>({type:u.type,payload:u}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((u,d)=>{const h=i.find(_=>_.doc.ref.isEqual(u.ref)),p=null==t?void 0:t.payload.docs.find(_=>_.ref.isEqual(u.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(u.metadata)||!h&&p&&JSON.stringify(p.metadata)===JSON.stringify(u.metadata)||s.push({type:"modified",payload:{oldIndex:d,newIndex:d,type:"modified",doc:u}})}),s}))}function bv(n,e,t){return Nd(n,t).pipe((0,la.R)((r,i)=>function Xb(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function Jb(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return am(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return am(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return am(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),function rh(n,e=da.y){return n=null!=n?n:ha,(0,ca.e)((t,r)=>{let i,s=!0;t.subscribe((0,sn.x)(r,u=>{const d=e(u);(s||!n(i,d))&&(s=!1,i=d,r.next(u))}))})}(),(0,se.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function am(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function Tv(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Av{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Nd(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,se.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Pr.O)(void 0),Fr(),(0,As.h)(([r,i])=>i.length>0||!r),(0,se.U)(([r,i])=>i),Oe.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,la.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Tv(e);return bv(this.query,t,this.afs.schedulers.outsideAngular).pipe(Oe.iC)}valueChanges(e={}){return om(this.query,this.afs.schedulers.outsideAngular).pipe((0,se.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),Oe.iC)}get(e){return(0,We.D)(this.query.get(e)).pipe(Oe.iC)}add(e){return this.ref.add(e)}doc(e){return new Cv(this.ref.doc(e),this.afs)}}class Cv{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=Sv(r,t);return new Av(i,s,this.afs)}snapshotChanges(){return function Yb(n,e){return wv(n,e).pipe((0,Pr.O)(void 0),Fr(),(0,se.U)(([t,r])=>r.exists?(null==t?void 0:t.exists)?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Oe.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,se.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,We.D)(this.ref.get(e)).pipe(Oe.iC)}}class Qb{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Nd(this.query,this.afs.schedulers.outsideAngular).pipe((0,se.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,As.h)(t=>t.length>0),Oe.iC):Nd(this.query,this.afs.schedulers.outsideAngular).pipe(Oe.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,la.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Tv(e);return bv(this.query,t,this.afs.schedulers.outsideAngular).pipe(Oe.iC)}valueChanges(e={}){return om(this.query,this.afs.schedulers.outsideAngular).pipe((0,se.U)(r=>r.payload.docs.map(i=>e.idField?Object.assign({[e.idField]:i.id},i.data()):i.data())),Oe.iC)}get(e){return(0,We.D)(this.query.get(e)).pipe(Oe.iC)}}const eT=new f.OlP("angularfire2.enableFirestorePersistence"),tT=new f.OlP("angularfire2.firestore.persistenceSettings"),nT=new f.OlP("angularfire2.firestore.settings"),rT=new f.OlP("angularfire2.firestore.use-emulator");function Sv(n,e=(t=>t)){return{query:e(n),ref:n}}let iT=(()=>{class n{constructor(t,r,i,s,u,d,h,p,_,v,E,b,S,R,L,Y,te){this.schedulers=h;const J=(0,Tt.on)(t,d,r),$=_;v&&Iv(J,d,E,S,R,L,b,Y),[this.firestore,this.persistenceEnabled$]=(0,Tt.cc)(`${J.name}.firestore`,"AngularFirestore",J.name,()=>{const z=d.runOutsideAngular(()=>J.firestore());if(s&&z.settings(s),$&&z.useEmulator(...$),i&&!(0,I.PM)(u)){const X=()=>{try{return(0,We.D)(z.enablePersistence(p||void 0).then(()=>!0,()=>!1))}catch(Re){return"undefined"!=typeof console&&console.warn(Re),(0,Ye.of)(!1)}};return[z,d.runOutsideAngular(X)]}return[z,(0,Ye.of)(!1)]},[s,$,i])}collection(t,r){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:u}=Sv(i,r),d=this.schedulers.ngZone.run(()=>s);return new Av(d,u,this)}collectionGroup(t,r){const i=r||(u=>u),s=this.firestore.collectionGroup(t);return new Qb(i(s),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>r);return new Cv(i,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(f.LFG(Tt.Dh),f.LFG(Tt.xv,8),f.LFG(eT,8),f.LFG(nT,8),f.LFG(f.Lbi),f.LFG(f.R0b),f.LFG(Oe.HU),f.LFG(tT,8),f.LFG(rT,8),f.LFG(Ev,8),f.LFG(pv,8),f.LFG(mv,8),f.LFG(gv,8),f.LFG(_v,8),f.LFG(yv,8),f.LFG(vv,8),f.LFG(im,8))},n.\u0275prov=f.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();const sT=[{path:"",component:(()=>{class n{constructor(t,r){this.fb=t,this.fs=r,this.submitted=!0,this.submitMessage=""}ngOnInit(){this.myForm=this.fs.collection("enquiry"),this.registerForm=this.fb.group({firstName:[null,ge.required],lastName:[null,ge.required],email:[null,[ge.compose([ge.required,ge.email])]],phone:[null,ge.required],country:[null,ge.required],state:[null,ge.required],zipCode:[null,ge.required]})}submit(t){console.log("val",t),this.myForm.add(t).then(r=>{console.log("res",r),this.submitMessage="Success"}).catch(r=>{console.log(r)}),this.submitted=!0,setTimeout(()=>{this.submitted=!1},1e3)}}return n.\u0275fac=function(t){return new(t||n)(f.Y36(th),f.Y36(iT))},n.\u0275cmp=f.Xpm({type:n,selectors:[["app-home"]],decls:76,vars:0,consts:[[1,"body"],[1,"navbar","fixed-top","navbar-expand-lg","navbar-dark","p-md-3"],[1,"container"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarNav","aria-controls","navbarNav","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarNav",1,"collapse","navbar-collapse"],[1,"mx-auto"],[1,"navbar-nav"],[1,"nav-item"],["href","#",1,"nav-link","text-white","mx-3"],["href","#whycoco",1,"nav-link","text-white","mx-3"],[1,"landingPage"],[1,"home"],[1,"hcon"],["id","whycoco",1,"white-section"],["align","center",1,"section-heading"],["align","center",1,"section-p"],[1,"row","row-card"],[1,"whycoco-column","col-lg-4","col-md-6"],[1,"card","card-1","border-dark"],[1,"card-header","border-dark"],["align","center"],[1,"card-body"],[1,"card","border-dark","card-2"],[1,"whycoco-column","col-lg-4"],[1,"card","border-dark","card-3"],["id","gallery"],["id","carouselExampleControls","data-bs-ride","carousel",1,"carousel","slide"],[1,"carousel-inner"],[1,"carousel-item","active","c-item"],["src","../../assets/img/image.png","alt","1",1,"d-block","w-100","c-img"],[1,"carousel-item","c-item"],["src","../../assets/img/image2.jpg","alt","2",1,"d-block","w-100","c-img"],["src","...","alt","3",1,"d-block","w-100","c-img"],["type","button","data-bs-target","#carouselExampleControls","data-bs-slide","prev",1,"carousel-control-prev"],["aria-hidden","true",1,"carousel-control-prev-icon"],[1,"visually-hidden"],["type","button","data-bs-target","#carouselExampleControls","data-bs-slide","next",1,"carousel-control-next"],["aria-hidden","true",1,"carousel-control-next-icon"]],template:function(t,r){1&t&&(f.TgZ(0,"section",0)(1,"nav",1)(2,"div",2)(3,"a",3),f._uU(4,"LAKSHMICOCO PITH"),f.qZA(),f.TgZ(5,"button",4),f._UZ(6,"span",5),f.qZA(),f.TgZ(7,"div",6),f._UZ(8,"div",7),f.TgZ(9,"ul",8)(10,"li",9)(11,"a",10),f._uU(12,"HOME"),f.qZA()(),f.TgZ(13,"li",9)(14,"a",10),f._uU(15,"ABOUT"),f.qZA()(),f.TgZ(16,"li",9)(17,"a",10),f._uU(18,"CONTACT"),f.qZA()(),f.TgZ(19,"li",9)(20,"a",11),f._uU(21,"WHY COCO"),f.qZA()()()()()(),f.TgZ(22,"div",12)(23,"div",13)(24,"h1",14),f._uU(25,"HIGH QUALITY & SUSTAINABLE"),f.qZA(),f.TgZ(26,"p",14),f._uU(27,"LAKSHMI COIRS INDUSTRY"),f.qZA()()(),f.TgZ(28,"section",15)(29,"h2",16),f._uU(30,"ALL OUR PRODUCTS ARE MANUFACTURED IN OUR FACTORY"),f.qZA(),f._UZ(31,"br"),f.TgZ(32,"p",17),f._uU(33,"Which gives us the control to assure the quality of our products and offer competitive prices."),f.qZA(),f.TgZ(34,"div",18)(35,"div",19)(36,"div",20)(37,"div",21)(38,"h3",22),f._uU(39,"COCO BLOCKS"),f.qZA()(),f.TgZ(40,"div",23)(41,"h4",22),f._uU(42,"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim"),f.qZA()()()(),f.TgZ(43,"div",19)(44,"div",24)(45,"div",21)(46,"h3",22),f._uU(47,"COCO PEAT"),f.qZA()(),f.TgZ(48,"div",23)(49,"h4",22),f._uU(50,"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim"),f.qZA()()()(),f.TgZ(51,"div",25)(52,"div",26)(53,"div",21)(54,"h3",22),f._uU(55,"COCO CHIPS"),f.qZA()(),f.TgZ(56,"div",23)(57,"h4",22),f._uU(58,"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim"),f.qZA()()()()()(),f.TgZ(59,"section",27)(60,"div",28)(61,"div",29)(62,"div",30),f._UZ(63,"img",31),f.qZA(),f.TgZ(64,"div",32),f._UZ(65,"img",33),f.qZA(),f.TgZ(66,"div",32),f._UZ(67,"img",34),f.qZA()(),f.TgZ(68,"button",35),f._UZ(69,"span",36),f.TgZ(70,"span",37),f._uU(71,"Previous"),f.qZA()(),f.TgZ(72,"button",38),f._UZ(73,"span",39),f.TgZ(74,"span",37),f._uU(75,"Next"),f.qZA()()()()())},styles:[".body[_ngcontent-%COMP%]{margin:0;padding:0;background-color:#413f42}.navbar[_ngcontent-%COMP%]{background-color:#915a3c;font-size:20px}.home[_ngcontent-%COMP%]{max-width:960px;margin-left:auto;margin-right:auto;padding-left:1rem;padding-right:1rem}.hcon[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;color:#fff;font-size:2.5rem}.landingPage[_ngcontent-%COMP%]{background-color:#cfb79f;background-image:url(pic1.87c3e31986958e3d.jpeg);background-repeat:no-repeat;background-blend-mode:multiply;background-size:cover;padding:200px 0}.section-heading[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;padding-left:50px;padding-right:50px;font-size:2rem}.section-p[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;padding-left:50px;padding-right:50px;font-size:1.3rem}#whycoco[_ngcontent-%COMP%]{background-color:#e8e6e7;background-blend-mode:multiply;padding-top:100px;background-image:url(pattern1.c389b9241e29eead.jpg)}@media (min-width:40em){.row-card[_ngcontent-%COMP%]{padding:50px 100px 120px;margin:0}}.whycoco-column[_ngcontent-%COMP%]{padding-top:50px}.card-header[_ngcontent-%COMP%]{padding-top:20px;font-family:Poppins,sans-serif;border:none}.card-body[_ngcontent-%COMP%]{padding:20px;font-family:Raleway,sans-serif}@media (min-width:500px){.card-body[_ngcontent-%COMP%]{padding:30px 20px 50px}}.card[_ngcontent-%COMP%]{box-shadow:8px 8px 32px 8px #1f26875e;border-radius:20px;border:none}.card-1[_ngcontent-%COMP%]{border-left:1px solid rgba(255,255,255,.1)}.card-2[_ngcontent-%COMP%]{border-top:1px solid rgba(255,255,255,.1)}.card-3[_ngcontent-%COMP%]{border-right:1px solid rgba(255,255,255,.1)}#features[_ngcontent-%COMP%]{position:relative;padding:4.5%;background:#915a3c}.features-row[_ngcontent-%COMP%]{background:white;padding-bottom:50px}.row-contact[_ngcontent-%COMP%]{padding:50px}.image[_ngcontent-%COMP%]{object-fit:cover}@media (max-width:40em){.image[_ngcontent-%COMP%]{max-width:100%}.row-contact[_ngcontent-%COMP%]{padding:0 30px}}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#202a30}.cnt-h3[_ngcontent-%COMP%]{font-weight:600;color:#202a30}#gallery[_ngcontent-%COMP%]{background-color:#e8e6e7;background-blend-mode:multiply;background-image:url(pattern1.c389b9241e29eead.jpg);padding-bottom:.2%}#carouselExampleControls[_ngcontent-%COMP%]{padding-top:2%;padding-bottom:4.5%;background:#915a3c}@media (min-width:500px){.content[_ngcontent-%COMP%]{padding:50px 0 0 480px}.sapce1[_ngcontent-%COMP%]{margin-left:150px}.sapce[_ngcontent-%COMP%]{font-size:1.5rem}.carousel-inner[_ngcontent-%COMP%]{padding:50px}.height[_ngcontent-%COMP%]{padding-left:20px}.address[_ngcontent-%COMP%]{padding-left:250px;padding-top:15px}.bi[_ngcontent-%COMP%]{font-size:27px}.c-item[_ngcontent-%COMP%]{height:480px}}@media (max-width:500px){.whycoco-column[_ngcontent-%COMP%]{padding:0 30px 50px}.sapce[_ngcontent-%COMP%]{font-size:1rem}.content[_ngcontent-%COMP%]{padding:30px 0 0 20px}#carouselExampleControls[_ngcontent-%COMP%]{padding:2%;background:#915a3c}.address[_ngcontent-%COMP%]{padding-left:5px}.sapce1[_ngcontent-%COMP%]{margin-left:100px}.c-item[_ngcontent-%COMP%]{height:270px}}.height[_ngcontent-%COMP%]{height:270px;background:#321F28}.col-1[_ngcontent-%COMP%]{padding:0}"]}),n})()}];let um,oT=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({imports:[[Bi.Bz.forChild(sT)],Bi.Bz]}),n})(),xv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({}),n})();try{um="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){um=!1}let cT=(()=>{class n{constructor(t){this._platformId=t,this.isBrowser=this._platformId?(0,I.NF)(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!um)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(t){return new(t||n)(f.LFG(f.Lbi))},n.\u0275prov=f.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Ov="cdk-high-contrast-black-on-white",Pv="cdk-high-contrast-white-on-black",dm="cdk-high-contrast-active";let CT=(()=>{class n{constructor(t,r){this._platform=t,this._document=r}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const r=this._document.defaultView||window,i=r&&r.getComputedStyle?r.getComputedStyle(t):null,s=(i&&i.backgroundColor||"").replace(/ /g,"");switch(t.remove(),s){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(dm),t.remove(Ov),t.remove(Pv),this._hasCheckedHighContrastMode=!0;const r=this.getHighContrastMode();1===r?(t.add(dm),t.add(Ov)):2===r&&(t.add(dm),t.add(Pv))}}}return n.\u0275fac=function(t){return new(t||n)(f.LFG(cT),f.LFG(I.K0))},n.\u0275prov=f.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const xT=new f.OlP("mat-sanity-checks",{providedIn:"root",factory:function ST(){return!0}});let Od=(()=>{class n{constructor(t,r,i){this._sanityChecks=r,this._document=i,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!function hT(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}}return n.\u0275fac=function(t){return new(t||n)(f.LFG(CT),f.LFG(xT,8),f.LFG(I.K0))},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({imports:[[xv],xv]}),n})(),OT=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({imports:[[Od],Od]}),n})();B(2843),B(8505),B(262),B(8746),B(4351),B(2313);let eA=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({imports:[[Od],Od]}),n})(),tA=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.oAB({type:n}),n.\u0275inj=f.cJS({imports:[[I.ez,oT,OT,eA,bs]]}),n})()},1451:(Jv,tc,B)=>{B.r(tc);var I=B(5861),Bi=B(3942),f=B(2090),We=B(9681),Nn=B(655),nc=B(1877),Ro=B(4859);const an=function se(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},_t=function Oo(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},rc=new f.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ic=new nc.Yd("@firebase/auth");function Gi(c,...o){ic.logLevel<=nc.in.ERROR&&ic.error(`Auth (${We.SDK_VERSION}): ${c}`,...o)}function Ee(c,...o){throw we(c,...o)}function me(c,...o){return we(c,...o)}function Dt(c,o,a){const l=Object.assign(Object.assign({},_t()),{[o]:a});return new f.LL("auth","Firebase",l).create(o,{appName:c.name})}function un(c,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&Ee(c,"argument-error"),Dt(c,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function we(c,...o){if("string"!=typeof c){const a=o[0],l=[...o.slice(1)];return l[0]&&(l[0].appName=c.name),c._errorFactory.create(a,...l)}return rc.create(c,...o)}function k(c,o,...a){if(!c)throw we(o,...a)}function yt(c){const o="INTERNAL ASSERTION FAILED: "+c;throw Gi(o),new Error(o)}function ge(c,o){c||yt(o)}const Po=new Map;function Ze(c){ge(c instanceof Function,"Expected a class definition");let o=Po.get(c);return o?(ge(o instanceof c,"Instance stored in cache mismatched with class"),o):(o=new c,Po.set(c,o),o)}function Rn(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function ji(){return"http:"===Fo()||"https:"===Fo()}function Fo(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class On{constructor(o,a){this.shortDelay=o,this.longDelay=a,ge(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,f.uI)()||(0,f.b$)()}get(){return function ac(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ji()||(0,f.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Hi(c,o){ge(c.emulator,"Emulator should always be set here");const{url:a}=c.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class Lo{static initialize(o,a,l){this.fetchImpl=o,a&&(this.headersImpl=a),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void yt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void yt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void yt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const uc={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Vd=new On(3e4,6e4);function he(c,o){return c.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:c.tenantId}):o}function _e(c,o,a,l){return Cr.apply(this,arguments)}function Cr(){return(Cr=(0,I.Z)(function*(c,o,a,l,m={}){return Vo(c,m,(0,I.Z)(function*(){let g={},y={};l&&("GET"===o?y=l:g={body:JSON.stringify(l)});const T=(0,f.xO)(Object.assign({key:c.config.apiKey},y)).slice(1),N=yield c._getAdditionalHeaders();return N["Content-Type"]="application/json",c.languageCode&&(N["X-Firebase-Locale"]=c.languageCode),Lo.fetch()(Uo(c,c.config.apiHost,a,T),Object.assign({method:o,headers:N,referrerPolicy:"no-referrer"},g))}))})).apply(this,arguments)}function Vo(c,o,a){return Sr.apply(this,arguments)}function Sr(){return(Sr=(0,I.Z)(function*(c,o,a){c._canInitEmulator=!1;const l=Object.assign(Object.assign({},uc),o);try{const m=new Bo(c),g=yield Promise.race([a(),m.promise]);m.clearNetworkTimeout();const y=yield g.json();if("needConfirmation"in y)throw Gt(c,"account-exists-with-different-credential",y);if(g.ok&&!("errorMessage"in y))return y;{const T=g.ok?y.errorMessage:y.error.message,[N,P]=T.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===N)throw Gt(c,"credential-already-in-use",y);if("EMAIL_EXISTS"===N)throw Gt(c,"email-already-in-use",y);if("USER_DISABLED"===N)throw Gt(c,"user-disabled",y);const j=l[N]||N.toLowerCase().replace(/[_\s]+/g,"-");if(P)throw Dt(c,j,P);Ee(c,j)}}catch(m){if(m instanceof f.ZR)throw m;Ee(c,"network-request-failed")}})).apply(this,arguments)}function vt(c,o,a,l){return $i.apply(this,arguments)}function $i(){return($i=(0,I.Z)(function*(c,o,a,l,m={}){const g=yield _e(c,o,a,l,m);return"mfaPendingCredential"in g&&Ee(c,"multi-factor-auth-required",{_serverResponse:g}),g})).apply(this,arguments)}function Uo(c,o,a,l){const m=`${o}${a}?${l}`;return c.config.emulator?Hi(c.config,m):`${c.config.apiScheme}://${m}`}class Bo{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,l)=>{this.timer=setTimeout(()=>l(me(this.auth,"network-request-failed")),Vd.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Gt(c,o,a){const l={appName:c.name};a.email&&(l.email=a.email),a.phoneNumber&&(l.phoneNumber=a.phoneNumber);const m=me(c,o,l);return m.customData._tokenResponse=a,m}function Ki(){return(Ki=(0,I.Z)(function*(c,o){return _e(c,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function lc(c,o){return It.apply(this,arguments)}function It(){return(It=(0,I.Z)(function*(c,o){return _e(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Ue(c,o){return zi.apply(this,arguments)}function zi(){return(zi=(0,I.Z)(function*(c,o){return _e(c,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function Wi(c){if(c)try{const o=new Date(Number(c));if(!isNaN(o.getTime()))return o.toUTCString()}catch(o){}}function Go(){return(Go=(0,I.Z)(function*(c,o=!1){const a=(0,f.m9)(c),l=yield a.getIdToken(o),m=cn(l);k(m&&m.exp&&m.auth_time&&m.iat,a.auth,"internal-error");const g="object"==typeof m.firebase?m.firebase:void 0,y=null==g?void 0:g.sign_in_provider;return{claims:m,token:l,authTime:Wi(xr(m.auth_time)),issuedAtTime:Wi(xr(m.iat)),expirationTime:Wi(xr(m.exp)),signInProvider:y||null,signInSecondFactor:(null==g?void 0:g.sign_in_second_factor)||null}})).apply(this,arguments)}function xr(c){return 1e3*Number(c)}function cn(c){var o;const[a,l,m]=c.split(".");if(void 0===a||void 0===l||void 0===m)return Gi("JWT malformed, contained fewer than 3 sections"),null;try{const g=(0,f.tV)(l);return g?JSON.parse(g):(Gi("Failed to decode base64 JWT payload"),null)}catch(g){return Gi("Caught error parsing JWT payload as JSON",null===(o=g)||void 0===o?void 0:o.toString()),null}}function dt(c,o){return jo.apply(this,arguments)}function jo(){return(jo=(0,I.Z)(function*(c,o,a=!1){if(a)return o;try{return yield o}catch(l){throw l instanceof f.ZR&&Im(l)&&c.auth.currentUser===c&&(yield c.auth.signOut()),l}})).apply(this,arguments)}function Im({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}class Em{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const m=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,m)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const l=this.getInterval(o);this.timerId=setTimeout((0,I.Z)(function*(){yield a.iteration()}),l)}iteration(){var o=this;return(0,I.Z)(function*(){var a;try{yield o.user.getIdToken(!0)}catch(l){return void("auth/network-request-failed"===(null===(a=l)||void 0===a?void 0:a.code)&&o.schedule(!0))}o.schedule()})()}}class Gd{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wi(this.lastLoginAt),this.creationTime=Wi(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Zi(c){return dc.apply(this,arguments)}function dc(){return(dc=(0,I.Z)(function*(c){var o;const a=c.auth,l=yield c.getIdToken(),m=yield dt(c,Ue(a,{idToken:l}));k(null==m?void 0:m.users.length,a,"internal-error");const g=m.users[0];c._notifyReloadListener(g);const y=(null===(o=g.providerUserInfo)||void 0===o?void 0:o.length)?jd(g.providerUserInfo):[],T=hc(c.providerData,y),j=!!c.isAnonymous&&!(c.email&&g.passwordHash||(null==T?void 0:T.length)),U={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:T,metadata:new Gd(g.createdAt,g.lastLoginAt),isAnonymous:j};Object.assign(c,U)})).apply(this,arguments)}function qo(){return(qo=(0,I.Z)(function*(c){const o=(0,f.m9)(c);yield Zi(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function hc(c,o){return[...c.filter(l=>!o.some(m=>m.providerId===l.providerId)),...o]}function jd(c){return c.map(o=>{var{providerId:a}=o,l=(0,Nn._T)(o,["providerId"]);return{providerId:a,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}function Ho(){return(Ho=(0,I.Z)(function*(c,o){const a=yield Vo(c,{},(0,I.Z)(function*(){const l=(0,f.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:m,apiKey:g}=c.config,y=Uo(c,m,"/v1/token",`key=${g}`),T=yield c._getAdditionalHeaders();return T["Content-Type"]="application/x-www-form-urlencoded",Lo.fetch()(y,{method:"POST",headers:T,body:l})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}class jt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){k(o.idToken,"internal-error"),k(void 0!==o.idToken,"internal-error"),k(void 0!==o.refreshToken,"internal-error");const a="expiresIn"in o&&void 0!==o.expiresIn?Number(o.expiresIn):function Bd(c){const o=cn(c);return k(o,"internal-error"),k(void 0!==o.exp,"internal-error"),k(void 0!==o.iat,"internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}getToken(o,a=!1){var l=this;return(0,I.Z)(function*(){return k(!l.accessToken||l.refreshToken,o,"user-token-expired"),a||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(o,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var l=this;return(0,I.Z)(function*(){const{accessToken:m,refreshToken:g,expiresIn:y}=yield function qd(c,o){return Ho.apply(this,arguments)}(o,a);l.updateTokensAndExpiration(m,g,Number(y))})()}updateTokensAndExpiration(o,a,l){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(o,a){const{refreshToken:l,accessToken:m,expirationTime:g}=a,y=new jt;return l&&(k("string"==typeof l,"internal-error",{appName:o}),y.refreshToken=l),m&&(k("string"==typeof m,"internal-error",{appName:o}),y.accessToken=m),g&&(k("number"==typeof g,"internal-error",{appName:o}),y.expirationTime=g),y}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new jt,this.toJSON())}_performRefresh(){return yt("not implemented")}}function st(c,o){k("string"==typeof c||void 0===c,"internal-error",{appName:o})}class Et{constructor(o){var{uid:a,auth:l,stsTokenManager:m}=o,g=(0,Nn._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Em(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=l,this.stsTokenManager=m,this.accessToken=m.accessToken,this.displayName=g.displayName||null,this.email=g.email||null,this.emailVerified=g.emailVerified||!1,this.phoneNumber=g.phoneNumber||null,this.photoURL=g.photoURL||null,this.isAnonymous=g.isAnonymous||!1,this.tenantId=g.tenantId||null,this.providerData=g.providerData?[...g.providerData]:[],this.metadata=new Gd(g.createdAt||void 0,g.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,I.Z)(function*(){const l=yield dt(a,a.stsTokenManager.getToken(a.auth,o));return k(l,a.auth,"internal-error"),a.accessToken!==l&&(a.accessToken=l,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),l})()}getIdTokenResult(o){return function Ud(c){return Go.apply(this,arguments)}(this,o)}reload(){return function wm(c){return qo.apply(this,arguments)}(this)}_assign(o){this!==o&&(k(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){return new Et(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(o){k(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var l=this;return(0,I.Z)(function*(){let m=!1;o.idToken&&o.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(o),m=!0),a&&(yield Zi(l)),yield l.auth._persistUserIfCurrent(l),m&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var o=this;return(0,I.Z)(function*(){const a=yield o.getIdToken();return yield dt(o,function cc(c,o){return Ki.apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var l,m,g,y,T,N,P,j;const U=null!==(l=a.displayName)&&void 0!==l?l:void 0,Ie=null!==(m=a.email)&&void 0!==m?m:void 0,je=null!==(g=a.phoneNumber)&&void 0!==g?g:void 0,di=null!==(y=a.photoURL)&&void 0!==y?y:void 0,uu=null!==(T=a.tenantId)&&void 0!==T?T:void 0,qe=null!==(N=a._redirectEventId)&&void 0!==N?N:void 0,ro=null!==(P=a.createdAt)&&void 0!==P?P:void 0,cu=null!==(j=a.lastLoginAt)&&void 0!==j?j:void 0,{uid:io,emailVerified:Ut,isAnonymous:so,providerData:w,stsTokenManager:hi}=a;k(io&&hi,o,"internal-error");const mt=jt.fromJSON(this.name,hi);k("string"==typeof io,o,"internal-error"),st(U,o.name),st(Ie,o.name),k("boolean"==typeof Ut,o,"internal-error"),k("boolean"==typeof so,o,"internal-error"),st(je,o.name),st(di,o.name),st(uu,o.name),st(qe,o.name),st(ro,o.name),st(cu,o.name);const lu=new Et({uid:io,auth:o,email:Ie,emailVerified:Ut,displayName:U,isAnonymous:so,photoURL:di,phoneNumber:je,tenantId:uu,stsTokenManager:mt,createdAt:ro,lastLoginAt:cu});return w&&Array.isArray(w)&&(lu.providerData=w.map(fi=>Object.assign({},fi))),qe&&(lu._redirectEventId=qe),lu}static _fromIdTokenResponse(o,a,l=!1){return(0,I.Z)(function*(){const m=new jt;m.updateFromServerResponse(a);const g=new Et({uid:a.localId,auth:o,stsTokenManager:m,isAnonymous:l});return yield Zi(g),g})()}}const Pn=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,I.Z)(function*(){return!0})()}_set(a,l){var m=this;return(0,I.Z)(function*(){m.storage[a]=l})()}_get(a){var l=this;return(0,I.Z)(function*(){const m=l.storage[a];return void 0===m?null:m})()}_remove(a){var l=this;return(0,I.Z)(function*(){delete l.storage[a]})()}_addListener(a,l){}_removeListener(a,l){}}return c.type="NONE",c})();function Mt(c,o,a){return`firebase:${c}:${o}:${a}`}class kt{constructor(o,a,l){this.persistence=o,this.auth=a,this.userKey=l;const{config:m,name:g}=this.auth;this.fullUserKey=Mt(this.userKey,m.apiKey,g),this.fullPersistenceKey=Mt("persistence",m.apiKey,g),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,I.Z)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?Et._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,I.Z)(function*(){if(a.persistence===o)return;const l=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,l?a.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,l="authUser"){return(0,I.Z)(function*(){if(!a.length)return new kt(Ze(Pn),o,l);const m=(yield Promise.all(a.map(function(){var P=(0,I.Z)(function*(j){if(yield j._isAvailable())return j});return function(j){return P.apply(this,arguments)}}()))).filter(P=>P);let g=m[0]||Ze(Pn);const y=Mt(l,o.config.apiKey,o.name);let T=null;for(const P of a)try{const j=yield P._get(y);if(j){const U=Et._fromJSON(o,j);P!==g&&(T=U),g=P;break}}catch(j){}const N=m.filter(P=>P._shouldAllowMigration);return g._shouldAllowMigration&&N.length?(g=N[0],T&&(yield g._set(y,T.toJSON())),yield Promise.all(a.map(function(){var P=(0,I.Z)(function*(j){if(j!==g)try{yield j._remove(y)}catch(U){}});return function(j){return P.apply(this,arguments)}}())),new kt(g,o,l)):new kt(g,o,l)})()}}function fc(c){const o=c.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(Ko(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(pc(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(Hd(o))return"Blackberry";if(gc(o))return"Webos";if(Yi(o))return"Safari";if((o.includes("chrome/")||mc(o))&&!o.includes("edge/"))return"Chrome";if(Dr(o))return"Android";{const l=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==l?void 0:l.length))return l[1]}return"Other"}function pc(c=(0,f.z$)()){return/firefox\//i.test(c)}function Yi(c=(0,f.z$)()){const o=c.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function mc(c=(0,f.z$)()){return/crios\//i.test(c)}function Ko(c=(0,f.z$)()){return/iemobile/i.test(c)}function Dr(c=(0,f.z$)()){return/android/i.test(c)}function Hd(c=(0,f.z$)()){return/blackberry/i.test(c)}function gc(c=(0,f.z$)()){return/webos/i.test(c)}function ln(c=(0,f.z$)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function Wo(c=(0,f.z$)()){return ln(c)||Dr(c)||gc(c)||Hd(c)||/windows phone/i.test(c)||Ko(c)}function Xi(c,o=[]){let a;switch(c){case"Browser":a=fc((0,f.z$)());break;case"Worker":a=`${fc((0,f.z$)())}-${c}`;break;default:a=c}const l=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${We.SDK_VERSION}/${l}`}class Tm{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,a){const l=g=>new Promise((y,T)=>{try{y(o(g))}catch(N){T(N)}});l.onAbort=a,this.queue.push(l);const m=this.queue.length-1;return()=>{this.queue[m]=()=>Promise.resolve()}}runMiddleware(o){var a=this;return(0,I.Z)(function*(){var l;if(a.auth.currentUser===o)return;const m=[];try{for(const g of a.queue)yield g(o),g.onAbort&&m.push(g.onAbort)}catch(g){m.reverse();for(const y of m)try{y()}catch(T){}throw a.auth._errorFactory.create("login-blocked",{originalMessage:null===(l=g)||void 0===l?void 0:l.message})}})()}}class Yo{constructor(o,a,l){this.app=o,this.heartbeatServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Mr(this),this.idTokenSubscription=new Mr(this),this.beforeStateQueue=new Tm(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=rc,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(o,a){var l=this;return a&&(this._popupRedirectResolver=Ze(a)),this._initializationPromise=this.queue((0,I.Z)(function*(){var m,g;if(!l._deleted&&(l.persistenceManager=yield kt.create(l,o),!l._deleted)){if(null===(m=l._popupRedirectResolver)||void 0===m?void 0:m._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch(y){}yield l.initializeCurrentUser(a),l.lastNotifiedUid=(null===(g=l.currentUser)||void 0===g?void 0:g.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,I.Z)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a,!0)}})()}initializeCurrentUser(o){var a=this;return(0,I.Z)(function*(){var l;const m=yield a.assertedPersistence.getCurrentUser();let g=m,y=!1;if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const T=null===(l=a.redirectUser)||void 0===l?void 0:l._redirectEventId,N=null==g?void 0:g._redirectEventId,P=yield a.tryRedirectSignIn(o);(!T||T===N)&&(null==P?void 0:P.user)&&(g=P.user,y=!0)}if(!g)return a.directlySetCurrentUser(null);if(!g._redirectEventId){if(y)try{yield a.beforeStateQueue.runMiddleware(g)}catch(T){g=m,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(T))}return g?a.reloadAndSetCurrentUserOrClear(g):a.directlySetCurrentUser(null)}return k(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===g._redirectEventId?a.directlySetCurrentUser(g):a.reloadAndSetCurrentUserOrClear(g)})()}tryRedirectSignIn(o){var a=this;return(0,I.Z)(function*(){let l=null;try{l=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch(m){yield a._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,I.Z)(function*(){var l;try{yield Zi(o)}catch(m){if("auth/network-request-failed"!==(null===(l=m)||void 0===l?void 0:l.code))return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function qi(){if("undefined"==typeof navigator)return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var o=this;return(0,I.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,I.Z)(function*(){const l=o?(0,f.m9)(o):null;return l&&k(l.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(l&&l._clone(a))})()}_updateCurrentUser(o,a=!1){var l=this;return(0,I.Z)(function*(){if(!l._deleted)return o&&k(l.tenantId===o.tenantId,l,"tenant-id-mismatch"),a||(yield l.beforeStateQueue.runMiddleware(o)),l.queue((0,I.Z)(function*(){yield l.directlySetCurrentUser(o),l.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,I.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var a=this;return this.queue((0,I.Z)(function*(){yield a.assertedPersistence.setPersistence(Ze(o))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new f.LL("auth","Firebase",o())}onAuthStateChanged(o,a,l){return this.registerStateListener(this.authStateSubscription,o,a,l)}beforeAuthStateChanged(o,a){return this.beforeStateQueue.pushCallback(o,a)}onIdTokenChanged(o,a,l){return this.registerStateListener(this.idTokenSubscription,o,a,l)}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var l=this;return(0,I.Z)(function*(){const m=yield l.getOrInitRedirectPersistenceManager(a);return null===o?m.removeCurrentUser():m.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,I.Z)(function*(){if(!a.redirectPersistenceManager){const l=o&&Ze(o)||a._popupRedirectResolver;k(l,a,"argument-error"),a.redirectPersistenceManager=yield kt.create(a,[Ze(l._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,I.Z)(function*(){var l,m;return a._isInitialized&&(yield a.queue((0,I.Z)(function*(){}))),(null===(l=a._currentUser)||void 0===l?void 0:l._redirectEventId)===o?a._currentUser:(null===(m=a.redirectUser)||void 0===m?void 0:m._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,I.Z)(function*(){if(o===a.currentUser)return a.queue((0,I.Z)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,l,m){if(this._deleted)return()=>{};const g="function"==typeof a?a:a.next.bind(a),y=this._isInitialized?Promise.resolve():this._initializationPromise;return k(y,this,"internal-error"),y.then(()=>g(this.currentUser)),"function"==typeof a?o.addObserver(a,l,m):o.addObserver(a)}directlySetCurrentUser(o){var a=this;return(0,I.Z)(function*(){a.currentUser&&a.currentUser!==o&&(a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh()),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return k(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=Xi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,I.Z)(function*(){var a;const l={"X-Client-Version":o.clientVersion};o.app.options.appId&&(l["X-Firebase-gmpid"]=o.app.options.appId);const m=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();return m&&(l["X-Firebase-Client"]=m),l})()}}function ue(c){return(0,f.m9)(c)}class Mr{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,f.ne)(a=>this.observer=a)}get next(){return k(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ln(c){const o=c.indexOf(":");return o<0?"":c.substr(0,o+1)}function Ji(c){if(!c)return null;const o=Number(c);return isNaN(o)?null:o}class qt{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return yt("not implemented")}_getIdTokenResponse(o){return yt("not implemented")}_linkToIdToken(o,a){return yt("not implemented")}_getReauthenticationResolver(o){return yt("not implemented")}}function Xo(c,o){return Vn.apply(this,arguments)}function Vn(){return(Vn=(0,I.Z)(function*(c,o){return _e(c,"POST","/v1/accounts:resetPassword",he(c,o))})).apply(this,arguments)}function Qi(c,o){return Un.apply(this,arguments)}function Un(){return(Un=(0,I.Z)(function*(c,o){return _e(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function yc(c,o){return es.apply(this,arguments)}function es(){return(es=(0,I.Z)(function*(c,o){return _e(c,"POST","/v1/accounts:update",he(c,o))})).apply(this,arguments)}function ts(){return(ts=(0,I.Z)(function*(c,o){return vt(c,"POST","/v1/accounts:signInWithPassword",he(c,o))})).apply(this,arguments)}function Bn(c,o){return kr.apply(this,arguments)}function kr(){return(kr=(0,I.Z)(function*(c,o){return _e(c,"POST","/v1/accounts:sendOobCode",he(c,o))})).apply(this,arguments)}function ns(c,o){return rs.apply(this,arguments)}function rs(){return(rs=(0,I.Z)(function*(c,o){return Bn(c,o)})).apply(this,arguments)}function zd(c,o){return dn.apply(this,arguments)}function dn(){return(dn=(0,I.Z)(function*(c,o){return Bn(c,o)})).apply(this,arguments)}function Jo(c,o){return is.apply(this,arguments)}function is(){return(is=(0,I.Z)(function*(c,o){return Bn(c,o)})).apply(this,arguments)}function Am(c,o){return Ic.apply(this,arguments)}function Ic(){return(Ic=(0,I.Z)(function*(c,o){return Bn(c,o)})).apply(this,arguments)}function Ec(){return(Ec=(0,I.Z)(function*(c,o){return vt(c,"POST","/v1/accounts:signInWithEmailLink",he(c,o))})).apply(this,arguments)}function ss(){return(ss=(0,I.Z)(function*(c,o){return vt(c,"POST","/v1/accounts:signInWithEmailLink",he(c,o))})).apply(this,arguments)}class Nr extends qt{constructor(o,a,l,m=null){super("password",l),this._email=o,this._password=a,this._tenantId=m}static _fromEmailAndPassword(o,a){return new Nr(o,a,"password")}static _fromEmailAndCode(o,a,l=null){return new Nr(o,a,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o;if((null==a?void 0:a.email)&&(null==a?void 0:a.password)){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(o){var a=this;return(0,I.Z)(function*(){switch(a.signInMethod){case"password":return function vc(c,o){return ts.apply(this,arguments)}(o,{returnSecureToken:!0,email:a._email,password:a._password});case"emailLink":return function Cm(c,o){return Ec.apply(this,arguments)}(o,{email:a._email,oobCode:a._password});default:Ee(o,"internal-error")}})()}_linkToIdToken(o,a){var l=this;return(0,I.Z)(function*(){switch(l.signInMethod){case"password":return Qi(o,{idToken:a,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function Wd(c,o){return ss.apply(this,arguments)}(o,{idToken:a,email:l._email,oobCode:l._password});default:Ee(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function wt(c,o){return os.apply(this,arguments)}function os(){return(os=(0,I.Z)(function*(c,o){return vt(c,"POST","/v1/accounts:signInWithIdp",he(c,o))})).apply(this,arguments)}class bt extends qt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new bt(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):Ee("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:m}=a,g=(0,Nn._T)(a,["providerId","signInMethod"]);if(!l||!m)return null;const y=new bt(l,m);return y.idToken=g.idToken||void 0,y.accessToken=g.accessToken||void 0,y.secret=g.secret,y.nonce=g.nonce,y.pendingToken=g.pendingToken||null,y}_getIdTokenResponse(o){return wt(o,this.buildRequest())}_linkToIdToken(o,a){const l=this.buildRequest();return l.idToken=a,wt(o,l)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,wt(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,f.xO)(a)}return o}}function wc(c,o){return Qo.apply(this,arguments)}function Qo(){return(Qo=(0,I.Z)(function*(c,o){return _e(c,"POST","/v1/accounts:sendVerificationCode",he(c,o))})).apply(this,arguments)}function as(){return(as=(0,I.Z)(function*(c,o){return vt(c,"POST","/v1/accounts:signInWithPhoneNumber",he(c,o))})).apply(this,arguments)}function us(){return(us=(0,I.Z)(function*(c,o){const a=yield vt(c,"POST","/v1/accounts:signInWithPhoneNumber",he(c,o));if(a.temporaryProof)throw Gt(c,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const Xd={USER_NOT_FOUND:"user-not-found"};function Rr(){return(Rr=(0,I.Z)(function*(c,o){return vt(c,"POST","/v1/accounts:signInWithPhoneNumber",he(c,Object.assign(Object.assign({},o),{operation:"REAUTH"})),Xd)})).apply(this,arguments)}class hn extends qt{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,a){return new hn({verificationId:o,verificationCode:a})}static _fromTokenResponse(o,a){return new hn({phoneNumber:o,temporaryProof:a})}_getIdTokenResponse(o){return function Sm(c,o){return as.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,a){return function Yd(c,o){return us.apply(this,arguments)}(o,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function bc(c,o){return Rr.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:a,verificationId:l,verificationCode:m}=this.params;return o&&a?{temporaryProof:o,phoneNumber:a}:{sessionInfo:l,code:m}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:a,verificationCode:l,phoneNumber:m,temporaryProof:g}=o;return l||a||m||g?new hn({verificationId:a,verificationCode:l,phoneNumber:m,temporaryProof:g}):null}}class fn{constructor(o){var a,l,m,g,y,T;const N=(0,f.zd)((0,f.pd)(o)),P=null!==(a=N.apiKey)&&void 0!==a?a:null,j=null!==(l=N.oobCode)&&void 0!==l?l:null,U=function Tc(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(m=N.mode)&&void 0!==m?m:null);k(P&&j&&U,"argument-error"),this.apiKey=P,this.operation=U,this.code=j,this.continueUrl=null!==(g=N.continueUrl)&&void 0!==g?g:null,this.languageCode=null!==(y=N.languageCode)&&void 0!==y?y:null,this.tenantId=null!==(T=N.tenantId)&&void 0!==T?T:null}static parseLink(o){const a=function Jd(c){const o=(0,f.zd)((0,f.pd)(c)).link,a=o?(0,f.zd)((0,f.pd)(o)).deep_link_id:null,l=(0,f.zd)((0,f.pd)(c)).deep_link_id;return(l?(0,f.zd)((0,f.pd)(l)).link:null)||l||a||o||c}(o);try{return new fn(a)}catch(l){return null}}}let Or=(()=>{class c{constructor(){this.providerId=c.PROVIDER_ID}static credential(a,l){return Nr._fromEmailAndPassword(a,l)}static credentialWithLink(a,l){const m=fn.parseLink(l);return k(m,"argument-error"),Nr._fromEmailAndCode(a,m.code,m.tenantId)}}return c.PROVIDER_ID="password",c.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c.EMAIL_LINK_SIGN_IN_METHOD="emailLink",c})();class Nt{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class Ht extends Nt{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class pn extends Ht{static credentialFromJSON(o){const a="string"==typeof o?JSON.parse(o):o;return k("providerId"in a&&"signInMethod"in a,"argument-error"),bt._fromParams(a)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return k(o.idToken||o.accessToken,"argument-error"),bt._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return pn.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return pn.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:a,oauthAccessToken:l,oauthTokenSecret:m,pendingToken:g,nonce:y,providerId:T}=o;if(!l&&!m&&!a&&!g||!T)return null;try{return new pn(T)._credential({idToken:a,accessToken:l,nonce:y,pendingToken:g})}catch(N){return null}}}let Ac=(()=>{class c extends Ht{constructor(){super("facebook.com")}static credential(a){return bt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(l){return null}}}return c.FACEBOOK_SIGN_IN_METHOD="facebook.com",c.PROVIDER_ID="facebook.com",c})(),ea=(()=>{class c extends Ht{constructor(){super("google.com"),this.addScope("profile")}static credential(a,l){return bt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:l})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:l,oauthAccessToken:m}=a;if(!l&&!m)return null;try{return c.credential(l,m)}catch(g){return null}}}return c.GOOGLE_SIGN_IN_METHOD="google.com",c.PROVIDER_ID="google.com",c})(),Cc=(()=>{class c extends Ht{constructor(){super("github.com")}static credential(a){return bt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(l){return null}}}return c.GITHUB_SIGN_IN_METHOD="github.com",c.PROVIDER_ID="github.com",c})();class Gn extends qt{constructor(o,a){super(o,o),this.pendingToken=a}_getIdTokenResponse(o){return wt(o,this.buildRequest())}_linkToIdToken(o,a){const l=this.buildRequest();return l.idToken=a,wt(o,l)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,wt(o,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:m,pendingToken:g}=a;return l&&m&&g&&l===m?new Gn(l,g):null}static _create(o,a){return new Gn(o,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class cs extends Nt{constructor(o){k(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return cs.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return cs.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const a=Gn.fromJSON(o);return k(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:a,providerId:l}=o;if(!a||!l)return null;try{return Gn._create(l,a)}catch(m){return null}}}let xc=(()=>{class c extends Ht{constructor(){super("twitter.com")}static credential(a,l){return bt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:l})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:l,oauthTokenSecret:m}=a;if(!l||!m)return null;try{return c.credential(l,m)}catch(g){return null}}}return c.TWITTER_SIGN_IN_METHOD="twitter.com",c.PROVIDER_ID="twitter.com",c})();function na(c,o){return ra.apply(this,arguments)}function ra(){return(ra=(0,I.Z)(function*(c,o){return vt(c,"POST","/v1/accounts:signUp",he(c,o))})).apply(this,arguments)}class ht{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,l,m=!1){return(0,I.Z)(function*(){const g=yield Et._fromIdTokenResponse(o,l,m),y=ls(l);return new ht({user:g,providerId:y,_tokenResponse:l,operationType:a})})()}static _forOperation(o,a,l){return(0,I.Z)(function*(){yield o._updateTokensIfNecessary(l,!0);const m=ls(l);return new ht({user:o,providerId:m,_tokenResponse:l,operationType:a})})()}}function ls(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}function ds(){return(ds=(0,I.Z)(function*(c){var o;const a=ue(c);if(yield a._initializationPromise,null===(o=a.currentUser)||void 0===o?void 0:o.isAnonymous)return new ht({user:a.currentUser,providerId:null,operationType:"signIn"});const l=yield na(a,{returnSecureToken:!0}),m=yield ht._fromIdTokenResponse(a,"signIn",l,!0);return yield a._updateCurrentUser(m.user),m})).apply(this,arguments)}class hs extends f.ZR{constructor(o,a,l,m){var g;super(a.code,a.message),this.operationType=l,this.user=m,Object.setPrototypeOf(this,hs.prototype),this.customData={appName:o.name,tenantId:null!==(g=o.tenantId)&&void 0!==g?g:void 0,_serverResponse:a.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(o,a,l,m){return new hs(o,a,l,m)}}function ia(c,o,a,l){return("reauthenticate"===o?a._getReauthenticationResolver(c):a._getIdTokenResponse(c)).catch(g=>{throw"auth/multi-factor-auth-required"===g.code?hs._fromErrorAndOperation(c,g,o,l):g})}function $t(c){return new Set(c.map(({providerId:o})=>o).filter(o=>!!o))}function fs(){return(fs=(0,I.Z)(function*(c,o){const a=(0,f.m9)(c);yield ms(!0,a,o);const{providerUserInfo:l}=yield lc(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[o]}),m=$t(l||[]);return a.providerData=a.providerData.filter(g=>m.has(g.providerId)),m.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a})).apply(this,arguments)}function sa(c,o){return ps.apply(this,arguments)}function ps(){return(ps=(0,I.Z)(function*(c,o,a=!1){const l=yield dt(c,o._linkToIdToken(c.auth,yield c.getIdToken()),a);return ht._forOperation(c,"link",l)})).apply(this,arguments)}function ms(c,o,a){return oa.apply(this,arguments)}function oa(){return(oa=(0,I.Z)(function*(c,o,a){yield Zi(o);const m=!1===c?"provider-already-linked":"no-such-provider";k($t(o.providerData).has(a)===c,o.auth,m)})).apply(this,arguments)}function gs(c,o){return _s.apply(this,arguments)}function _s(){return(_s=(0,I.Z)(function*(c,o,a=!1){var l;const{auth:m}=c,g="reauthenticate";try{const y=yield dt(c,ia(m,g,o,c),a);k(y.idToken,m,"internal-error");const T=cn(y.idToken);k(T,m,"internal-error");const{sub:N}=T;return k(c.uid===N,m,"user-mismatch"),ht._forOperation(c,g,y)}catch(y){throw"auth/user-not-found"===(null===(l=y)||void 0===l?void 0:l.code)&&Ee(m,"user-mismatch"),y}})).apply(this,arguments)}function Dc(c,o){return ys.apply(this,arguments)}function ys(){return(ys=(0,I.Z)(function*(c,o,a=!1){const l="signIn",m=yield ia(c,l,o),g=yield ht._fromIdTokenResponse(c,l,m);return a||(yield c._updateCurrentUser(g.user)),g})).apply(this,arguments)}function vs(c,o){return Is.apply(this,arguments)}function Is(){return(Is=(0,I.Z)(function*(c,o){return Dc(ue(c),o)})).apply(this,arguments)}function Mc(c,o){return Es.apply(this,arguments)}function Es(){return(Es=(0,I.Z)(function*(c,o){const a=(0,f.m9)(c);return yield ms(!1,a,o.providerId),sa(a,o)})).apply(this,arguments)}function kc(c,o){return ws.apply(this,arguments)}function ws(){return(ws=(0,I.Z)(function*(c,o){return gs((0,f.m9)(c),o)})).apply(this,arguments)}function Dm(c,o){return Nc.apply(this,arguments)}function Nc(){return(Nc=(0,I.Z)(function*(c,o){return vt(c,"POST","/v1/accounts:signInWithCustomToken",he(c,o))})).apply(this,arguments)}function aa(){return(aa=(0,I.Z)(function*(c,o){const a=ue(c),l=yield Dm(a,{token:o,returnSecureToken:!0}),m=yield ht._fromIdTokenResponse(a,"signIn",l);return yield a._updateCurrentUser(m.user),m})).apply(this,arguments)}class ua{constructor(o,a){this.factorId=o,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(o,a){return"phoneInfo"in a?bs._fromServerResponse(o,a):Ee(o,"internal-error")}}class bs extends ua{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,a){return new bs(a)}}function Ts(c,o,a){var l;k((null===(l=a.url)||void 0===l?void 0:l.length)>0,c,"invalid-continue-uri"),k(void 0===a.dynamicLinkDomain||a.dynamicLinkDomain.length>0,c,"invalid-dynamic-link-domain"),o.continueUrl=a.url,o.dynamicLinkDomain=a.dynamicLinkDomain,o.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(k(a.iOS.bundleId.length>0,c,"missing-ios-bundle-id"),o.iOSBundleId=a.iOS.bundleId),a.android&&(k(a.android.packageName.length>0,c,"missing-android-pkg-name"),o.androidInstallApp=a.android.installApp,o.androidMinimumVersionCode=a.android.minimumVersion,o.androidPackageName=a.android.packageName)}function Rc(){return(Rc=(0,I.Z)(function*(c,o,a){const l=(0,f.m9)(c),m={requestType:"PASSWORD_RESET",email:o};a&&Ts(l,m,a),yield zd(l,m)})).apply(this,arguments)}function Ye(){return(Ye=(0,I.Z)(function*(c,o,a){yield Xo((0,f.m9)(c),{oobCode:o,newPassword:a})})).apply(this,arguments)}function Pr(){return(Pr=(0,I.Z)(function*(c,o){yield yc((0,f.m9)(c),{oobCode:o})})).apply(this,arguments)}function ca(c,o){return Fr.apply(this,arguments)}function Fr(){return(Fr=(0,I.Z)(function*(c,o){const a=(0,f.m9)(c),l=yield Xo(a,{oobCode:o}),m=l.requestType;switch(k(m,a,"internal-error"),m){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":k(l.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":k(l.mfaInfo,a,"internal-error");default:k(l.email,a,"internal-error")}let g=null;return l.mfaInfo&&(g=ua._fromServerResponse(ue(a),l.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.newEmail:l.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.email:l.newEmail)||null,multiFactorInfo:g},operation:m}})).apply(this,arguments)}function da(){return(da=(0,I.Z)(function*(c,o){const{data:a}=yield ca((0,f.m9)(c),o);return a.email})).apply(this,arguments)}function ha(){return(ha=(0,I.Z)(function*(c,o,a){const l=ue(c),m=yield na(l,{returnSecureToken:!0,email:o,password:a}),g=yield ht._fromIdTokenResponse(l,"signIn",m);return yield l._updateCurrentUser(g.user),g})).apply(this,arguments)}function Oc(){return(Oc=(0,I.Z)(function*(c,o,a){const l=(0,f.m9)(c),m={requestType:"EMAIL_SIGNIN",email:o};k(a.handleCodeInApp,l,"argument-error"),a&&Ts(l,m,a),yield Jo(l,m)})).apply(this,arguments)}function Rt(){return(Rt=(0,I.Z)(function*(c,o,a){const l=(0,f.m9)(c),m=Or.credentialWithLink(o,a||Rn());return k(m._tenantId===(l.tenantId||null),l,"tenant-id-mismatch"),vs(l,m)})).apply(this,arguments)}function Cs(c,o){return At.apply(this,arguments)}function At(){return(At=(0,I.Z)(function*(c,o){return _e(c,"POST","/v1/accounts:createAuthUri",he(c,o))})).apply(this,arguments)}function fa(){return(fa=(0,I.Z)(function*(c,o){const l={identifier:o,continueUri:ji()?Rn():"http://localhost"},{signinMethods:m}=yield Cs((0,f.m9)(c),l);return m||[]})).apply(this,arguments)}function F(){return(F=(0,I.Z)(function*(c,o){const a=(0,f.m9)(c),m={requestType:"VERIFY_EMAIL",idToken:yield c.getIdToken()};o&&Ts(a.auth,m,o);const{email:g}=yield ns(a.auth,m);g!==c.email&&(yield c.reload())})).apply(this,arguments)}function q(){return(q=(0,I.Z)(function*(c,o,a){const l=(0,f.m9)(c),g={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield c.getIdToken(),newEmail:o};a&&Ts(l.auth,g,a);const{email:y}=yield Am(l.auth,g);y!==c.email&&(yield c.reload())})).apply(this,arguments)}function Ss(c,o){return Lr.apply(this,arguments)}function Lr(){return(Lr=(0,I.Z)(function*(c,o){return _e(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function ma(){return(ma=(0,I.Z)(function*(c,{displayName:o,photoURL:a}){if(void 0===o&&void 0===a)return;const l=(0,f.m9)(c),g={idToken:yield l.getIdToken(),displayName:o,photoUrl:a,returnSecureToken:!0},y=yield dt(l,Ss(l.auth,g));l.displayName=y.displayName||null,l.photoURL=y.photoUrl||null;const T=l.providerData.find(({providerId:N})=>"password"===N);T&&(T.displayName=l.displayName,T.photoURL=l.photoURL),yield l._updateTokensIfNecessary(y)})).apply(this,arguments)}function Pc(c,o,a){return _a.apply(this,arguments)}function _a(){return(_a=(0,I.Z)(function*(c,o,a){const{auth:l}=c,g={idToken:yield c.getIdToken(),returnSecureToken:!0};o&&(g.email=o),a&&(g.password=a);const y=yield dt(c,Qi(l,g));yield c._updateTokensIfNecessary(y,!0)})).apply(this,arguments)}class Pt{constructor(o,a,l={}){this.isNewUser=o,this.providerId=a,this.profile=l}}class be extends Pt{constructor(o,a,l,m){super(o,a,l),this.username=m}}class Kt extends Pt{constructor(o,a){super(o,"facebook.com",a)}}class oh extends be{constructor(o,a){super(o,"github.com",a,"string"==typeof(null==a?void 0:a.login)?null==a?void 0:a.login:null)}}class ah extends Pt{constructor(o,a){super(o,"google.com",a)}}class Fc extends be{constructor(o,a,l){super(o,"twitter.com",a,l)}}function Lc(c){const{user:o,_tokenResponse:a}=c;return o.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function Me(c){var o,a;if(!c)return null;const{providerId:l}=c,m=c.rawUserInfo?JSON.parse(c.rawUserInfo):{},g=c.isNewUser||"identitytoolkit#SignupNewUserResponse"===c.kind;if(!l&&(null==c?void 0:c.idToken)){const y=null===(a=null===(o=cn(c.idToken))||void 0===o?void 0:o.firebase)||void 0===a?void 0:a.sign_in_provider;if(y)return new Pt(g,"anonymous"!==y&&"custom"!==y?y:null)}if(!l)return null;switch(l){case"facebook.com":return new Kt(g,m);case"github.com":return new oh(g,m);case"google.com":return new ah(g,m);case"twitter.com":return new Fc(g,m,c.screenName||null);case"custom":case"anonymous":return new Pt(g,null);default:return new Pt(g,l,m)}}(a)}class zt{constructor(o,a){this.type=o,this.credential=a}static _fromIdtoken(o){return new zt("enroll",o)}static _fromMfaPendingCredential(o){return new zt("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var a,l;if(null==o?void 0:o.multiFactorSession){if(null===(a=o.multiFactorSession)||void 0===a?void 0:a.pendingCredential)return zt._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null===(l=o.multiFactorSession)||void 0===l?void 0:l.idToken)return zt._fromIdtoken(o.multiFactorSession.idToken)}return null}}class Ur{constructor(o,a,l){this.session=o,this.hints=a,this.signInResolver=l}static _fromError(o,a){const l=ue(o),m=a.customData._serverResponse,g=(m.mfaInfo||[]).map(T=>ua._fromServerResponse(l,T));k(m.mfaPendingCredential,l,"internal-error");const y=zt._fromMfaPendingCredential(m.mfaPendingCredential);return new Ur(y,g,function(){var T=(0,I.Z)(function*(N){const P=yield N._process(l,y);delete m.mfaInfo,delete m.mfaPendingCredential;const j=Object.assign(Object.assign({},m),{idToken:P.idToken,refreshToken:P.refreshToken});switch(a.operationType){case"signIn":const U=yield ht._fromIdTokenResponse(l,a.operationType,j);return yield l._updateCurrentUser(U.user),U;case"reauthenticate":return k(a.user,l,"internal-error"),ht._forOperation(a.user,a.operationType,j);default:Ee(l,"internal-error")}});return function(N){return T.apply(this,arguments)}}())}resolveSignIn(o){var a=this;return(0,I.Z)(function*(){return a.signInResolver(o)})()}}function Gc(c,o){return _e(c,"POST","/v2/accounts/mfaEnrollment:start",he(c,o))}class Ia{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(l=>ua._fromServerResponse(o.auth,l)))})}static _fromUser(o){return new Ia(o)}getSession(){var o=this;return(0,I.Z)(function*(){return zt._fromIdtoken(yield o.user.getIdToken())})()}enroll(o,a){var l=this;return(0,I.Z)(function*(){const m=o,g=yield l.getSession(),y=yield dt(l.user,m._process(l.user.auth,g,a));return yield l.user._updateTokensIfNecessary(y),l.user.reload()})()}unenroll(o){var a=this;return(0,I.Z)(function*(){var l;const m="string"==typeof o?o:o.uid,g=yield a.user.getIdToken(),y=yield dt(a.user,function va(c,o){return _e(c,"POST","/v2/accounts/mfaEnrollment:withdraw",he(c,o))}(a.user.auth,{idToken:g,mfaEnrollmentId:m}));a.enrolledFactors=a.enrolledFactors.filter(({uid:T})=>T!==m),yield a.user._updateTokensIfNecessary(y);try{yield a.user.reload()}catch(T){if("auth/user-token-expired"!==(null===(l=T)||void 0===l?void 0:l.code))throw T}})()}}const Ea=new WeakMap,Br="__sak";class Ds{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(Br,"1"),this.storage.removeItem(Br),Promise.resolve(!0)):Promise.resolve(!1)}catch(o){return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const qn=(()=>{class c extends Ds{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,l)=>this.onStorageEvent(a,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function qc(){const c=(0,f.z$)();return Yi(c)||ln(c)}()&&function Zo(){try{return!(!window||window===window.top)}catch(c){return!1}}(),this.fallbackToPolling=Wo(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const l of Object.keys(this.listeners)){const m=this.storage.getItem(l),g=this.localCache[l];m!==g&&a(l,g,m)}}onStorageEvent(a,l=!1){if(!a.key)return void this.forAllChangedKeys((T,N,P)=>{this.notifyListeners(T,P)});const m=a.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const T=this.storage.getItem(m);if(a.newValue!==T)null!==a.newValue?this.storage.setItem(m,a.newValue):this.storage.removeItem(m);else if(this.localCache[m]===a.newValue&&!l)return}const g=()=>{const T=this.storage.getItem(m);!l&&this.localCache[m]===T||this.notifyListeners(m,T)},y=this.storage.getItem(m);!function $d(){return(0,f.w1)()&&10===document.documentMode}()||y===a.newValue||a.newValue===a.oldValue?g():setTimeout(g,10)}notifyListeners(a,l){this.localCache[a]=l;const m=this.listeners[a];if(m)for(const g of Array.from(m))g(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,l,m)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:l,newValue:m}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,l){var m=()=>super._set,g=this;return(0,I.Z)(function*(){yield m().call(g,a,l),g.localCache[a]=JSON.stringify(l)})()}_get(a){var l=()=>super._get,m=this;return(0,I.Z)(function*(){const g=yield l().call(m,a);return m.localCache[a]=JSON.stringify(g),g})()}_remove(a){var l=()=>super._remove,m=this;return(0,I.Z)(function*(){yield l().call(m,a),delete m.localCache[a]})()}}return c.type="LOCAL",c})(),Ct=(()=>{class c extends Ds{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,l){}_removeListener(a,l){}}return c.type="SESSION",c})();let hh=(()=>{class c{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const l=this.receivers.find(g=>g.isListeningto(a));if(l)return l;const m=new c(a);return this.receivers.push(m),m}isListeningto(a){return this.eventTarget===a}handleEvent(a){var l=this;return(0,I.Z)(function*(){const m=a,{eventId:g,eventType:y,data:T}=m.data,N=l.handlersMap[y];if(!(null==N?void 0:N.size))return;m.ports[0].postMessage({status:"ack",eventId:g,eventType:y});const P=Array.from(N).map(function(){var U=(0,I.Z)(function*(Ie){return Ie(m.origin,T)});return function(Ie){return U.apply(this,arguments)}}()),j=yield function dh(c){return Promise.all(c.map(function(){var o=(0,I.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(l){return{fulfilled:!1,reason:l}}});return function(a){return o.apply(this,arguments)}}()))}(P);m.ports[0].postMessage({status:"done",eventId:g,eventType:y,response:j})})()}_subscribe(a,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(l)}_unsubscribe(a,l){this.handlersMap[a]&&l&&this.handlersMap[a].delete(l),(!l||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function mn(c="",o=10){let a="";for(let l=0;l<o;l++)a+=Math.floor(10*Math.random());return c+a}class Kc{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,l=50){var m=this;return(0,I.Z)(function*(){const g="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!g)throw new Error("connection_unavailable");let y,T;return new Promise((N,P)=>{const j=mn("",20);g.port1.start();const U=setTimeout(()=>{P(new Error("unsupported_event"))},l);T={messageChannel:g,onMessage(Ie){const je=Ie;if(je.data.eventId===j)switch(je.data.status){case"ack":clearTimeout(U),y=setTimeout(()=>{P(new Error("timeout"))},3e3);break;case"done":clearTimeout(y),N(je.data.response);break;default:clearTimeout(U),clearTimeout(y),P(new Error("invalid_response"))}}},m.handlers.add(T),g.port1.addEventListener("message",T.onMessage),m.target.postMessage({eventType:o,eventId:j,data:a},[g.port2])}).finally(()=>{T&&m.removeMessageHandler(T)})})()}}function ye(){return window}function Te(){return void 0!==ye().WorkerGlobalScope&&"function"==typeof ye().importScripts}function ba(){return(ba=(0,I.Z)(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(c){return null}})).apply(this,arguments)}const zc="firebaseLocalStorageDb",gn="firebaseLocalStorage",ks="fbase_key";class _n{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function Hn(c,o){return c.transaction([gn],o?"readwrite":"readonly").objectStore(gn)}function Ns(){const c=indexedDB.open(zc,1);return new Promise((o,a)=>{c.addEventListener("error",()=>{a(c.error)}),c.addEventListener("upgradeneeded",()=>{const l=c.result;try{l.createObjectStore(gn,{keyPath:ks})}catch(m){a(m)}}),c.addEventListener("success",(0,I.Z)(function*(){const l=c.result;l.objectStoreNames.contains(gn)?o(l):(l.close(),yield function Ta(){const c=indexedDB.deleteDatabase(zc);return new _n(c).toPromise()}(),o(yield Ns()))}))})}function Aa(c,o,a){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,I.Z)(function*(c,o,a){const l=Hn(c,!0).put({[ks]:o,value:a});return new _n(l).toPromise()})).apply(this,arguments)}function Rs(){return(Rs=(0,I.Z)(function*(c,o){const a=Hn(c,!1).get(o),l=yield new _n(a).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function Os(c,o){const a=Hn(c,!0).delete(o);return new _n(a).toPromise()}const Wt=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,I.Z)(function*(){return a.db||(a.db=yield Ns()),a.db})()}_withRetries(a){var l=this;return(0,I.Z)(function*(){let m=0;for(;;)try{const g=yield l._openDb();return yield a(g)}catch(g){if(m++>3)throw g;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,I.Z)(function*(){return Te()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,I.Z)(function*(){a.receiver=hh._getInstance(function ph(){return Te()?self:null}()),a.receiver._subscribe("keyChanged",function(){var l=(0,I.Z)(function*(m,g){return{keyProcessed:(yield a._poll()).includes(g.key)}});return function(m,g){return l.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var l=(0,I.Z)(function*(m,g){return["keyChanged"]});return function(m,g){return l.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,I.Z)(function*(){var l,m;if(a.activeServiceWorker=yield function Gr(){return ba.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new Kc(a.activeServiceWorker);const g=yield a.sender._send("ping",{},800);!g||(null===(l=g[0])||void 0===l?void 0:l.fulfilled)&&(null===(m=g[0])||void 0===m?void 0:m.value.includes("keyChanged"))&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var l=this;return(0,I.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function jr(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:a},l.serviceWorkerReceiverAvailable?800:50)}catch(m){}})()}_isAvailable(){return(0,I.Z)(function*(){try{if(!indexedDB)return!1;const a=yield Ns();return yield Aa(a,Br,"1"),yield Os(a,Br),!0}catch(a){}return!1})()}_withPendingWrite(a){var l=this;return(0,I.Z)(function*(){l.pendingWrites++;try{yield a()}finally{l.pendingWrites--}})()}_set(a,l){var m=this;return(0,I.Z)(function*(){return m._withPendingWrite((0,I.Z)(function*(){return yield m._withRetries(g=>Aa(g,a,l)),m.localCache[a]=l,m.notifyServiceWorker(a)}))})()}_get(a){var l=this;return(0,I.Z)(function*(){const m=yield l._withRetries(g=>function Wc(c,o){return Rs.apply(this,arguments)}(g,a));return l.localCache[a]=m,m})()}_remove(a){var l=this;return(0,I.Z)(function*(){return l._withPendingWrite((0,I.Z)(function*(){return yield l._withRetries(m=>Os(m,a)),delete l.localCache[a],l.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,I.Z)(function*(){const l=yield a._withRetries(y=>{const T=Hn(y,!1).getAll();return new _n(T).toPromise()});if(!l)return[];if(0!==a.pendingWrites)return[];const m=[],g=new Set;for(const{fbase_key:y,value:T}of l)g.add(y),JSON.stringify(a.localCache[y])!==JSON.stringify(T)&&(a.notifyListeners(y,T),m.push(y));for(const y of Object.keys(a.localCache))a.localCache[y]&&!g.has(y)&&(a.notifyListeners(y,null),m.push(y));return m})()}notifyListeners(a,l){this.localCache[a]=l;const m=this.listeners[a];if(m)for(const g of Array.from(m))g(l)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,I.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})();function Sa(c,o){return _e(c,"POST","/v2/accounts/mfaSignIn:start",he(c,o))}function $n(){return($n=(0,I.Z)(function*(c){return(yield _e(c,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Xc(c){return new Promise((o,a)=>{const l=document.createElement("script");l.setAttribute("src",c),l.onload=o,l.onerror=m=>{const g=me("internal-error");g.customData=m,a(g)},l.type="text/javascript",l.charset="UTF-8",function xa(){var c,o;return null!==(o=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==o?o:document}().appendChild(l)})}function Jc(c){return`__${c}${Math.floor(1e6*Math.random())}`}const Ps=1e12;class Da{constructor(o){this.auth=o,this.counter=Ps,this._widgets=new Map}render(o,a){const l=this.counter;return this._widgets.set(l,new Ma(o,this.auth.name,a||{})),this.counter++,l}reset(o){var a;const l=o||Ps;null===(a=this._widgets.get(l))||void 0===a||a.delete(),this._widgets.delete(l)}getResponse(o){var a;return(null===(a=this._widgets.get(o||Ps))||void 0===a?void 0:a.getResponse())||""}execute(o){var a=this;return(0,I.Z)(function*(){var l;return null===(l=a._widgets.get(o||Ps))||void 0===l||l.execute(),""})()}}class Ma{constructor(o,a,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const m="string"==typeof o?document.getElementById(o):o;k(m,"argument-error",{appName:a}),this.container=m,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function _h(c){const o=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<c;l++)o.push(a.charAt(Math.floor(Math.random()*a.length)));return o.join("")}(50);const{callback:o,"expired-callback":a}=this.params;if(o)try{o(this.responseToken)}catch(l){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch(l){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const qr=Jc("rcb"),el=new On(3e4,6e4);class Fs{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(o=ye().grecaptcha)||void 0===o?void 0:o.render)}load(o,a=""){return k(function ka(c){return c.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(c)}(a),o,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(ye().grecaptcha):new Promise((l,m)=>{const g=ye().setTimeout(()=>{m(me(o,"network-request-failed"))},el.get());ye()[qr]=()=>{ye().clearTimeout(g),delete ye()[qr];const T=ye().grecaptcha;if(!T)return void m(me(o,"internal-error"));const N=T.render;T.render=(P,j)=>{const U=N(P,j);return this.counter++,U},this.hostLanguage=a,l(T)},Xc(`https://www.google.com/recaptcha/api.js??${(0,f.xO)({onload:qr,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(g),m(me(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var a;return!!(null===(a=ye().grecaptcha)||void 0===a?void 0:a.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Na{load(o){return(0,I.Z)(function*(){return new Da(o)})()}clearedOneInstance(){}}const Ra="recaptcha",vh={theme:"light",type:"image"};class Hr{constructor(o,a=Object.assign({},vh),l){this.parameters=a,this.type=Ra,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ue(l),this.isInvisible="invisible"===this.parameters.size,k("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const m="string"==typeof o?document.getElementById(o):o;k(m,this.auth,"argument-error"),this.container=m,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Na:new Fs,this.validateStartingState()}verify(){var o=this;return(0,I.Z)(function*(){o.assertNotDestroyed();const a=yield o.render(),l=o.getAssertedRecaptcha();return l.getResponse(a)||new Promise(g=>{const y=T=>{!T||(o.tokenChangeListeners.delete(y),g(T))};o.tokenChangeListeners.add(y),o.isInvisible&&l.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){k(!this.parameters.sitekey,this.auth,"argument-error"),k(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),k("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return a=>{if(this.tokenChangeListeners.forEach(l=>l(a)),"function"==typeof o)o(a);else if("string"==typeof o){const l=ye()[o];"function"==typeof l&&l(a)}}}assertNotDestroyed(){k(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,I.Z)(function*(){if(yield o.init(),!o.widgetId){let a=o.container;if(!o.isInvisible){const l=document.createElement("div");a.appendChild(l),a=l}o.widgetId=o.getAssertedRecaptcha().render(a,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,I.Z)(function*(){k(ji()&&!Te(),o.auth,"internal-error"),yield function tl(){let c=null;return new Promise(o=>{"complete"!==document.readyState?(c=()=>o(),window.addEventListener("load",c)):o()}).catch(o=>{throw c&&window.removeEventListener("load",c),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const a=yield function ke(c){return $n.apply(this,arguments)}(o.auth);k(a,o.auth,"internal-error"),o.parameters.sitekey=a})()}getAssertedRecaptcha(){return k(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ls{constructor(o,a){this.verificationId=o,this.onConfirmation=a}confirm(o){const a=hn._fromVerification(this.verificationId,o);return this.onConfirmation(a)}}function Kn(){return(Kn=(0,I.Z)(function*(c,o,a){const l=ue(c),m=yield Vs(l,o,(0,f.m9)(a));return new Ls(m,g=>vs(l,g))})).apply(this,arguments)}function Oa(){return(Oa=(0,I.Z)(function*(c,o,a){const l=(0,f.m9)(c);yield ms(!1,l,"phone");const m=yield Vs(l.auth,o,(0,f.m9)(a));return new Ls(m,g=>Mc(l,g))})).apply(this,arguments)}function Pa(){return(Pa=(0,I.Z)(function*(c,o,a){const l=(0,f.m9)(c),m=yield Vs(l.auth,o,(0,f.m9)(a));return new Ls(m,g=>kc(l,g))})).apply(this,arguments)}function Vs(c,o,a){return Ft.apply(this,arguments)}function Ft(){return(Ft=(0,I.Z)(function*(c,o,a){var l;const m=yield a.verify();try{let g;if(k("string"==typeof m,c,"argument-error"),k(a.type===Ra,c,"argument-error"),g="string"==typeof o?{phoneNumber:o}:o,"session"in g){const y=g.session;if("phoneNumber"in g)return k("enroll"===y.type,c,"internal-error"),(yield Gc(c,{idToken:y.credential,phoneEnrollmentInfo:{phoneNumber:g.phoneNumber,recaptchaToken:m}})).phoneSessionInfo.sessionInfo;{k("signin"===y.type,c,"internal-error");const T=(null===(l=g.multiFactorHint)||void 0===l?void 0:l.uid)||g.multiFactorUid;return k(T,c,"missing-multi-factor-info"),(yield Sa(c,{mfaPendingCredential:y.credential,mfaEnrollmentId:T,phoneSignInInfo:{recaptchaToken:m}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:y}=yield wc(c,{phoneNumber:g.phoneNumber,recaptchaToken:m});return y}}finally{a._reset()}})).apply(this,arguments)}function Wn(){return(Wn=(0,I.Z)(function*(c,o){yield sa((0,f.m9)(c),o)})).apply(this,arguments)}let Zn=(()=>{class c{constructor(a){this.providerId=c.PROVIDER_ID,this.auth=ue(a)}verifyPhoneNumber(a,l){return Vs(this.auth,a,(0,f.m9)(l))}static credential(a,l){return hn._fromVerification(a,l)}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:l,temporaryProof:m}=a;return l&&m?hn._fromTokenResponse(l,m):null}}return c.PROVIDER_ID="phone",c.PHONE_SIGN_IN_METHOD="phone",c})();function ft(c,o){return o?Ze(o):(k(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}class Us extends qt{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return wt(o,this._buildIdpRequest())}_linkToIdToken(o,a){return wt(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return wt(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function Be(c){return Dc(c.auth,new Us(c),c.bypassAuthState)}function il(c){const{auth:o,user:a}=c;return k(a,o,"internal-error"),gs(a,new Us(c),c.bypassAuthState)}function $r(c){return Yn.apply(this,arguments)}function Yn(){return(Yn=(0,I.Z)(function*(c){const{auth:o,user:a}=c;return k(a,o,"internal-error"),sa(a,new Us(c),c.bypassAuthState)})).apply(this,arguments)}class Fa{constructor(o,a,l,m,g=!1){this.auth=o,this.resolver=l,this.user=m,this.bypassAuthState=g,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var o=this;return new Promise(function(){var a=(0,I.Z)(function*(l,m){o.pendingPromise={resolve:l,reject:m};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(g){o.reject(g)}});return function(l,m){return a.apply(this,arguments)}}())}onAuthEvent(o){var a=this;return(0,I.Z)(function*(){const{urlResponse:l,sessionId:m,postBody:g,tenantId:y,error:T,type:N}=o;if(T)return void a.reject(T);const P={auth:a.auth,requestUri:l,sessionId:m,tenantId:y||void 0,postBody:g||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(N)(P))}catch(j){a.reject(j)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return Be;case"linkViaPopup":case"linkViaRedirect":return $r;case"reauthViaPopup":case"reauthViaRedirect":return il;default:Ee(this.auth,"internal-error")}}resolve(o){ge(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){ge(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const La=new On(2e3,1e4);function Bs(){return(Bs=(0,I.Z)(function*(c,o,a){const l=ue(c);un(c,o,Nt);const m=ft(l,a);return new Xn(l,"signInViaPopup",o,m).executeNotNull()})).apply(this,arguments)}function zr(){return(zr=(0,I.Z)(function*(c,o,a){const l=(0,f.m9)(c);un(l.auth,o,Nt);const m=ft(l.auth,a);return new Xn(l.auth,"reauthViaPopup",o,m,l).executeNotNull()})).apply(this,arguments)}function Wr(){return(Wr=(0,I.Z)(function*(c,o,a){const l=(0,f.m9)(c);un(l.auth,o,Nt);const m=ft(l.auth,a);return new Xn(l.auth,"linkViaPopup",o,m,l).executeNotNull()})).apply(this,arguments)}let Xn=(()=>{class c extends Fa{constructor(a,l,m,g,y){super(a,l,g,y),this.provider=m,this.authWindow=null,this.pollId=null,c.currentPopupAction&&c.currentPopupAction.cancel(),c.currentPopupAction=this}executeNotNull(){var a=this;return(0,I.Z)(function*(){const l=yield a.execute();return k(l,a.auth,"internal-error"),l})()}onExecution(){var a=this;return(0,I.Z)(function*(){ge(1===a.filter.length,"Popup operations only handle one event");const l=mn();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],l),a.authWindow.associatedEvent=l,a.resolver._originValidation(a.auth).catch(m=>{a.reject(m)}),a.resolver._isIframeWebStorageSupported(a.auth,m=>{m||a.reject(me(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(me(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,c.currentPopupAction=null}pollUserCancellation(){const a=()=>{var l,m;this.pollId=(null===(m=null===(l=this.authWindow)||void 0===l?void 0:l.window)||void 0===m?void 0:m.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(me(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(a,La.get())};a()}}return c.currentPopupAction=null,c})();const Jn=new Map;class Eh extends Fa{constructor(o,a,l=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,l),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,I.Z)(function*(){let l=Jn.get(a.auth._key());if(!l){try{const g=(yield function Ua(c,o){return Qn.apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;l=()=>Promise.resolve(g)}catch(m){l=()=>Promise.reject(m)}Jn.set(a.auth._key(),l)}return a.bypassAuthState||Jn.set(a.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,l=this;return(0,I.Z)(function*(){if("signInViaRedirect"===o.type)return a().call(l,o);if("unknown"!==o.type){if(o.eventId){const m=yield l.auth._redirectUserForId(o.eventId);if(m)return l.user=m,a().call(l,o);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,I.Z)(function*(){})()}cleanUp(){}}function Qn(){return(Qn=(0,I.Z)(function*(c,o){const a=er(o),l=al(c);if(!(yield l._isAvailable()))return!1;const m="true"===(yield l._get(a));return yield l._remove(a),m})).apply(this,arguments)}function Yr(c,o){return Gs.apply(this,arguments)}function Gs(){return(Gs=(0,I.Z)(function*(c,o){return al(c)._set(er(o),"true")})).apply(this,arguments)}function js(c,o){Jn.set(c._key(),o)}function al(c){return Ze(c._redirectPersistence)}function er(c){return Mt("pendingRedirect",c.config.apiKey,c.name)}function yn(){return(yn=(0,I.Z)(function*(c,o,a){const l=ue(c);un(c,o,Nt);const m=ft(l,a);return yield Yr(m,l),m._openRedirect(l,o,"signInViaRedirect")})).apply(this,arguments)}function Ga(){return(Ga=(0,I.Z)(function*(c,o,a){const l=(0,f.m9)(c);un(l.auth,o,Nt);const m=ft(l.auth,a);yield Yr(m,l.auth);const g=yield St(l);return m._openRedirect(l.auth,o,"reauthViaRedirect",g)})).apply(this,arguments)}function Xr(){return(Xr=(0,I.Z)(function*(c,o,a){const l=(0,f.m9)(c);un(l.auth,o,Nt);const m=ft(l.auth,a);yield ms(!1,l,o.providerId),yield Yr(m,l.auth);const g=yield St(l);return m._openRedirect(l.auth,o,"linkViaRedirect",g)})).apply(this,arguments)}function Hs(){return(Hs=(0,I.Z)(function*(c,o){return yield ue(c)._initializationPromise,$s(c,o,!1)})).apply(this,arguments)}function $s(c,o){return Lt.apply(this,arguments)}function Lt(){return(Lt=(0,I.Z)(function*(c,o,a=!1){const l=ue(c),m=ft(l,o),y=yield new Eh(l,m,a).execute();return y&&!a&&(delete y.user._redirectEventId,yield l._persistUserIfCurrent(y.user),yield l._setRedirectUser(null,o)),y})).apply(this,arguments)}function St(c){return nr.apply(this,arguments)}function nr(){return(nr=(0,I.Z)(function*(c){const o=mn(`${c.uid}:::`);return c._redirectEventId=o,yield c.auth._setRedirectUser(c),yield c.auth._persistUserIfCurrent(c),o})).apply(this,arguments)}class Jr{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(o,l)&&(a=!0,this.sendToConsumer(o,l),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function zs(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return re(c);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var l;if(o.error&&!re(o)){const m=(null===(l=o.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";a.onError(me(this.auth,m))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const l=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&l}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(qa(o))}saveEventToCache(o){this.cachedEventUids.add(qa(o)),this.lastProcessedEventTime=Date.now()}}function qa(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(o=>o).join("-")}function re({type:c,error:o}){return"unknown"===c&&"auth/no-auth-event"===(null==o?void 0:o.code)}function cl(c){return Ha.apply(this,arguments)}function Ha(){return(Ha=(0,I.Z)(function*(c,o={}){return _e(c,"GET","/v1/projects",o)})).apply(this,arguments)}const Qr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ei=/^https?/;function Ws(){return(Ws=(0,I.Z)(function*(c){if(c.config.emulator)return;const{authorizedDomains:o}=yield cl(c);for(const a of o)try{if(bh(a))return}catch(l){}Ee(c,"unauthorized-domain")})).apply(this,arguments)}function bh(c){const o=Rn(),{protocol:a,hostname:l}=new URL(o);if(c.startsWith("chrome-extension://")){const y=new URL(c);return""===y.hostname&&""===l?"chrome-extension:"===a&&c.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&y.hostname===l}if(!ei.test(a))return!1;if(Qr.test(c))return l===c;const m=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+m+"|"+m+")$","i").test(l)}const Th=new On(3e4,6e4);function ll(){const c=ye().___jsl;if(null==c?void 0:c.H)for(const o of Object.keys(c.H))if(c.H[o].r=c.H[o].r||[],c.H[o].L=c.H[o].L||[],c.H[o].r=[...c.H[o].L],c.CP)for(let a=0;a<c.CP.length;a++)c.CP[a]=null}let Zt=null;function Yt(c){return Zt=Zt||function Ah(c){return new Promise((o,a)=>{var l,m,g;function y(){ll(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{ll(),a(me(c,"network-request-failed"))},timeout:Th.get()})}if(null===(m=null===(l=ye().gapi)||void 0===l?void 0:l.iframes)||void 0===m?void 0:m.Iframe)o(gapi.iframes.getContext());else{if(!(null===(g=ye().gapi)||void 0===g?void 0:g.load)){const T=Jc("iframefcb");return ye()[T]=()=>{gapi.load?y():a(me(c,"network-request-failed"))},Xc(`https://apis.google.com/js/api.js?onload=${T}`).catch(N=>a(N))}y()}}).catch(o=>{throw Zt=null,o})}(c),Zt}const dl=new On(5e3,15e3),rr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ch=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Sh(c){const o=c.config;k(o.authDomain,c,"auth-domain-config-required");const a=o.emulator?Hi(o,"emulator/auth/iframe"):`https://${c.config.authDomain}/__/auth/iframe`,l={apiKey:o.apiKey,appName:c.name,v:We.SDK_VERSION},m=Ch.get(c.config.apiHost);m&&(l.eid=m);const g=c._getFrameworks();return g.length&&(l.fw=g.join(",")),`${a}?${(0,f.xO)(l).slice(1)}`}function $a(){return $a=(0,I.Z)(function*(c){const o=yield Yt(c),a=ye().gapi;return k(a,c,"internal-error"),o.open({where:document.body,url:Sh(c),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:rr,dontclear:!0},l=>new Promise(function(){var m=(0,I.Z)(function*(g,y){yield l.restyle({setHideOnLeave:!1});const T=me(c,"network-request-failed"),N=ye().setTimeout(()=>{y(T)},dl.get());function P(){ye().clearTimeout(N),g(l)}l.ping(P).then(P,()=>{y(T)})});return function(g,y){return m.apply(this,arguments)}}()))}),$a.apply(this,arguments)}const ml={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Wa{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(o){}}}function ir(c,o,a,l,m,g){k(c.config.authDomain,c,"auth-domain-config-required"),k(c.config.apiKey,c,"invalid-api-key");const y={apiKey:c.config.apiKey,appName:c.name,authType:a,redirectUrl:l,v:We.SDK_VERSION,eventId:m};if(o instanceof Nt){o.setDefaultLanguage(c.languageCode),y.providerId=o.providerId||"",(0,f.xb)(o.getCustomParameters())||(y.customParameters=JSON.stringify(o.getCustomParameters()));for(const[N,P]of Object.entries(g||{}))y[N]=P}if(o instanceof Ht){const N=o.getScopes().filter(P=>""!==P);N.length>0&&(y.scopes=N.join(","))}c.tenantId&&(y.tid=c.tenantId);const T=y;for(const N of Object.keys(T))void 0===T[N]&&delete T[N];return`${function ti({config:c}){return c.emulator?Hi(c,"emulator/auth/handler"):`https://${c.authDomain}/__/auth/handler`}(c)}?${(0,f.xO)(T).slice(1)}`}const sr="webStorageSupport";class En extends class ni{constructor(o){this.factorId=o}_process(o,a,l){switch(a.type){case"enroll":return this._finalizeEnroll(o,a.credential,l);case"signin":return this._finalizeSignIn(o,a.credential);default:return yt("unexpected MultiFactorSessionType")}}}{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new En(o)}_finalizeEnroll(o,a,l){return function jc(c,o){return _e(c,"POST","/v2/accounts/mfaEnrollment:finalize",he(c,o))}(o,{idToken:a,displayName:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,a){return function Ae(c,o){return _e(c,"POST","/v2/accounts/mfaSignIn:finalize",he(c,o))}(o,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let kh=(()=>{class c{constructor(){}static assertion(a){return En._fromCredential(a)}}return c.FACTOR_ID="phone",c})();var le="@firebase/auth";class Nh{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,I.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(l=>{var m;o((null===(m=l)||void 0===m?void 0:m.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);!a||(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){k(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Xt(){return window}function or(){return(or=(0,I.Z)(function*(c,o,a){var l;const{BuildInfo:m}=Xt();ge(o.sessionId,"AuthEvent did not contain a session ID");const g=yield wl(o.sessionId),y={};return ln()?y.ibi=m.packageName:Dr()?y.apn=m.packageName:Ee(c,"operation-not-supported-in-this-environment"),m.displayName&&(y.appDisplayName=m.displayName),y.sessionId=g,ir(c,a,o.type,void 0,null!==(l=o.eventId)&&void 0!==l?l:void 0,y)})).apply(this,arguments)}function pt(){return(pt=(0,I.Z)(function*(c){const{BuildInfo:o}=Xt(),a={};ln()?a.iosBundleId=o.packageName:Dr()?a.androidPackageName=o.packageName:Ee(c,"operation-not-supported-in-this-environment"),yield cl(c,a)})).apply(this,arguments)}function ri(){return(ri=(0,I.Z)(function*(c,o,a){const{cordova:l}=Xt();let m=()=>{};try{yield new Promise((g,y)=>{let T=null;function N(){var U;g();const Ie=null===(U=l.plugins.browsertab)||void 0===U?void 0:U.close;"function"==typeof Ie&&Ie(),"function"==typeof(null==a?void 0:a.close)&&a.close()}function P(){T||(T=window.setTimeout(()=>{y(me(c,"redirect-cancelled-by-user"))},2e3))}function j(){"visible"===(null==document?void 0:document.visibilityState)&&P()}o.addPassiveListener(N),document.addEventListener("resume",P,!1),Dr()&&document.addEventListener("visibilitychange",j,!1),m=()=>{o.removePassiveListener(N),document.removeEventListener("resume",P,!1),document.removeEventListener("visibilitychange",j,!1),T&&window.clearTimeout(T)}})}finally{m()}})).apply(this,arguments)}function wl(c){return si.apply(this,arguments)}function si(){return(si=(0,I.Z)(function*(c){const o=Zs(c),a=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(a)).map(m=>m.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function Zs(c){if(ge(/[0-9a-zA-Z]+/.test(c),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(c);const o=new ArrayBuffer(c.length),a=new Uint8Array(o);for(let l=0;l<c.length;l++)a[l]=c.charCodeAt(l);return a}!function Oh(c){(0,We._registerComponent)(new Ro.wA("auth",(o,{options:a})=>{const l=o.getProvider("app").getImmediate(),m=o.getProvider("heartbeat"),{apiKey:g,authDomain:y}=l.options;return((T,N)=>{k(g&&!g.includes(":"),"invalid-api-key",{appName:T.name}),k(!(null==y?void 0:y.includes(":")),"argument-error",{appName:T.name});const P={apiKey:g,authDomain:y,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Xi(c)},j=new Yo(T,N,P);return function oc(c,o){const a=(null==o?void 0:o.persistence)||[],l=(Array.isArray(a)?a:[a]).map(Ze);(null==o?void 0:o.errorMap)&&c._updateErrorMap(o.errorMap),c._initializeWithPersistence(l,null==o?void 0:o.popupRedirectResolver)}(j,a),j})(l,m)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,l)=>{o.getProvider("auth-internal").initialize()})),(0,We._registerComponent)(new Ro.wA("auth-internal",o=>{const a=ue(o.getProvider("auth").getImmediate());return new Nh(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,We.registerVersion)(le,"0.20.5",function Rh(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(c)),(0,We.registerVersion)(le,"0.20.5","esm2017")}("Browser");class Qa extends Jr{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(a=>a(o)),super.onEvent(o)}initialized(){var o=this;return(0,I.Z)(function*(){yield o.initPromise})()}}function eu(c){return wn.apply(this,arguments)}function wn(){return(wn=(0,I.Z)(function*(c){const o=yield oi()._get(ai(c));return o&&(yield oi()._remove(ai(c))),o})).apply(this,arguments)}function Al(){const c=[],o="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<20;a++){const l=Math.floor(Math.random()*o.length);c.push(o.charAt(l))}return c.join("")}function oi(){return Ze(qn)}function ai(c){return Mt("authEvent",c.config.apiKey,c.name)}function ui(c){if(!(null==c?void 0:c.includes("?")))return{};const[o,...a]=c.split("?");return(0,f.zd)(a.join("?"))}function tu(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:me("no-auth-event")}}function ar(){var c;return(null===(c=null==self?void 0:self.location)||void 0===c?void 0:c.protocol)||null}function Tn(c=(0,f.z$)()){return!("file:"!==ar()&&"ionic:"!==ar()&&"capacitor:"!==ar()||!c.toLowerCase().match(/iphone|ipad|ipod|android/))}function Nl(){try{const c=self.localStorage,o=mn();if(c)return c.setItem(o,"1"),c.removeItem(o),!function Uh(c=(0,f.z$)()){return function Vh(){return(0,f.w1)()&&11===(null==document?void 0:document.documentMode)}()||function nu(c=(0,f.z$)()){return/Edge\/\d+/.test(c)}(c)}()||(0,f.hl)()}catch(c){return Qs()&&(0,f.hl)()}return!1}function Qs(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function ru(){return(function kl(){return"http:"===ar()||"https:"===ar()}()||(0,f.ru)()||Tn())&&!function Lh(){return(0,f.b$)()||(0,f.UG)()}()&&Nl()&&!Qs()}function ci(){return Tn()&&"undefined"!=typeof document}function eo(){return(eo=(0,I.Z)(function*(){return!!ci()&&new Promise(c=>{const o=setTimeout(()=>{c(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),c(!0)})})})).apply(this,arguments)}const Se={LOCAL:"local",NONE:"none",SESSION:"session"},ot=k,to="persistence";function M(c){return oe.apply(this,arguments)}function oe(){return(oe=(0,I.Z)(function*(c){yield c._initializationPromise;const o=no(),a=Mt(to,c.config.apiKey,c.name);o&&o.setItem(a,c._getPersistence())})).apply(this,arguments)}function no(){var c;try{return(null===(c=function Ce(){return"undefined"!=typeof window?window:null}())||void 0===c?void 0:c.sessionStorage)||null}catch(o){return null}}const V=k;class G{constructor(){this.browserResolver=Ze(class Ya{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ct,this._completeRedirectFn=$s,this._overrideRedirectResult=js}_openPopup(o,a,l,m){var g=this;return(0,I.Z)(function*(){var y;ge(null===(y=g.eventManagers[o._key()])||void 0===y?void 0:y.manager,"_initialize() not called before _openPopup()");const T=ir(o,a,l,Rn(),m);return function Za(c,o,a,l=500,m=600){const g=Math.max((window.screen.availHeight-m)/2,0).toString(),y=Math.max((window.screen.availWidth-l)/2,0).toString();let T="";const N=Object.assign(Object.assign({},ml),{width:l.toString(),height:m.toString(),top:g,left:y}),P=(0,f.z$)().toLowerCase();a&&(T=mc(P)?"_blank":a),pc(P)&&(o=o||"http://localhost",N.scrollbars="yes");const j=Object.entries(N).reduce((Ie,[je,di])=>`${Ie}${je}=${di},`,"");if(function zo(c=(0,f.z$)()){var o;return ln(c)&&!!(null===(o=window.navigator)||void 0===o?void 0:o.standalone)}(P)&&"_self"!==T)return function xh(c,o){const a=document.createElement("a");a.href=c,a.target=o;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(l)}(o||"",T),new Wa(null);const U=window.open(o||"",T,j);k(U,c,"popup-blocked");try{U.focus()}catch(Ie){}return new Wa(U)}(o,T,mn())})()}_openRedirect(o,a,l,m){var g=this;return(0,I.Z)(function*(){return yield g._originValidation(o),function fh(c){ye().location.href=c}(ir(o,a,l,Rn(),m)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:m,promise:g}=this.eventManagers[a];return m?Promise.resolve(m):(ge(g,"If manager is not set, promise should be"),g)}const l=this.initAndGetManager(o);return this.eventManagers[a]={promise:l},l.catch(()=>{delete this.eventManagers[a]}),l}initAndGetManager(o){var a=this;return(0,I.Z)(function*(){const l=yield function pl(c){return $a.apply(this,arguments)}(o),m=new Jr(o);return l.register("authEvent",g=>(k(null==g?void 0:g.authEvent,o,"invalid-auth-event"),{status:m.onEvent(g.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:m},a.iframes[o._key()]=l,m})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(sr,{type:sr},m=>{var g;const y=null===(g=null==m?void 0:m[0])||void 0===g?void 0:g[sr];void 0!==y&&a(!!y),Ee(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function wh(c){return Ws.apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return Wo()||Yi()||ln()}}),this.cordovaResolver=Ze(class bn{constructor(){this._redirectPersistence=Ct,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=$s,this._overrideRedirectResult=js}_initialize(o){var a=this;return(0,I.Z)(function*(){const l=o._key();let m=a.eventManagers.get(l);return m||(m=new Qa(o),a.eventManagers.set(l,m),a.attachCallbackListeners(o,m)),m})()}_openPopup(o){Ee(o,"operation-not-supported-in-this-environment")}_openRedirect(o,a,l,m){var g=this;return(0,I.Z)(function*(){!function ii(c){var o,a,l,m,g,y,T,N,P,j;const U=Xt();k("function"==typeof(null===(o=null==U?void 0:U.universalLinks)||void 0===o?void 0:o.subscribe),c,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),k(void 0!==(null===(a=null==U?void 0:U.BuildInfo)||void 0===a?void 0:a.packageName),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),k("function"==typeof(null===(g=null===(m=null===(l=null==U?void 0:U.cordova)||void 0===l?void 0:l.plugins)||void 0===m?void 0:m.browsertab)||void 0===g?void 0:g.openUrl),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),k("function"==typeof(null===(N=null===(T=null===(y=null==U?void 0:U.cordova)||void 0===y?void 0:y.plugins)||void 0===T?void 0:T.browsertab)||void 0===N?void 0:N.isAvailable),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),k("function"==typeof(null===(j=null===(P=null==U?void 0:U.cordova)||void 0===P?void 0:P.InAppBrowser)||void 0===j?void 0:j.open),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const y=yield g._initialize(o);yield y.initialized(),y.resetRedirect(),function ol(){Jn.clear()}(),yield g._originValidation(o);const T=function Ys(c,o,a=null){return{type:o,eventId:a,urlResponse:null,sessionId:Al(),postBody:null,tenantId:c.tenantId,error:me(c,"no-auth-event")}}(o,l,m);yield function Fh(c,o){return oi()._set(ai(c),o)}(o,T);const N=yield function vl(c,o,a){return or.apply(this,arguments)}(o,T,a),P=yield function El(c){const{cordova:o}=Xt();return new Promise(a=>{o.plugins.browsertab.isAvailable(l=>{let m=null;l?o.plugins.browsertab.openUrl(c):m=o.InAppBrowser.open(c,function bm(c=(0,f.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(c)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(c)}()?"_blank":"_system","location=yes"),a(m)})})}(N);return function Ph(c,o,a){return ri.apply(this,arguments)}(o,y,P)})()}_isIframeWebStorageSupported(o,a){throw new Error("Method not implemented.")}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Il(c){return pt.apply(this,arguments)}(o)),this.originValidationPromises[a]}attachCallbackListeners(o,a){const{universalLinks:l,handleOpenURL:m,BuildInfo:g}=Xt(),y=setTimeout((0,I.Z)(function*(){yield eu(o),a.onEvent(tu())}),500),T=function(){var j=(0,I.Z)(function*(U){clearTimeout(y);const Ie=yield eu(o);let je=null;Ie&&(null==U?void 0:U.url)&&(je=function Tl(c,o){var a,l;const m=function Xs(c){const o=ui(c),a=o.link?decodeURIComponent(o.link):void 0,l=ui(a).link,m=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return ui(m).link||m||l||a||c}(o);if(m.includes("/__/auth/callback")){const g=ui(m),y=g.firebaseError?function Cl(c){try{return JSON.parse(c)}catch(o){return null}}(decodeURIComponent(g.firebaseError)):null,T=null===(l=null===(a=null==y?void 0:y.code)||void 0===a?void 0:a.split("auth/"))||void 0===l?void 0:l[1],N=T?me(T):null;return N?{type:c.type,eventId:c.eventId,tenantId:c.tenantId,error:N,urlResponse:null,sessionId:null,postBody:null}:{type:c.type,eventId:c.eventId,tenantId:c.tenantId,sessionId:c.sessionId,urlResponse:m,postBody:null}}return null}(Ie,U.url)),a.onEvent(je||tu())});return function(Ie){return j.apply(this,arguments)}}();void 0!==l&&"function"==typeof l.subscribe&&l.subscribe(null,T);const N=m,P=`${g.packageName.toLowerCase()}://`;Xt().handleOpenURL=function(){var j=(0,I.Z)(function*(U){if(U.toLowerCase().startsWith(P)&&T({url:U}),"function"==typeof N)try{N(U)}catch(Ie){console.error(Ie)}});return function(U){return j.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=Ct,this._completeRedirectFn=$s,this._overrideRedirectResult=js}_initialize(o){var a=this;return(0,I.Z)(function*(){return yield a.selectUnderlyingResolver(),a.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,a,l,m){var g=this;return(0,I.Z)(function*(){return yield g.selectUnderlyingResolver(),g.assertedUnderlyingResolver._openPopup(o,a,l,m)})()}_openRedirect(o,a,l,m){var g=this;return(0,I.Z)(function*(){return yield g.selectUnderlyingResolver(),g.assertedUnderlyingResolver._openRedirect(o,a,l,m)})()}_isIframeWebStorageSupported(o,a){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,a)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return ci()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return V(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,I.Z)(function*(){if(o.underlyingResolver)return;const a=yield function Bh(){return eo.apply(this,arguments)}();o.underlyingResolver=a?o.cordovaResolver:o.browserResolver})()}}function Rl(c){return c.unwrap()}function C(c){return ve(c)}function ve(c){const{_tokenResponse:o}=c instanceof f.ZR?c.customData:c;if(!o)return null;if(!(c instanceof f.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return Zn.credentialFromResult(c);const a=o.providerId;if(!a||"password"===a)return null;let l;switch(a){case"google.com":l=ea;break;case"facebook.com":l=Ac;break;case"github.com":l=Cc;break;case"twitter.com":l=xc;break;default:const{oauthIdToken:m,oauthAccessToken:g,oauthTokenSecret:y,pendingToken:T,nonce:N}=o;return g||y||m||T?T?a.startsWith("saml.")?Gn._create(a,T):bt._fromParams({providerId:a,signInMethod:a,pendingToken:T,idToken:m,accessToken:g}):new pn(a).credential({idToken:m,accessToken:g,rawNonce:N}):null}return c instanceof f.ZR?l.credentialFromError(c):l.credentialFromResult(c)}function Ge(c,o){return o.catch(a=>{throw a instanceof f.ZR&&function D(c,o){var a,l;const m=null===(a=o.customData)||void 0===a?void 0:a._tokenResponse;if("auth/multi-factor-auth-required"===(null===(l=o)||void 0===l?void 0:l.code))o.resolver=new jh(c,function Bc(c,o){var a;const l=(0,f.m9)(c),m=o;return k(o.customData.operationType,l,"argument-error"),k(null===(a=m.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,l,"argument-error"),Ur._fromError(l,m)}(c,o));else if(m){const g=ve(o),y=o;g&&(y.credential=g,y.tenantId=m.tenantId||void 0,y.email=m.email||void 0,y.phoneNumber=m.phoneNumber||void 0)}}(c,a),a}).then(a=>{const m=a.user;return{operationType:a.operationType,credential:C(a),additionalUserInfo:Lc(a),user:Vt.getOrCreate(m)}})}function iu(c,o){return su.apply(this,arguments)}function su(){return(su=(0,I.Z)(function*(c,o){const a=yield o;return{verificationId:a.verificationId,confirm:l=>Ge(c,a.confirm(l))}})).apply(this,arguments)}class jh{constructor(o,a){this.resolver=a,this.auth=function O(c){return c.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return Ge(Rl(this.auth),this.resolver.resolveSignIn(o))}}class Vt{constructor(o){this._delegate=o,this.multiFactor=function jn(c){const o=(0,f.m9)(c);return Ea.has(o)||Ea.set(o,Ia._fromUser(o)),Ea.get(o)}(o)}static getOrCreate(o){return Vt.USER_MAP.has(o)||Vt.USER_MAP.set(o,new Vt(o)),Vt.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var a=this;return(0,I.Z)(function*(){return Ge(a.auth,Mc(a._delegate,o))})()}linkWithPhoneNumber(o,a){var l=this;return(0,I.Z)(function*(){return iu(l.auth,function Ih(c,o,a){return Oa.apply(this,arguments)}(l._delegate,o,a))})()}linkWithPopup(o){var a=this;return(0,I.Z)(function*(){return Ge(a.auth,function Va(c,o,a){return Wr.apply(this,arguments)}(a._delegate,o,G))})()}linkWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield M(ue(a.auth)),function ja(c,o,a){return function tr(c,o,a){return Xr.apply(this,arguments)}(c,o,a)}(a._delegate,o,G)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var a=this;return(0,I.Z)(function*(){return Ge(a.auth,kc(a._delegate,o))})()}reauthenticateWithPhoneNumber(o,a){return iu(this.auth,function zn(c,o,a){return Pa.apply(this,arguments)}(this._delegate,o,a))}reauthenticateWithPopup(o){return Ge(this.auth,function Kr(c,o,a){return zr.apply(this,arguments)}(this._delegate,o,G))}reauthenticateWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield M(ue(a.auth)),function vn(c,o,a){return function Ba(c,o,a){return Ga.apply(this,arguments)}(c,o,a)}(a._delegate,o,G)})()}sendEmailVerification(o){return function Ot(c,o){return F.apply(this,arguments)}(this._delegate,o)}unlink(o){var a=this;return(0,I.Z)(function*(){return yield function eh(c,o){return fs.apply(this,arguments)}(a._delegate,o),a})()}updateEmail(o){return function ga(c,o){return Pc((0,f.m9)(c),o,null)}(this._delegate,o)}updatePassword(o){return function sh(c,o){return Pc((0,f.m9)(c),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function rl(c,o){return Wn.apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function Vr(c,o){return ma.apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,a){return function pa(c,o,a){return q.apply(this,arguments)}(this._delegate,o,a)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Vt.USER_MAP=new WeakMap;const li=k;let ou=(()=>{class c{constructor(a,l){if(this.app=a,l.isInitialized())return this._delegate=l.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:m}=a.options;li(m,"invalid-api-key",{appName:a.name}),li(m,"invalid-api-key",{appName:a.name});const g="undefined"!=typeof window?G:void 0;this._delegate=l.initialize({options:{persistence:Rm(m,a.name),popupRedirectResolver:g}}),this._delegate._updateErrorMap(an),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Vt.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(a){this._delegate.languageCode=a}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(a){this._delegate.tenantId=a}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(a,l){!function Fn(c,o,a){const l=ue(c);k(l._canInitEmulator,l,"emulator-config-failed"),k(/^https?:\/\//.test(o),l,"invalid-emulator-scheme");const m=!!(null==a?void 0:a.disableWarnings),g=Ln(o),{host:y,port:T}=function Kd(c){const o=Ln(c),a=/(\/\/)?([^?#/]+)/.exec(c.substr(o.length));if(!a)return{host:"",port:null};const l=a[2].split("@").pop()||"",m=/^(\[[^\]]+\])(:|$)/.exec(l);if(m){const g=m[1];return{host:g,port:Ji(l.substr(g.length+1))}}{const[g,y]=l.split(":");return{host:g,port:Ji(y)}}}(o);l.config.emulator={url:`${g}//${y}${null===T?"":`:${T}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:y,port:T,protocol:g.replace(":",""),options:Object.freeze({disableWarnings:m})}),m||function _c(){function c(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}(this._delegate,a,l)}applyActionCode(a){return function Oe(c,o){return Pr.apply(this,arguments)}(this._delegate,a)}checkActionCode(a){return ca(this._delegate,a)}confirmPasswordReset(a,l){return function nh(c,o,a){return Ye.apply(this,arguments)}(this._delegate,a,l)}createUserWithEmailAndPassword(a,l){var m=this;return(0,I.Z)(function*(){return Ge(m._delegate,function rh(c,o,a){return ha.apply(this,arguments)}(m._delegate,a,l))})()}fetchProvidersForEmail(a){return this.fetchSignInMethodsForEmail(a)}fetchSignInMethodsForEmail(a){return function W(c,o){return fa.apply(this,arguments)}(this._delegate,a)}isSignInWithEmailLink(a){return function ih(c,o){const a=fn.parseLink(o);return"EMAIL_SIGNIN"===(null==a?void 0:a.operation)}(0,a)}getRedirectResult(){var a=this;return(0,I.Z)(function*(){li(ru(),a._delegate,"operation-not-supported-in-this-environment");const l=yield function In(c,o){return Hs.apply(this,arguments)}(a._delegate,G);return l?Ge(a._delegate,Promise.resolve(l)):{credential:null,user:null}})()}addFrameworkForLogging(a){!function Dl(c,o){ue(c)._logFramework(o)}(this._delegate,a)}onAuthStateChanged(a,l,m){const{next:g,error:y,complete:T}=Ol(a,l,m);return this._delegate.onAuthStateChanged(g,y,T)}onIdTokenChanged(a,l,m){const{next:g,error:y,complete:T}=Ol(a,l,m);return this._delegate.onIdTokenChanged(g,y,T)}sendSignInLinkToEmail(a,l){return function Tt(c,o,a){return Oc.apply(this,arguments)}(this._delegate,a,l)}sendPasswordResetEmail(a,l){return function th(c,o,a){return Rc.apply(this,arguments)}(this._delegate,a,l||void 0)}setPersistence(a){var l=this;return(0,I.Z)(function*(){let m;switch(function Gh(c,o){ot(Object.values(Se).includes(o),c,"invalid-persistence-type"),(0,f.b$)()?ot(o!==Se.SESSION,c,"unsupported-persistence-type"):(0,f.UG)()?ot(o===Se.NONE,c,"unsupported-persistence-type"):Qs()?ot(o===Se.NONE||o===Se.LOCAL&&(0,f.hl)(),c,"unsupported-persistence-type"):ot(o===Se.NONE||Nl(),c,"unsupported-persistence-type")}(l._delegate,a),a){case Se.SESSION:m=Ct;break;case Se.LOCAL:m=(yield Ze(Wt)._isAvailable())?Wt:qn;break;case Se.NONE:m=Pn;break;default:return Ee("argument-error",{appName:l._delegate.name})}return l._delegate.setPersistence(m)})()}signInAndRetrieveDataWithCredential(a){return this.signInWithCredential(a)}signInAnonymously(){return Ge(this._delegate,function Qd(c){return ds.apply(this,arguments)}(this._delegate))}signInWithCredential(a){return Ge(this._delegate,vs(this._delegate,a))}signInWithCustomToken(a){return Ge(this._delegate,function Mm(c,o){return aa.apply(this,arguments)}(this._delegate,a))}signInWithEmailAndPassword(a,l){return Ge(this._delegate,function As(c,o,a){return vs((0,f.m9)(c),Or.credential(o,a))}(this._delegate,a,l))}signInWithEmailLink(a,l){return Ge(this._delegate,function x(c,o,a){return Rt.apply(this,arguments)}(this._delegate,a,l))}signInWithPhoneNumber(a,l){return iu(this._delegate,function nl(c,o,a){return Kn.apply(this,arguments)}(this._delegate,a,l))}signInWithPopup(a){var l=this;return(0,I.Z)(function*(){return li(ru(),l._delegate,"operation-not-supported-in-this-environment"),Ge(l._delegate,function sl(c,o,a){return Bs.apply(this,arguments)}(l._delegate,a,G))})()}signInWithRedirect(a){var l=this;return(0,I.Z)(function*(){return li(ru(),l._delegate,"operation-not-supported-in-this-environment"),yield M(l._delegate),function ul(c,o,a){return function qs(c,o,a){return yn.apply(this,arguments)}(c,o,a)}(l._delegate,a,G)})()}updateCurrentUser(a){return this._delegate.updateCurrentUser(a)}verifyPasswordResetCode(a){return function la(c,o){return da.apply(this,arguments)}(this._delegate,a)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return c.Persistence=Se,c})();function Ol(c,o,a){let l=c;"function"!=typeof c&&({next:l,error:o,complete:a}=c);const m=l;return{next:y=>m(y&&Vt.getOrCreate(y)),error:o,complete:a}}function Rm(c,o){const a=function An(c,o){const a=no();if(!a)return[];const l=Mt(to,c,o);switch(a.getItem(l)){case Se.NONE:return[Pn];case Se.LOCAL:return[Wt,Ct];case Se.SESSION:return[Ct];default:return[]}}(c,o);if("undefined"!=typeof self&&!a.includes(Wt)&&a.push(Wt),"undefined"!=typeof window)for(const l of[qn,Ct])a.includes(l)||a.push(l);return a.includes(Pn)||a.push(Pn),a}class au{constructor(){this.providerId="phone",this._delegate=new Zn(Rl(Bi.Z.auth()))}static credential(o,a){return Zn.credential(o,a)}verifyPhoneNumber(o,a){return this._delegate.verifyPhoneNumber(o,a)}unwrap(){return this._delegate}}au.PHONE_SIGN_IN_METHOD=Zn.PHONE_SIGN_IN_METHOD,au.PROVIDER_ID=Zn.PROVIDER_ID;const Pl=k;class H{constructor(o,a,l=Bi.Z.app()){var m;Pl(null===(m=l.options)||void 0===m?void 0:m.apiKey,"invalid-api-key",{appName:l.name}),this._delegate=new Hr(o,a,l.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Fl(c){c.INTERNAL.registerComponent(new Ro.wA("auth-compat",o=>{const a=o.getProvider("app-compat").getImmediate(),l=o.getProvider("auth");return new ou(a,l)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:Or,FacebookAuthProvider:Ac,GithubAuthProvider:Cc,GoogleAuthProvider:ea,OAuthProvider:pn,SAMLAuthProvider:cs,PhoneAuthProvider:au,PhoneMultiFactorGenerator:kh,RecaptchaVerifier:H,TwitterAuthProvider:xc,Auth:ou,AuthCredential:qt,Error:f.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),c.registerVersion("@firebase/auth-compat","0.2.18")}(Bi.Z)}}]);